<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.1">
<title data-rh="true">12 posts tagged with &quot;ethereum&quot; | Shawn Tabrizi</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://shawntabrizi.com/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://shawntabrizi.com/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://shawntabrizi.com/blog/tags/ethereum/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="12 posts tagged with &quot;ethereum&quot; | Shawn Tabrizi"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/assets/favicon/favicon-32x32.png"><link data-rh="true" rel="canonical" href="https://shawntabrizi.com/blog/tags/ethereum/"><link data-rh="true" rel="alternate" href="https://shawntabrizi.com/blog/tags/ethereum/" hreflang="en"><link data-rh="true" rel="alternate" href="https://shawntabrizi.com/blog/tags/ethereum/" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Shawn Tabrizi RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Shawn Tabrizi Atom Feed"><link rel="stylesheet" href="/assets/css/styles.56421a03.css">
<script src="/assets/js/runtime~main.9e6edeba.js" defer="defer"></script>
<script src="/assets/js/main.95bff564.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">Shawn Tabrizi</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog/">Blog</a><a class="navbar__item navbar__link" href="/portfolio/">Portfolio</a><a class="navbar__item navbar__link" href="/donate/">Donate</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/shawntabrizi/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/personal/web3-reading-list/">Web3 Reading List</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/substrate/transparent-keys-in-substrate/">Transparent Keys in Substrate</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/substrate/substrate-weight-and-fees/">Substrate Weights and Fees</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/substrate/porting-web3-js-to-polkadot-js/">Porting Web3.js to Polkadot.js</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/substrate/substrate-storage-deep-dive/">Substrate Storage Deep Dive</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="https://schema.org/Blog"><header class="margin-bottom--xl"><h1>12 posts tagged with &quot;ethereum&quot;</h1><a href="/blog/tags/">View All Tags</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="In this post, I will go over the changes I needed to make in order to port a Web3.js based Ethereum web app I had previously blogged about to use Polkadot.js and Substrate."><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/substrate/porting-web3-js-to-polkadot-js/">Porting Web3.js to Polkadot.js</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2020-01-13T00:14:03.000Z" itemprop="datePublished">January 13, 2020</time> · <!-- -->10 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/shawntabrizi" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/shawntabrizi.png" alt="Shawn Tabrizi" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/shawntabrizi" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Shawn Tabrizi</span></a></div><small class="avatar__subtitle" itemprop="description">Software Engineer</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h5 class="anchor anchorWithStickyNavbar_LWe7" id="in-this-post-i-will-go-over-the-changes-i-needed-to-make-in-order-to-port-a-web3js-based-ethereum-web-app-i-had-previously-blogged-about-to-use-polkadotjs-and-substrate">In this post, I will go over the changes I needed to make in order to port a Web3.js based Ethereum web app I had <a href="/blog/ethereum/graphing-eth-balance-history-of-an-ethereum-address-using-parallel-asynchronous-requests-in-web3-js/">previously blogged about</a> to use Polkadot.js and Substrate.<a href="#in-this-post-i-will-go-over-the-changes-i-needed-to-make-in-order-to-port-a-web3js-based-ethereum-web-app-i-had-previously-blogged-about-to-use-polkadotjs-and-substrate" class="hash-link" aria-label="Direct link to in-this-post-i-will-go-over-the-changes-i-needed-to-make-in-order-to-port-a-web3js-based-ethereum-web-app-i-had-previously-blogged-about-to-use-polkadotjs-and-substrate" title="Direct link to in-this-post-i-will-go-over-the-changes-i-needed-to-make-in-order-to-port-a-web3js-based-ethereum-web-app-i-had-previously-blogged-about-to-use-polkadotjs-and-substrate">​</a></h5>
<p>Almost 2 years ago, I was still on my journey learning about Ethereum, when I built a simple web application using Web3.js. At the time, there was a spawn of viral &quot;ponzi scheme&quot; smart contracts, and I wanted to see how these dApps grew and eventually crashed over time.</p>
<p>Check out my previous blog post about <a href="/blog/ethereum/graphing-eth-balance-history-of-an-ethereum-address-using-parallel-asynchronous-requests-in-web3-js/">Graphing ETH Balance History of an Ethereum Address using Parallel Asynchronous Requests in Web3.js</a> to learn more.</p>
<p>Since the launch of <a href="https://kusama.network/" target="_blank" rel="noopener noreferrer">Kusama</a>, there has been a lot more activity around actually <em>using</em> Substrate, specifically among the validator/nominator community. I wanted to take a look at the my nomination rewards over time, and to do that, I basically needed to rebuild this same application, but using Polkadot.js... (<a href="https://www.shawntabrizi.com/substrate-balance-graph/" target="_blank" rel="noopener noreferrer">sneak peek</a>)</p>
<p><img loading="lazy" alt="Before and after screenshot of Web3 to Polkadot port" src="/assets/images/substrate-balance-graph-hero-52698f197d2068bbeede1cb39a98859f.png" width="1086" height="467" class="img_ev3q"></p>
<p>Here is <strong>that</strong> journey.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="creating-a-polkadotjs-bundle">Creating a Polkadot.js Bundle<a href="#creating-a-polkadotjs-bundle" class="hash-link" aria-label="Direct link to Creating a Polkadot.js Bundle" title="Direct link to Creating a Polkadot.js Bundle">​</a></h2>
<p>The first issue I ran into when trying to migrate from Web3.js to Polkadot.js was generating a standalone JavaScript bundle so I can simply include the dependencies into my barebones project. At the moment, Polkadot.js does not provide an official bundle, but it is easy enough to create with <a href="http://browserify.org/" target="_blank" rel="noopener noreferrer">browserify</a>.</p>
<p>Assuming you already have <code>npm</code>, here are those steps:</p>
<ol>
<li>
<p>Install browserify:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npm install -g browserify</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Create a new NodeJS project:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mkdir temp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd temp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># lots of interaction here, doesn&#x27;t matter what you select</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Add the Polkadot.js dependencies (I use <code>@beta</code>, but the exact versions to use may change over time):</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npm install @polkadot/api@beta</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm install @polkadot/util@beta</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm install @polkadot/util-crypto@beta</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm install @polkadot/keyring@beta</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You should have a <code>package.json</code> that looks like:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;dependencies&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;@polkadot/api&quot;: &quot;^1.0.0-beta.7&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;@polkadot/keyring&quot;: &quot;^2.0.0-beta.4&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;@polkadot/util&quot;: &quot;^2.0.0-beta.4&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;@polkadot/util-crypto&quot;: &quot;^2.0.0-beta.4&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Create a simple file which exports these libraries into the <code>window</code> object:</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// In a file named `dependencies.js`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> api </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;@polkadot/api&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> util </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;@polkadot/util&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> util_crypto </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;@polkadot/util-crypto&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> keyring </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;@polkadot/keyring&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">api</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> api</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">util</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> util</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">util_crypto</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> util_crypto</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">keyring</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> keyring</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Create the <code>polkadot.js</code> bundle:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">browserify dependencies.js &gt; polkadot.js</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ol>
<p>You should now have a <code>polkadot.js</code> file that you can include into any HTML page and will export <code>api</code>, <code>util</code>, <code>util_crypto</code>, and <code>keyring</code> commands.</p>
<div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">script</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">src</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">polkadot.js</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token script"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Actually, you can find it on this page too! Just open your browser console and try any of these commands.</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">util_crypto</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">blake2AsHex</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Hello, World!&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;0x511bc81dde11180838c562c82bb35f3223f46061ebde4a955c27b3f489cf1e03&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If you don&#x27;t want to follow these steps, feel free to grab the <code>polkadot.js</code> bundle I created at: <a href="https://github.com/shawntabrizi/substrate-balance-graph" target="_blank" rel="noopener noreferrer">shawntabrizi/substrate-balance-graph</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="connecting-to-a-node">Connecting to a Node<a href="#connecting-to-a-node" class="hash-link" aria-label="Direct link to Connecting to a Node" title="Direct link to Connecting to a Node">​</a></h2>
<p>As a front-end developer, I am not so interested in setting up a local node, to get my app to work. In the Web3.js world, I would use Metamask + a dedicated infura node. From my Ethereum web app <a href="https://github.com/shawntabrizi/ethgraph" target="_blank" rel="noopener noreferrer">(ethgraph)</a>:</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Check for MetaMask, otherwise use an HTTP Provider</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;load&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">typeof</span><span class="token plain"> web3 </span><span class="token operator" style="color:#393A34">!==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;undefined&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Web3 Detected! &#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> web3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">currentProvider</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">constructor</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">web3</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Web3</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">web3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">currentProvider</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;No Web3 Detected... using HTTP Provider&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">web3</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Web3</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Web3</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">providers</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">HttpProvider</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;https://mainnet.infura.io/&lt;APIKEY&gt;&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <a href="https://github.com/polkadot-js/extension" target="_blank" rel="noopener noreferrer">polkadot-js/extension</a> does not inject a WebSocket provider automatically, so we can skip the &quot;detected&quot; step, and just connect when we know we are not connected. Substrate is also not just a platform for <em>one</em> chain, but many chains, so I wanted to also support the user user customizable endpoints.</p>
<p>I created a <code>connect</code> function which looks like this:</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Connect to Substrate endpoint</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">connect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> endpoint </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getElementById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;endpoint&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">value</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">substrate</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> global</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">endpoint</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> endpoint</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> provider </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">api</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">WsProvider</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">endpoint</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getElementById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;output&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">innerHTML</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Connecting to Endpoint...&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">substrate</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> api</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">ApiPromise</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> provider </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        global</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">endpoint</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> endpoint</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getElementById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;output&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">innerHTML</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Connected&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can see I keep track of two global properties:</p>
<ol>
<li><code>window.substrate</code> - This will be my WebSocket provider and how I access the Polkadot.js APIs. If it already exists, I am already connected!</li>
<li><code>window.global.endpoint</code> - This is a global variable I created to keep track of the current endpoint I am connected to.</li>
</ol>
<p>When I call <code>connect</code>, it will make sure I am connected to the endpoint I want based on the input of the <code>endpoint</code> element on the HTML page. For a network like Kusama, this endpoint would be something like:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wss://kusama-rpc.polkadot.io/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="querying-the-node">Querying the Node<a href="#querying-the-node" class="hash-link" aria-label="Direct link to Querying the Node" title="Direct link to Querying the Node">​</a></h2>
<p>At the time of creating <code>ethgraph</code>, Web3.js did not support <code>async</code>/<code>await</code>. Instead, <a href="/blog/ethereum/making-web3-js-work-asynchronously-javascript-promises-await/">I wrapped everything in a &quot;promisify&quot; wrapper</a>. Fortunately, Polkadot.js supports this natively, so you can query every API easily and ergonomically with a promise.</p>
<p>For example, here is how we can get the balance of a user:</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> balance </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> substrate</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">balances</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">freeBalance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;EGVQCe73TpFyAZx5uKfE1222XfkT3BSKozjgcqzLBnc5eYo&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">balance</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toNumber</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2116624633061757</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To provide all the functionality of the Ethereum version of this app, I also need to query the timestamp of a block. Ethereum would include this in the block header, but we know that Substrate has no such requirements, and instead provides this through another runtime module:</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> timestamp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> substrate</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">timestamp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">now</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token known-class-name class-name">Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">timestamp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Wed Jan 15 2020 22:42:37 GMT+0100 (Central European Standard Time)&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Great! But how do we get the <em>historical</em> information?</p>
<p>In Ethereum, we could just provide the block number directly into the query:</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">web3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">eth</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getBalance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">address</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> blockNumber</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/*callback*/</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In Polkadot.js we need to use the <code>.at(hash, &lt;PARAMS&gt;)</code> API, which extends all the Substrate queries. <code>hash</code> here is the block hash of the block that I want to get the information for. To get the block hash, I need to make an RPC call through the Polkadot.js API:</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> blockHash </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> substrate</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">rpc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">chain</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getBlockHash</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blockHash</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;0x46781d9a3350a0e02dbea4b5e7aee7c139331a65b2cd736bb45a824c2f3ffd1a&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>So all together now:</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> balance_100 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> substrate</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">balances</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">freeBalance</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">at</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;0x46781d9a3350a0e02dbea4b5e7aee7c139331a65b2cd736bb45a824c2f3ffd1a&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;EGVQCe73TpFyAZx5uKfE1222XfkT3BSKozjgcqzLBnc5eYo&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">balance_100</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toNumber</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10000000000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can see I gained quite a bit of free balance since block 0! :)</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="keeping-it-async">Keeping it Async<a href="#keeping-it-async" class="hash-link" aria-label="Direct link to Keeping it Async" title="Direct link to Keeping it Async">​</a></h2>
<p>So we have all the pieces to be able convert our old queries into the new ones. However, if we do things naively, we will run into a trap which was warned about in my last blog post.</p>
<p>Can you guess?</p>
<p>Let&#x27;s take a look how a naive conversion between Web3.js to Polkadot.js would look like:</p>
<ul>
<li>
<p>Original Web3.js Code</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Loop over the blocks, using the step value</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> startBlock</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> endBlock</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> step</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// If we already have data about that block, skip it</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">global</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">balances</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">x</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">block</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Create a promise to query the ETH balance for that block</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> balancePromise </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">promisify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">cb</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> web3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">eth</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getBalance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">address</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cb</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Create a promise to get the timestamp for that block</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> timePromise </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">promisify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">cb</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> web3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">eth</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getBlock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cb</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Push data to a linear array of promises to run in parellel.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        promises</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> balancePromise</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> timePromise</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Naive Polkadot.js Code</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Loop over the blocks, using the step value</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> startBlock</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> endBlock</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> step</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// If we already have data about that block, skip it</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">global</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">balances</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">x</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">block</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Get the block hash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> blockHash </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> substrate</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">rpc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">chain</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getBlockHash</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Create a promise to query the balance for that block</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> freeBalancePromise </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> substrate</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">balances</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">freeBalance</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">at</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">blockHash</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> address</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Create a promise to get the timestamp for that block</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> timePromise </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> substrate</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">timestamp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">now</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">at</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">blockHash</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Push data to a linear array of promises to run in parellel.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        promises</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> freeBalancePromise</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> timePromise</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>
<p>First, we should call out how incredibly similar the two code blocks look. The naive update is <em>totally</em> working, and really we did not have to change our app at all! But if you are trying this at home, you might notice the app is running pretty slow... over 30 seconds to fetch the data needed to create the graph!</p>
<p><img loading="lazy" alt="Image before parallel async" src="/assets/images/substrate-balance-graph-before-fb6d71a5855ded8244bfdc86226ab570.png" width="2880" height="1800" class="img_ev3q"></p>
<p>The point of this loop was to collect all the queries and run them asynchronously. As mentioned in the last blog post, this provides a huge boost in performance since we are not waiting for each response to move onto the next one. However, this naive conversion sticks an <code>await</code> right in the middle of the loop, and this causes us to serialize querying for all the blocks, and slow down the entire processes.</p>
<p>To solve this, we want to also query all the block hashes for the blocks we need in parallel, but in a separate loop, because we need to know the hash before we can make the next query.</p>
<p>The improved solution looks like:</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> promises </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Get all block hashes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> startBlock</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> endBlock</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> step</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// If we already have data about that block, skip it.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">global</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">blockHashes</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">x</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">block</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> blockHashPromise </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> substrate</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">rpc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">chain</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getBlockHash</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        promises</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> blockHashPromise</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Call all promises in parallel for speed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> results </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token known-class-name class-name">Promise</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">all</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">promises</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Save block hashes globally so we don&#x27;t query them again if we don&#x27;t need to.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> results</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    global</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">blockHashes</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">block</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> results</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">hash</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> results</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> promises </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Loop over the blocks, using the step value</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> startBlock</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> endBlock</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> step</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// If we already have data about that block, skip it</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">global</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">balances</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">x</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">block</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Get the block hash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> blockHash </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> global</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">blockHashes</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">x</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">block</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">hash</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Create a promise to query the balance for that block</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> freeBalancePromise </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> substrate</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">balances</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">freeBalance</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">at</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">blockHash</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> address</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Create a promise to get the timestamp for that block</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> timePromise </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> substrate</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">query</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">timestamp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">now</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">at</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">blockHash</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Push data to a linear array of promises to run in parellel.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        promises</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> freeBalancePromise</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> timePromise</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Call all promises in parallel for speed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> results </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token known-class-name class-name">Promise</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">all</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">promises</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Results:&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> results</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This generates a graph for us in under 2 seconds!</p>
<p><img loading="lazy" alt="Image after parallel async" src="/assets/images/substrate-balance-graph-after-57e92e045e9f6bc0ea73590fa39d5e2a.png" width="2880" height="1800" class="img_ev3q"></p>
<p>Much better, and what you would expect from a modern web application! But here we don&#x27;t have a traditional database, just a blockchain.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="final-thoughts">Final Thoughts<a href="#final-thoughts" class="hash-link" aria-label="Direct link to Final Thoughts" title="Direct link to Final Thoughts">​</a></h2>
<p>You can play with the final application here: <a href="https://www.shawntabrizi.com/substrate-balance-graph/" target="_blank" rel="noopener noreferrer">https://www.shawntabrizi.com/substrate-balance-graph/</a></p>
<p>After this exercise it has become clear to me that porting existing web applications built with Web3.js to Polkadot.js is trivial. Additionally, I already have a ton of experience with Substrate runtime development, so I already know how easy it will be to take existing smart contracts and build them on Substrate, maybe even better than before.</p>
<p>With that in mind, it won&#x27;t be long until we see a wave of existing dApps joining Substrate/Polkadot, taking advantage of all the next generation features without making any compromises toward their existing functionality. The future seems bright overall, and I am excited to be at the forefront.</p>
<p>As always, if you like the content I create, stop by my <a href="https://shawntabrizi.com/donate/" target="_blank" rel="noopener noreferrer">donations page</a> and say thanks!</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/javascript/">javascript</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/front-end/">front-end</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/balance/">balance</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/graph/">graph</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/plotly-js/">plotly.js</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/ethereum/">ethereum</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/substrate/">substrate</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="In this post, I will show you how you can easily add a fee for calling a function within your Substrate runtime module."><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/substrate/adding-fees-to-your-substrate-runtime-module/">Adding Fees to Your Substrate Runtime Module</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2019-05-28T00:14:03.000Z" itemprop="datePublished">May 28, 2019</time> · <!-- -->8 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/shawntabrizi" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/shawntabrizi.png" alt="Shawn Tabrizi" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/shawntabrizi" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Shawn Tabrizi</span></a></div><small class="avatar__subtitle" itemprop="description">Software Engineer</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h5 class="anchor anchorWithStickyNavbar_LWe7" id="in-this-post-i-will-show-you-how-you-can-easily-add-a-fee-for-calling-a-function-within-your-substrate-runtime-module">In this post, I will show you how you can easily add a fee for calling a function within your Substrate runtime module.<a href="#in-this-post-i-will-show-you-how-you-can-easily-add-a-fee-for-calling-a-function-within-your-substrate-runtime-module" class="hash-link" aria-label="Direct link to In this post, I will show you how you can easily add a fee for calling a function within your Substrate runtime module." title="Direct link to In this post, I will show you how you can easily add a fee for calling a function within your Substrate runtime module.">​</a></h5>
<p>When using Substrate, you are afforded the flexibility to completely control the fee system within your runtime.</p>
<p>By default, a <a href="https://substrate.dev/rustdocs/v1.0/srml_balances/struct.Module.html#method.transaction_base_fee" target="_blank" rel="noopener noreferrer"><code>transaction_base_fee</code></a> is added to every transaction you make to your runtime. However, this blanket base fee does NOT take into account anything related to the complexity or storage used as a result of the transaction.</p>
<p>Substrate makes the following recommendation in the <code>Example</code> module:</p>
<blockquote>
<p>Ensure that calls into each of these [functions] execute in a time, memory and using storage space <strong>proportional to any costs paid for by the caller</strong> or otherwise the difficulty of forcing the call to happen.</p>
</blockquote>
<p>Thus, if your runtime module exposes functions which are heavy in computation or storage needs, you should be sure to add some <em>additional</em> fee on top of the base fee to ensure your blockchain is not attackable.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="a-simple-fee">A Simple Fee<a href="#a-simple-fee" class="hash-link" aria-label="Direct link to A Simple Fee" title="Direct link to A Simple Fee">​</a></h2>
<p>There are a lot of complicated methods you can use for calculating fees for functions. You can take a look at the <a href="https://github.com/paritytech/substrate/tree/v1.0/srml/contract" target="_blank" rel="noopener noreferrer">Contract module</a> for an example of that.</p>
<p>For this example, I will be showing you the most simple implementation of a fee which will be inline with the rest of your module code.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="withdrawing-from-balance">Withdrawing From Balance<a href="#withdrawing-from-balance" class="hash-link" aria-label="Direct link to Withdrawing From Balance" title="Direct link to Withdrawing From Balance">​</a></h3>
<p>The first tool we will use is the <a href="https://substrate.dev/rustdocs/v1.0/srml_support/traits/trait.Currency.html#tymethod.withdraw" target="_blank" rel="noopener noreferrer"><code>withdraw</code> function</a> provided by the <code>Currency</code> trait in the Balances module:</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">withdraw</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    who</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token class-name">AccountId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">Self</span><span class="token punctuation" style="color:#393A34">::</span><span class="token class-name">Balance</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    reason</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">WithdrawReason</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    liveness</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">ExistenceRequirement</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token class-name">Result</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">Self</span><span class="token punctuation" style="color:#393A34">::</span><span class="token class-name">NegativeImbalance</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token lifetime-annotation symbol" style="color:#36acaa">&#x27;static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">str</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>Removes some free balance from who account for reason if possible. If liveness is KeepAlive, then no less than ExistentialDeposit must be left remaining.</p>
<p>This checks any locks, vesting, and liquidity requirements. If the removal is not possible, then it returns Err.</p>
</blockquote>
<p>Withdraw is designed to be quite flexible. As you can see, it allows you to specify the reason for a withdrawal. In this case, we are taking a <em>fee</em>:</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// use support::traits::WithdrawReason</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token class-name">WithdrawReason</span><span class="token punctuation" style="color:#393A34">::</span><span class="token class-name">Fee</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>It can even make sure that removing these funds will not kill an account. For our fee system, this second point will be particularly important since we do not want users to accidentally destroy their account paying for fees!</p>
<p>For this, we simply pass:</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// use support::traits::ExistenceRequirement</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token class-name">ExistenceRequirement</span><span class="token punctuation" style="color:#393A34">::</span><span class="token class-name">KeepAlive</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now we can really safely charge fees to a user upfront and let the logic of the Balances module handle the rest. For ease of reusability, we will create an internal function which can be called within our module to charge a fee to a user:</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">impl</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token class-name">T</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Trait</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token class-name">Module</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token class-name">T</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">pay_fee</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">who</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">T</span><span class="token punctuation" style="color:#393A34">::</span><span class="token class-name">AccountId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> amount</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">T</span><span class="token punctuation" style="color:#393A34">::</span><span class="token class-name">Balance</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token class-name">Result</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> _ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token namespace" style="opacity:0.7">balances</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token class-name">Module</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token class-name">T</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> </span><span class="token class-name">Currency</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">_</span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">withdraw</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">who</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      amount</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">WithdrawReason</span><span class="token punctuation" style="color:#393A34">::</span><span class="token class-name">Fee</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">ExistenceRequirement</span><span class="token punctuation" style="color:#393A34">::</span><span class="token class-name">KeepAlive</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Ok</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This function will either propagate an error from taking funds from the user, or will complete successfully and return <code>Ok(())</code>. We can then handle the error within our runtime.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="imbalance">Imbalance<a href="#imbalance" class="hash-link" aria-label="Direct link to Imbalance" title="Direct link to Imbalance">​</a></h4>
<p>One thing we glazed over at this point is the return type of the <code>withdraw</code> function:</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token class-name">Result</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">Self</span><span class="token punctuation" style="color:#393A34">::</span><span class="token class-name">NegativeImbalance</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token lifetime-annotation symbol" style="color:#36acaa">&#x27;static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">str</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As you can see, it returns a <code>NegativeImbalance</code>, which is probably a type you have never seen before. Without going into <em>too</em> much detail, the <a href="https://github.com/paritytech/substrate/pull/2048" target="_blank" rel="noopener noreferrer">Imbalance system</a> within the Balances module is a way to ensure that the sum of all funds across all accounts is equal to the <code>TotalIssuance</code> managed by the Balances module.</p>
<p>So fortunately, this imbalances system <a href="https://stackoverflow.com/questions/56341343/is-handling-the-imbalance-type-mandatory-after-withdraw-or-deposit" target="_blank" rel="noopener noreferrer">does all of the hard work for us!</a> All we need to do is ignore this return type and we can be happy that the <code>TotalIssuance</code> is updated and this value is actually burned.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="charging-a-fee">Charging a Fee<a href="#charging-a-fee" class="hash-link" aria-label="Direct link to Charging a Fee" title="Direct link to Charging a Fee">​</a></h3>
<p>Now that we have created our <code>pay_fee</code> function, we need to call it within our runtime module. We will emulate a fixed fee system similar to the low level OPCODEs provided by Ethereum, where each function in our module can define some fixed cost to call the function.</p>
<p>This can be done easily by simply writing a function like so:</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token macro property" style="color:#36acaa">decl_module!</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token type-definition class-name">Module</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token class-name">T</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Trait</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">enum</span><span class="token plain"> </span><span class="token type-definition class-name">Call</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> origin</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">T</span><span class="token punctuation" style="color:#393A34">::</span><span class="token class-name">Origin</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">do_something</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">origin</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token class-name">Result</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> who </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ensure_signed</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">origin</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> fee </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1337</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">into</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">Self</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">pay_fee</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">who</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fee</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// Do stuff after fee is paid successfully...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">Ok</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This function checks whether or not <code>pay_fee</code> returns successfully, and if not, it propagates the error up and stops execution of the runtime function.</p>
<p>In the situation where a user is unable to <code>withdraw</code> funds, we will see the error message:</p>
<blockquote>
<p>Runtime: too few free funds in account</p>
</blockquote>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="converting-rust-primitives-to-substrate-specific-types">Converting Rust Primitives to Substrate Specific Types<a href="#converting-rust-primitives-to-substrate-specific-types" class="hash-link" aria-label="Direct link to Converting Rust Primitives to Substrate Specific Types" title="Direct link to Converting Rust Primitives to Substrate Specific Types">​</a></h4>
<p>You may notice that <code>pay_fee</code> and <code>withdraw</code> expect <code>fee</code> to be of type <code>T::Balance</code>.</p>
<p>Remember that Substrate is written to be <strong>very</strong> generic, so in the context of your runtime module, there are minimal assumptions about your blockchain&#x27;s types.</p>
<p>For example, using this generic type system, you would be able to define one Substrate blockchain which uses <code>u64</code> for the <code>Balance</code> type, another which uses <code>u128</code>, and another which uses <code>u32</code>. Because we use this generic type system for all the core blockchain types, the same module can be used out of the box across all of these different blockchains!</p>
<p>But this flexibility also means you need to tell the Rust compiler what to do when trying to handle incompatible situations.</p>
<p>For example, what should the module do if we try to put a <code>u128</code> value into a <code>Balance</code> type which is represented as <code>u64</code>? Or if we try to convert that same balance to a <code>u32</code>?</p>
<p>Substrate <a href="https://stackoverflow.com/questions/56081117/how-do-you-convert-between-substrate-specific-types-and-rust-primitive-types" target="_blank" rel="noopener noreferrer">provides implementations</a> of <code>From</code>/<code>TryFrom</code> and <code>Into</code>/<code>TryInto</code> to handle such scenarios. The only assumption being made here is that all values are at least a <code>u32</code>.</p>
<p>These traits guarantee that the underlying types implement functions which will attempt to convert between types if possible.</p>
<p>Thus, if we ever need to convert some <code>u32</code> value to a <code>Balance</code>, we can simply call:</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> my_balance</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">T</span><span class="token punctuation" style="color:#393A34">::</span><span class="token class-name">Balance</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> my_u32</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">into</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In the situation you need to convert some larger value, you will need to handle the situation where the <code>Balance</code> type is not compatible with type to be converted:</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">u64_to_balance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">input</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">u64</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token class-name">Option</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token class-name">T</span><span class="token punctuation" style="color:#393A34">::</span><span class="token class-name">Balance</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">try_into</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">ok</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Note that this returns an <code>Option</code>, thus your subsequent runtime logic needs to decide what to do when the conversion fails and the returned value is <code>None</code>.</p>
<p>Substrate also provides a <code>saturated_into</code> function which will always succeed, but will coerce your value into the type you want through saturation if necessary:</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">u64_to_balance_saturated</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">input</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">u64</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token class-name">T</span><span class="token punctuation" style="color:#393A34">::</span><span class="token class-name">Balance</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">saturated_into</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>However, it is very important that you be conscious when you do such things. From <a href="https://twitter.com/gavofyork" target="_blank" rel="noopener noreferrer">Gav</a>:</p>
<blockquote>
<p><code>SaturatedConversion</code> (<code>saturated_into</code> and <code>saturated_from</code>) should not be used unless you know what you&#x27;re doing, you&#x27;ve thought and considered all options and your use-case implies that saturation is fundamentally correct. The only time I imagine this is the case is deep in runtime arithmetic where you are logically certain it will not overflow, but can&#x27;t provide a proof because it would depend on consistent pre-existing state.</p>
</blockquote>
<p>Remember, as a runtime developer, Substrate provides you with numerous tools, but it is ultimately up to you to determine how to use them.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="a-minimal-complete-verifiable-example-module">A Minimal, Complete, Verifiable Example Module<a href="#a-minimal-complete-verifiable-example-module" class="hash-link" aria-label="Direct link to A Minimal, Complete, Verifiable Example Module" title="Direct link to A Minimal, Complete, Verifiable Example Module">​</a></h2>
<p>If you want to try out this simple fee system on your own Substrate chain, you can simply add a module like this to your runtime:</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">support</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">decl_module</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">dispatch</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token class-name">Result</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token namespace" style="opacity:0.7">traits</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token punctuation" style="color:#393A34">{</span><span class="token class-name">Currency</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">ExistenceRequirement</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">WithdrawReason</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">system</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token plain">ensure_signed</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// v1.0 branch</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// use runtime_primitives::traits::As;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">trait</span><span class="token plain"> </span><span class="token type-definition class-name">Trait</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">balances</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token class-name">Trait</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property" style="color:#36acaa">decl_module!</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token type-definition class-name">Module</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token class-name">T</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Trait</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">enum</span><span class="token plain"> </span><span class="token type-definition class-name">Call</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> origin</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">T</span><span class="token punctuation" style="color:#393A34">::</span><span class="token class-name">Origin</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">do_something</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">origin</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token class-name">Result</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> who </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ensure_signed</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">origin</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> fee </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1337</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">into</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// v1.0 branch</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// let fee = T::Balance::sa(1337);</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">Self</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">pay_fee</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">who</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fee</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// Do stuff after fee is paid successfully...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">Ok</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">impl</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token class-name">T</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">Trait</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token class-name">Module</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token class-name">T</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">pay_fee</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">who</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">T</span><span class="token punctuation" style="color:#393A34">::</span><span class="token class-name">AccountId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> amount</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">T</span><span class="token punctuation" style="color:#393A34">::</span><span class="token class-name">Balance</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token class-name">Result</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> _ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token namespace" style="opacity:0.7">balances</span><span class="token namespace punctuation" style="opacity:0.7;color:#393A34">::</span><span class="token class-name">Module</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token class-name">T</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> </span><span class="token class-name">Currency</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">_</span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">withdraw</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">who</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      amount</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">WithdrawReason</span><span class="token punctuation" style="color:#393A34">::</span><span class="token class-name">Fee</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token class-name">ExistenceRequirement</span><span class="token punctuation" style="color:#393A34">::</span><span class="token class-name">KeepAlive</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">Ok</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If we run a local node, we can interact with the module through the <a href="https://polkadot.js.org/apps/" target="_blank" rel="noopener noreferrer">Polkadot UI</a>:</p>
<p><img loading="lazy" alt="Image of Extrinsic Tab" src="/assets/images/substrate-fee-extrinsic-044a3070a671072882b287f968ad9f2e.png" width="2476" height="1500" class="img_ev3q"></p>
<p>We have funded the Bob account with 2000 units, and we are charging a fee of 1337. When we call our function the first time, everything works as expected, and the 1337 unit fee (in addition to the base transaction fee of 1 unit) is removed from the account.</p>
<p><img loading="lazy" alt="Image of Fee Success" src="/assets/images/substrate-fee-success-8bcf960f460759e6886e9be4ac99074a.png" width="2476" height="1500" class="img_ev3q"></p>
<p>However, when Bob does not have enough funds to make a second call, they will see a failure message:</p>
<p><img loading="lazy" alt="Image of Fee Failure" src="/assets/images/substrate-fee-fail-23d785fb776c8d3da0d50b0df6ae9b26.png" width="2476" height="1500" class="img_ev3q"></p>
<blockquote>
<p>Note though that the 1 unit base transaction fee was still removed.</p>
</blockquote>
<p>If we look at our local node terminal, we can see the reason why this transaction failed:</p>
<p><img loading="lazy" alt="Image of Fee Error" src="/assets/images/substrate-fee-error-b0332c67341e4562a0d0812e865054f8.png" width="1512" height="536" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="next-steps">Next Steps<a href="#next-steps" class="hash-link" aria-label="Direct link to Next Steps" title="Direct link to Next Steps">​</a></h2>
<p>As mentioned, this is a very minimal and simplistic implementation of a fee system. However, this should give you the tools necessary to build your own advance fee system. Here are some cool ideas:</p>
<ul>
<li>Create some authorization layer where certain users get lower fees than the average user.</li>
<li>Allow fees to be paid using other tokens that your runtime manages.</li>
<li>Have your fee be calculated based on any input from the user. For example, if you let the user store some <code>Vec&lt;u8&gt;</code>, you can charge them some linear cost based on the length of the data.</li>
</ul>
<p>Do you have other ideas? Let me know!</p>
<p>As always, if you enjoy my content, take a quick look at my <a href="https://shawntabrizi.com/donate/" target="_blank" rel="noopener noreferrer">donation page</a> to help support future work.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/runtime/">runtime</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/module/">module</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/rust/">rust</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/fees/">fees</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/balance/">balance</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/ethereum/">ethereum</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="This post will show you how to use the Oraclize.it blockchain oracle to get and store Twitter posts for Ethereum smart contracts."><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/ethereum/getting-twitter-posts-for-ethereum-using-an-oracle/">Getting Twitter posts for Ethereum using an Oracle</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2018-08-27T05:16:09.000Z" itemprop="datePublished">August 27, 2018</time> · <!-- -->8 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/shawntabrizi" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/shawntabrizi.png" alt="Shawn Tabrizi" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/shawntabrizi" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Shawn Tabrizi</span></a></div><small class="avatar__subtitle" itemprop="description">Software Engineer</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h5 class="anchor anchorWithStickyNavbar_LWe7" id="this-post-will-show-you-how-to-use-the-oraclizeit-blockchain-oracle-to-get-and-store-twitter-posts-for-ethereum-smart-contracts">This post will show you how to use the Oraclize.it blockchain oracle to get and store Twitter posts for Ethereum smart contracts.<a href="#this-post-will-show-you-how-to-use-the-oraclizeit-blockchain-oracle-to-get-and-store-twitter-posts-for-ethereum-smart-contracts" class="hash-link" aria-label="Direct link to This post will show you how to use the Oraclize.it blockchain oracle to get and store Twitter posts for Ethereum smart contracts." title="Direct link to This post will show you how to use the Oraclize.it blockchain oracle to get and store Twitter posts for Ethereum smart contracts.">​</a></h5>
<p>I recently created a end to end working dApp called <a href="https://github.com/shawntabrizi/Ethereum-Twitter-Bounty" target="_blank" rel="noopener noreferrer">&quot;Ethereum Twitter Bounty&quot;</a> as the final project for the <a href="https://consensys.net/academy/2018developer/" target="_blank" rel="noopener noreferrer">ConsenSys 2018 Developer Program</a>. In short, this dApp is a bounty contract which allows people to to pay or get paid to make specific Twitter posts. Imagine a decentralized marketing service where companies or individuals can allow normal users to virally market their product by sharing it with their peers on social networks like Twitter.</p>
<p><img loading="lazy" src="/assets/images/img_5b838a8f8a429-8c53abe431d3d123735d75f01c759206.png" width="2526" height="1014" class="img_ev3q"></p>
<p>The dApp is broken up into two different contracts: one that fetches and stores Twitter posts on the blockchain and one that manages the bounties and validates the fulfillment conditions.</p>
<p>Fulfillment in this contract is pretty straight-forward: we just need to check that the contents of one post is equal to the contents of another. But before we can even do that, we need to fetch the Twitter posts from the internet, and make them accessible to our blockchain contracts.</p>
<p>That is what we will be going over in this blog post.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="ethereum-oracles">Ethereum Oracles<a href="#ethereum-oracles" class="hash-link" aria-label="Direct link to Ethereum Oracles" title="Direct link to Ethereum Oracles">​</a></h2>
<p>Smart Contracts cannot natively talk to the outside world. Any data which you want a smart contract to access must be available on the blockchain. This is a really common problem that comes up when developing new dApps. Things like the current USD price of Ether, generating random numbers, and finding out the result of a real-world event involves the use of an <strong>Oracle</strong>: an external service which provides data to the blockchain.</p>
<p>Oracles are actually pretty easy to understand. They simply listen for requests coming from the blockchain for their services, get the data requested, and return it back to the blockchain in the form of a transaction. Anyone could build their own Oracle service and use it for their own personal needs, but that can be pretty complicated or cumbersome for a user who simply wants to create an Ethereum smart contract and not maintain their own cloud service. Additionally, if you are building a decentralized application which uses a custom made oracle, who is to trust that you are not manipulating the results? You start to lose all of the benefits of smart contracts once you delegate results and processes to the outside world.</p>
<p>This is where <a href="http://www.oraclize.it/" target="_blank" rel="noopener noreferrer">Oraclize.it</a> comes in. They are an open platform for fetching external data, and providing cryptographic proofs of the results. This is particularly important because smart contracts are often in control of a lot of money, and when it comes to triggering contract code, users should be certain of the data flowing into the contract. Oraclize.it also provides all of the libraries and samples required to get started very quickly, which was super convenient for building my final project.</p>
<p>However, <a href="http://docs.oraclize.it/" target="_blank" rel="noopener noreferrer">their documentation</a> was a little lacking, specifically when it came to trying out my specific scenario! Here is what they wrote about fetching Twitter posts using their HTML parser:</p>
<blockquote>
<p>HTML Parser: helper is useful for HTML scraping. The desired XPATH can be specified as argument of <code>xpath(..)</code> as shown in the example:</p>
<p><code>html(https://twitter.com/oraclizeit/status/671316655893561344).xpath(//*[contains(@class, &#x27;tweet-text&#x27;)]/text())</code></p>
</blockquote>
<p>You can actually try this out really quickly on their <a href="http://app.oraclize.it/home/test_query" target="_blank" rel="noopener noreferrer">Test Query</a> page, and on their particular example, it does work okay... but as soon as you try another Twitter posts, things break down quickly. Here is an example of why this XPATH query is bad:</p>
<p><img loading="lazy" src="/assets/images/img_5b833f04ca84f-2f03ef51a5128490d6696442a01892e3.png" width="1282" height="578" class="img_ev3q"></p>
<p>You can see that it is capturing much more than just the original twitter post. All of the replies to the main post also contain the <code>tweet-text</code> class which means that they get picked up by the Oraclize query. Not only does this cost a TON more gas to save to the blockchain, it adds a ton of data which will make it incredibly complicated to validate when a user makes a copy of the post for our scenario. Additionally, some parts of the post like #hashtags and @mentions do not show up, which are also really important for my scenario. So I had to hunt for a better way to parse these posts.</p>
<p>Ultimately, we just need to be more specific about where we grab the text from. Here is an upgraded XPATH query which selects only the main tweet text:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">html(https://twitter.com/&lt;username&gt;/status/&lt;id&gt;).xpath(//div[contains(@class, &#x27;permalink-tweet-container&#x27;)]//p[contains(@class, &#x27;tweet-text&#x27;)]//text())</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The results are much better, but still a little strange... Take a look at this example:</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="twitter-post">Twitter Post<a href="#twitter-post" class="hash-link" aria-label="Direct link to Twitter Post" title="Direct link to Twitter Post">​</a></h4>
<p><img loading="lazy" src="/assets/images/img_5b834588d4946-3719e2710536173ac51c9e73799e77db.png" width="603" height="488" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="oraclize-result">Oraclize Result<a href="#oraclize-result" class="hash-link" aria-label="Direct link to Oraclize Result" title="Direct link to Oraclize Result">​</a></h4>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[&quot;This time, the vacuum tunnel will be a bit longer &amp; SpaceX will provide some advance funding for student teams with most promising designs. Bonus award for all race pods that exceed half the speed of sound!&quot;, &quot;https://&quot;, &quot;twitter.com/hyperloop/stat&quot;, &quot;us/1032818998243520512&quot;, &quot;\u00a0&quot;, &quot;\u2026&quot;]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Note that we only get content from the main post now (yay!), but we still get this strange array format where things like the linked post are broken up into multiple pieces. To demonstrate more of the weird behavior, look at this other example:</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="twitter-post-1">Twitter Post<a href="#twitter-post-1" class="hash-link" aria-label="Direct link to Twitter Post" title="Direct link to Twitter Post">​</a></h4>
<p><img loading="lazy" src="/assets/images/img_5b83469aa1592-f5cb81534c012b3e5659ab8c978df968.png" width="608" height="435" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="oraclize-result-1">Oraclize Result<a href="#oraclize-result-1" class="hash-link" aria-label="Direct link to Oraclize Result" title="Direct link to Oraclize Result">​</a></h4>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[&quot;Amazing news! At &quot;, &quot;#&quot;, &quot;HyperloopUPV&quot;, &quot; we will do our best to be on the top of the &quot;, &quot;@&quot;, &quot;SpaceX&quot;, &quot; &quot;, &quot;#&quot;, &quot;Hyperloop&quot;, &quot; competition this time! &quot;, &quot;@&quot;, &quot;boringcompany&quot;, &quot; &quot;, &quot;@&quot;, &quot;hyperloop&quot;, &quot;\n&quot;, &quot;#&quot;, &quot;HyperloopSpain&quot;, &quot; &quot;, &quot;@&quot;, &quot;UPV&quot;, &quot; &quot;, &quot;#&quot;, &quot;SpaceX&quot;, &quot; &quot;, &quot;#&quot;, &quot;ElonMusk&quot;, &quot; &quot;, &quot;#&quot;, &quot;BreakaPod&quot;]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>It is evident that things like #hashtags and @mentions, while present now, are broken up into different pieces. It is pretty easy to repair this on the front end by treating it as a JavaScript array, and then joining the parts:</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token known-class-name class-name">JSON</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">parse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">&quot;Amazing news! At #HyperloopUPV we will do our best to be on the top of the @SpaceX #Hyperloop competition this time! @boringcompany @hyperloop</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#HyperloopSpain @UPV #SpaceX #ElonMusk #BreakaPod&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">*/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This final result is perfect, and accurately represents what we want. Unfortunately, on the blockchain, the data is still in this array format, and there is no clean, low gas way to change it that I am aware of.</p>
<p>For my purposes, this can cause some validation issues if there are white-space differences between what the user posts and what the fulfiller used to create their bounty. To avoid this, my suggestion is to keep the posts relatively simple. This will also reduce the amount of gas required to store the post on the blockchain.</p>
<p>The final contract code for my &quot;Twitter Oracle&quot; can be found <a href="https://github.com/shawntabrizi/Ethereum-Twitter-Bounty/blob/master/twitter-bounty/contracts/TwitterOracle.sol" target="_blank" rel="noopener noreferrer">here</a>. Here is a relevant snippet:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/// @notice This function initiates the oraclize process for a Twitter post</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// @dev This contract needs ether to be able to call the oracle, which is why this function is also payable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// @param _postId The twitter post to fetch with the oracle. Expecting &quot;&lt;user&gt;/status/&lt;id&gt;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function oraclizeTweet(string _postId)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">payable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">whenNotPaused</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Check if we have enough remaining funds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (oraclize_getPrice(&quot;URL&quot;) &gt; address(this).balance) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        emit LogInfo(&quot;Oraclize query was NOT sent, please add some ETH to cover for the query fee&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        emit LogInfo(&quot;Oraclize query was sent, standing by for the answer..&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Using XPath to to fetch the right element in the JSON response</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        string memory query = string(abi.encodePacked(&quot;html(https://twitter.com/&quot;, _postId, &quot;).xpath(//div[contains(@class, &#x27;permalink-tweet-container&#x27;)]//p[contains(@class, &#x27;tweet-text&#x27;)]//text())&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        bytes32 queryId = oraclize_query(&quot;URL&quot;, query, 6721975);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        queryToPost[queryId] = _postId;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In this code, you can see I have specified a custom gas limit which is extremely high. The default gas limit for the <code>oraclize_query</code> is 200,000 gas, which was causing &quot;out of gas&quot; errors when trying to store the data in the smart contract. I changed the value to be the gas limit for ganache-cli (6,721,975 gas), which is probably not very smart for production, but I did not really invest time into thinking about what a reasonable gas limit would be, and I just wanted to make sure not to run into errors when avoidable.</p>
<p>Take note of another key implementation detail. I get a <code>queryId</code> as a result of <code>oraclize_query</code>. Then I store this value in a mapping, where the value is the Twitter URL (<code>postId</code>) that is being oraclized. This is important because the oraclization process is asynchronous, so when I get a result back from Oraclize.it, I need to know which post the text is for. I then check the mapping I created for the result with a matching <code>queryId</code>, fetch the <code>postId</code>, and then create a mapping using the <code>postId</code> as the key, and the resulting post text as the value. A little tricky, but totally works! :)</p>
<p>Anyway, I hope you learned something from my little exploration into oraclizing Twitter posts for Ethereum dApp development. Try out my app locally by following the instructions on the <a href="https://github.com/shawntabrizi/Ethereum-Twitter-Bounty" target="_blank" rel="noopener noreferrer">GitHub page</a>. If you know of a better way to solve this problem, let me know! Otherwise, if you enjoyed this content, feel free to take a look at my <a href="https://shawntabrizi.com/donate/" target="_blank" rel="noopener noreferrer">donations page</a>.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/blockchain/">blockchain</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/ethereum/">ethereum</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/oraclize/">oraclize</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/programming/">programming</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/smart-contract/">smart contract</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/solidity/">solidity</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/twitter/">twitter</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="My favorite time of the year at Microsoft is the &quot;OneWeek&quot; Hackathon."><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/aad/microsoft-identities-on-the-ethereum-blockchain/">Microsoft Identities on the Ethereum Blockchain</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2018-07-01T06:08:30.000Z" itemprop="datePublished">July 1, 2018</time> · <!-- -->7 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/shawntabrizi" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/shawntabrizi.png" alt="Shawn Tabrizi" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/shawntabrizi" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Shawn Tabrizi</span></a></div><small class="avatar__subtitle" itemprop="description">Software Engineer</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>My favorite time of the year at Microsoft is the &quot;OneWeek&quot; Hackathon.</p>
<p><img loading="lazy" alt="Hackathon Image" src="/assets/images/img_5b386bd8dab8a-3bc02633fda412eab69cff854f234b9d.png" width="842" height="544" class="img_ev3q"></p>
<p>It&#x27;s a time of the year where you can work with some of the most talented engineers around to solve problems that you all agree are awesome.</p>
<p>I have lead a <a href="https://shawntabrizi.com/metime/" target="_blank" rel="noopener noreferrer">different</a> <a href="https://shawntabrizi.com/Skill-Finder/" target="_blank" rel="noopener noreferrer">project</a> every year, some of which have been hinted to in my <a href="https://shawntabrizi.com/code/scraping-linkedin-topics-skills-data/" target="_blank" rel="noopener noreferrer">previous blog posts.</a></p>
<p>This year will be no different.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="hypothesis-microsofts-identity-system-has-value-which-can-be-transferred-to-the-ethereum-blockchain">Hypothesis: Microsoft&#x27;s identity system has value which can be transferred to the Ethereum blockchain<a href="#hypothesis-microsofts-identity-system-has-value-which-can-be-transferred-to-the-ethereum-blockchain" class="hash-link" aria-label="Direct link to Hypothesis: Microsoft&#x27;s identity system has value which can be transferred to the Ethereum blockchain" title="Direct link to Hypothesis: Microsoft&#x27;s identity system has value which can be transferred to the Ethereum blockchain">​</a></h2>
<p>One of the amazing things about identities on Ethereum is that they are free, anonymous, and simple to create. However this also makes them pretty useless when trying to gate access to decentralized applications. There are solutions to combat this problem if you to build a reputation or token staking system around your application, but this usually involves a new identity to undergo significant onboarding before their identity becomes valuable. What if instead of completely recreating new identities, we could bootstrap them using our existing, modern identities?</p>
<p>There is value in Microsoft Identities. I don&#x27;t mean specifically &quot;Microsoft.com accounts&quot;, I mean the identity system that is built by Microsoft, and is used by <a href="https://shawntabrizi.com/aad/does-company-x-have-an-azure-active-directory-tenant/" target="_blank" rel="noopener noreferrer">85% of the Fortune 500</a>. If a user has an account in the Adobe company tenant, then we can pretty confidently say the following:</p>
<ul>
<li>That user is an employee of Adobe</li>
<li>That user&#x27;s identity is managed by a Company Administrator at Adobe</li>
<li>That user&#x27;s information first name, last name, phone number, etc. is relatively accurate</li>
<li>and more...</li>
</ul>
<p>This is actually the very information which powers Microsoft cloud services like Azure, Office 365, and the larger Microsoft Graph ecosystem. It is the same information that millions of apps use to build authentication and single-sign. There is trust because Microsoft has spent the time and energy to build a system with rigorous role based access control (RBAC), and companies have spent their time and energy populating these systems with data which powers their companies.</p>
<p>My hypothesis is that there is value in these Microsoft identities, simply for existing. Not all of them are equally valuable, but for large companies who methodically manage and control that information, the value is actually quite high. The question is then: &quot;How can we migrate this value onto Ethereum?&quot;</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="building-an-attestation-service">Building an attestation service<a href="#building-an-attestation-service" class="hash-link" aria-label="Direct link to Building an attestation service" title="Direct link to Building an attestation service">​</a></h2>
<p>Decentralized identity systems being developed on Ethereum are attempting to solve a number of critically important problems, however they are not attempting to replace all forms of centralization. There will always be some amount of centralization involved with adding claims or attestations to an identity. For example, if you want to prove that you are a US citizen, you will need to go to your state&#x27;s DMV to get an ID card.</p>
<p>In this case, we are interested in employment, and if you want to prove that your are an employee of a certain company, you will need to prove that you are registered within their internal systems. Imagine a middle tier service that accepts a valid authentication token, and associates that with an Ethereum address that the user provides. Then, if you can then make these proofs easily accessible, you then unlock a number of possibilities for dApps to take advantage of that information. Imagine the following user stories:</p>
<ul>
<li>An Ethereum address may want to prove who they are (Name, Company, Role, etc…). They could do this by logging into their corporate Azure Active Directory, and store those claims on the blockchain tied to their account.</li>
<li>Imagine Microsoft (or another company) wants to build a “Kudos” currency which can be used to thank other Microsoft Employees when they do nice things for one another. However, it should only be used between Microsoft employees. Using this identity claim, a smart contract which runs this cryptocurrency could verify that only Microsoft employees are the senders and recipients of the currency.</li>
<li>Imagine Microsoft (or another company) wants to build a decentralized market similar to SellBuy (a Microsoft internal alias for selling items) using the Ethereum blockchain. Similar to the other stories, this decentralized market should only allow people from Microsoft, or other trusted companies to join and list their products on the marketplace. So, the dApp uses these Microsoft Identity claims to gate access to the marketplace.</li>
<li>Imagine a decentralized application like <a href="https://www.teamblind.com/" target="_blank" rel="noopener noreferrer">Blind</a>, where users from different companies can anonymously chat within their own personal and shared forums. On Ethereum, an app like this can be completely censorship free and immutable, a problem that is present with the current Blind app. To ensure that these anonymous users have the right company identifier, we would use the claims about their accounts stored on the blockchain.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-plan">The plan<a href="#the-plan" class="hash-link" aria-label="Direct link to The plan" title="Direct link to The plan">​</a></h2>
<p><img loading="lazy" alt="High level architecture" src="/assets/images/img_5b527aea81ca1-bab6e05f6c37c5f5f33ac6734a63368d.png" width="1385" height="863" class="img_ev3q"></p>
<p>The plan for the hackathon is actually relatively simple, mostly because we will be executing a proof of concept versus a battle tested, production ready design. Let&#x27;s dive deeper into the pieces of the puzzle:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="web-front-end">Web Front End<a href="#web-front-end" class="hash-link" aria-label="Direct link to Web Front End" title="Direct link to Web Front End">​</a></h3>
<p>The sign up process:</p>
<ul>
<li>The user goes to our web front end, and iniates a Microsoft identity login flow</li>
<li>This results in an app + user access token for our middle tier resource, signed by Microsoft&#x27;s identity provider</li>
<li>The user then signs this access token with their Ethereum private key</li>
<li>The web front end then sends a payload to the middle tier service with the access token and the signature for that payload</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="middle-tier-service">Middle Tier Service<a href="#middle-tier-service" class="hash-link" aria-label="Direct link to Middle Tier Service" title="Direct link to Middle Tier Service">​</a></h3>
<p>Registering the user:</p>
<ul>
<li>The middle tier service will recieve a &quot;doubly signed&quot; message, where the entire JWT is signed by the Ethereum address, and the contents of the JWT are signed by Microsoft</li>
<li>It will verify that the token&#x27;s resource is for the middle tier</li>
<li>It will verify that the token was signed by Microsoft</li>
<li>It will verify that the payload has been signed by the Ethereum account</li>
<li>It will parse out specific claims about the user that it wants to store on the blockchain (MVP is Tenant ID)</li>
<li>It will generate a transaction to our back end smart contract to store this data on Ethereum</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="back-end-identity-contract">Back End Identity Contract<a href="#back-end-identity-contract" class="hash-link" aria-label="Direct link to Back End Identity Contract" title="Direct link to Back End Identity Contract">​</a></h3>
<p>Storing the identity information:</p>
<ul>
<li>The back end identity contract will be owned by the middle tier service</li>
<li>It will define an extensible user object</li>
<li>It will have a mapping between Ethereum accounts and that user object</li>
<li>It will expose a getter function for other contracts to access that data</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="corpcoin-contract">CorpCoin Contract<a href="#corpcoin-contract" class="hash-link" aria-label="Direct link to CorpCoin Contract" title="Direct link to CorpCoin Contract">​</a></h3>
<p>Testing our identity system:</p>
<ul>
<li>The CorpCoin contract will be a basic ERC20 token</li>
<li>It will have a requirement that users have to be from a certain company/tenant to interact with the coin</li>
<li>It will interact with our back end identity contract to verify the user&#x27;s company/tenant</li>
<li>It will issue coins to users who have not been issued coins in the past to bootstrap the &#x27;economy&#x27;</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="more-to-come">More to come!<a href="#more-to-come" class="hash-link" aria-label="Direct link to More to come!" title="Direct link to More to come!">​</a></h2>
<p>That is all I am ready to share for now, but note that this is just a very high level overview. There are so many intricacies and details to think about when solving this problem. Here are just a few:</p>
<ul>
<li>How can we automatically remove claims of a user once their off-chain identity has been deleted or removed from a particular group/claim?</li>
<li>How can we store identity claims on the blockchain such that it does not expose sensitive information about the user to people who they do not want to share it with?</li>
<li>What default claims should we be storing, and how can we allow users to extend those claims for their own needs?</li>
<li>How could we decentralize the middle tier service which verifies the user’s Microsoft Identity, to increase trust that the claims stored on the blockchain are real?</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="watch-this-video-to-learn-more">Watch this video to learn more!<a href="#watch-this-video-to-learn-more" class="hash-link" aria-label="Direct link to Watch this video to learn more!" title="Direct link to Watch this video to learn more!">​</a></h2>
<iframe src="https://www.youtube.com/embed/Wg6kg2mLA3k" width="720px" height="480px"></iframe></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/azure-active-directory/">azure active directory</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/blockchain/">blockchain</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/ethereum/">ethereum</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/identity/">identity</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/microsoft/">microsoft</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="In this tutorial, you will learn how to subscribe to an Ethereum WebSocket using Web3.js to dynamically pull pending transactions on the blockchain."><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/ethereum/using-web3-js-1-0-subscribe-and-infura-websockets-to-visualize-ethereum-transactions/">Using Web3.js 1.0 Subscribe and Infura WebSockets to Visualize Ethereum Transactions</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2018-05-25T06:42:19.000Z" itemprop="datePublished">May 25, 2018</time> · <!-- -->5 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/shawntabrizi" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/shawntabrizi.png" alt="Shawn Tabrizi" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/shawntabrizi" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Shawn Tabrizi</span></a></div><small class="avatar__subtitle" itemprop="description">Software Engineer</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h5 class="anchor anchorWithStickyNavbar_LWe7" id="in-this-tutorial-you-will-learn-how-to-subscribe-to-an-ethereum-websocket-using-web3js-to-dynamically-pull-pending-transactions-on-the-blockchain">In this tutorial, you will learn how to subscribe to an Ethereum WebSocket using Web3.js to dynamically pull pending transactions on the blockchain.<a href="#in-this-tutorial-you-will-learn-how-to-subscribe-to-an-ethereum-websocket-using-web3js-to-dynamically-pull-pending-transactions-on-the-blockchain" class="hash-link" aria-label="Direct link to In this tutorial, you will learn how to subscribe to an Ethereum WebSocket using Web3.js to dynamically pull pending transactions on the blockchain." title="Direct link to In this tutorial, you will learn how to subscribe to an Ethereum WebSocket using Web3.js to dynamically pull pending transactions on the blockchain.">​</a></h5>
<p>Recently, I have been pretty lurking on the <a href="https://ethereum.stackexchange.com/" target="_blank" rel="noopener noreferrer">Ethereum StackExchange</a>, and I have been seeing a pretty common question repeat itself.</p>
<blockquote>
<p>How can I detect when a specific transaction occurs on Ethereum?</p>
</blockquote>
<p>It might be that the user wants to see every time their account gets a payment. Or maybe they want track when another contract sends Ether.</p>
<p>By trying to answer this question I learned in <a href="https://web3js.readthedocs.io/en/1.0/index.html" target="_blank" rel="noopener noreferrer">Web3.js 1.0</a> is introducing support for WebSockets, which will allow client applications to have an open and interactive session with the Ethereum blockchain. With WebSockets, you can automatically receive event-driven responses from Ethereum without having to repeatedly poll the blockchain. (<em>As of this writing, Web3.js 1.0 is still in beta.</em>)</p>
<p>As of right now, you can <a href="https://web3js.readthedocs.io/en/1.0/web3-eth-subscribe.html" target="_blank" rel="noopener noreferrer">subscribe to 4 kinds of events</a>: <code>pendingTransactions</code>, <code>newBlockHeaders</code>, <code>syncing</code>, and <code>logs</code>.</p>
<p>Logs are particularly interesting because you can add additional <code>options</code> like an Ethereum address to only get back the logs for that account, which will allow you to really easily monitor when different events happen, such as a payment.</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> subscription </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> web3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">eth</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;logs&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">address</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;0x123456..&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">topics</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;0x12345...&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">error</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> result</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;data&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">log</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">log</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;changed&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">log</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// unsubscribes the subscription</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">subscription</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">unsubscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">error</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> success</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">success</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Successfully unsubscribed!&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="eth-transaction-graph">ETH Transaction Graph<a href="#eth-transaction-graph" class="hash-link" aria-label="Direct link to ETH Transaction Graph" title="Direct link to ETH Transaction Graph">​</a></h2>
<p>I wanted try out this feature, so I decided I would build a little visual which would show transactions on the Ethereum blockchain. I thought it would be cool to let transactions come in, and see if we can start to find addresses which have a ton of activity. A natural visual for transactions is to <a href="https://en.wikipedia.org/wiki/Graph_drawing" target="_blank" rel="noopener noreferrer">draw a graph</a>, and if we do things correctly, we should see these central nodes appear; where tons of different addresses are interacting with a single Ethereum contract or other type of account.</p>
<p>You can check out the web app I built here: <a href="https://shawntabrizi.com/ETH-Transaction-Graph/" target="_blank" rel="noopener noreferrer">https://shawntabrizi.com/ETH-Transaction-Graph/</a>.
Letting it run for a little bit will generate a neat <a href="https://en.wikipedia.org/wiki/Force-directed_graph_drawing" target="_blank" rel="noopener noreferrer">force-directed graph drawing</a> like the one below:</p>
<p><img loading="lazy" alt="Graph Drawing Result" src="/assets/images/img_5b07a77621420-4bfa96558b6d2d2b86f32819464bfec0.png" width="740" height="771" class="img_ev3q"></p>
<p>You can find the source code to this app on <a href="https://github.com/shawntabrizi/ETH-Transaction-Graph" target="_blank" rel="noopener noreferrer">my GitHub</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-does-it-work">How does it work?<a href="#how-does-it-work" class="hash-link" aria-label="Direct link to How does it work?" title="Direct link to How does it work?">​</a></h3>
<p>Before you can do anything with Web3.js, you will need to gain access to an Ethereum WebSocket. This technology is still pretty new, so there aren&#x27;t many options. But you can always rely on <a href="https://infura.io/" target="_blank" rel="noopener noreferrer">Infura</a> to be ahead of the game. Although as of this writing, <a href="https://github.com/INFURA/infura/issues/97" target="_blank" rel="noopener noreferrer">WebSockets on Infura are not quite production ready</a>, they should be in the near future. Connecting to the WebSocket is easy:</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> web3 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Web3</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;wss://mainnet.infura.io/_ws&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><em>Note that it is important you do not include the normal check for <a href="https://metamask.io/" target="_blank" rel="noopener noreferrer">MetaMask</a>, since the browser plugin does not yet support WebSockets.</em></p>
<p>Now that you are connected to your WebSocket, you just need to set up a subscription using Web3.js:</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">subscription </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> web3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">eth</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">subscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;pendingTransactions&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">error</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> result</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;data&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">transactionHash</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        web3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">eth</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getTransaction</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">transactionHash</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">transaction</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">createNode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">transaction</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword module" style="color:#00009f">from</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> transaction</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">to</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Using the code above, I will get a stream of transactions hashes coming to my app. Whenever I get a transaction hash, I use <code>web3.eth.getTransaction</code> to then get data about the transaction. Finally, from that data, I get the <code>to</code> address and the <code>from</code> address. These go into my <code>createNode</code> function which adds the transaction to the graph drawing. I won&#x27;t be going into much details about <a href="https://d3js.org/" target="_blank" rel="noopener noreferrer">D3.js</a>, which generates the graph, because it is black magic to me. (Lots of copy and pasting code to get this sample to work...)</p>
<p>If you are setting up a subscription, don&#x27;t forget to also set up a way to unsubscribe! This is particularly important for my little sample because the browser starts to get REALLY slow once you have a few thousand transactions drawn.</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">subscription</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">unsubscribe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">error</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> success</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">success</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Successfully unsubscribed!&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>That&#x27;s really all you need to know to set up a sample similar to this! I wanted to keep this example as dead simple as possible, but you could imagine a million ways to modify and improve the design here. For example, imagine having each node grow and shrink as Ether is sent to and from the Ethereum Address! If you want to fork my code, I would love to see what kinds of projects you can think of using my sample as a baseline.</p>
<p>As always, I am excited to share with you fun, simple projects in the Ethereum development space, and I would love to hear any and all feedback you have. Know a cool project that you think someone should build and write about? Let me know!</p>
<p>If this post helped you, and you want to say &quot;Thanks!&quot;, take a look at my <a href="https://shawntabrizi.com/donate/" target="_blank" rel="noopener noreferrer">donations page</a>.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/blockchain/">blockchain</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/ethereum/">ethereum</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/graph/">graph</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/html/">html</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/infura/">infura</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/javascript/">javascript</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/web-3/">web3</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/websockets/">websockets</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="In this post I will be summarizing some of the key takeaways from lessons 1 - 5 of the popular CryptoZombies tutorial. This should cover all of the Solidity aspects of building a CryptoKitties clone."><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/ethereum/shawn-notes-cryptozombies-lessons-1-5-in-solidity/">Shawn Notes: CryptoZombies Lessons 1 &amp;#8211; 5 in Solidity</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2018-04-23T09:02:26.000Z" itemprop="datePublished">April 23, 2018</time> · <!-- -->10 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/shawntabrizi" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/shawntabrizi.png" alt="Shawn Tabrizi" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/shawntabrizi" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Shawn Tabrizi</span></a></div><small class="avatar__subtitle" itemprop="description">Software Engineer</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h5 class="anchor anchorWithStickyNavbar_LWe7" id="in-this-post-i-will-be-summarizing-some-of-the-key-takeaways-from-lessons-1---5-of-the-popular-cryptozombies-tutorial-this-should-cover-all-of-the-solidity-aspects-of-building-a-cryptokitties-clone">In this post I will be summarizing some of the key takeaways from lessons 1 - 5 of the popular <a href="https://cryptozombies.io" target="_blank" rel="noopener noreferrer">CryptoZombies tutorial</a>. This should cover all of the Solidity aspects of building a CryptoKitties clone.<a href="#in-this-post-i-will-be-summarizing-some-of-the-key-takeaways-from-lessons-1---5-of-the-popular-cryptozombies-tutorial-this-should-cover-all-of-the-solidity-aspects-of-building-a-cryptokitties-clone" class="hash-link" aria-label="Direct link to in-this-post-i-will-be-summarizing-some-of-the-key-takeaways-from-lessons-1---5-of-the-popular-cryptozombies-tutorial-this-should-cover-all-of-the-solidity-aspects-of-building-a-cryptokitties-clone" title="Direct link to in-this-post-i-will-be-summarizing-some-of-the-key-takeaways-from-lessons-1---5-of-the-popular-cryptozombies-tutorial-this-should-cover-all-of-the-solidity-aspects-of-building-a-cryptokitties-clone">​</a></h5>
<p>This post should not act as a replacement for taking the course, which I strongly recommend you do. Instead this will be a good way to keep some of the new concepts and best practices fresh in your mind if you are jumping into a new Solidity project. This post will be written assuming that the reader is relatively versed in other programming languages so things like the modular function, if/else statements, and for loops wont be included.</p>
<p>Really I want to use this post as a way for me to look back and refresh my memory the next time I jump on a Solidity project.</p>
<p>So let&#x27;s get started!</p>
<p><img loading="lazy" src="/assets/images/img_5add32b676792-af10f97b235546d70006b52afda0c688.png" width="618" height="1093" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="lesson-1-summary">Lesson 1 Summary<a href="#lesson-1-summary" class="hash-link" aria-label="Direct link to Lesson 1 Summary" title="Direct link to Lesson 1 Summary">​</a></h2>
<ul>
<li>
<p>Use <code>pragma solidity ^</code> to define the version of Solidity you want to use</p>
</li>
<li>
<p>Create a contract using <code>contract contractName {}</code></p>
</li>
<li>
<p><code>uint</code> is an alias for <code>uint256</code>. You can also individually specify <code>uint8</code>, <code>uint16</code>, etc...</p>
</li>
<li>
<p>Exponential operator in Solidity is <code>**</code>, i.e. <code>uint x = 5 **2; // equal to 5^2 = 25</code></p>
</li>
<li>
<p>Structs are available in Solidity and can be defined like:</p>
<div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">struct Person {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	uint age;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	string name;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Fixed (<code>uint[2] fixedArray</code>)  and dynamic arrays (<code>uint[] dynamicArray</code>) are both available in Solidity.</p>
</li>
<li>
<p>You can also create an array of structs.</p>
</li>
<li>
<p>If you declare an array as <code>public</code>, Solidity will automatically create a getter method for it.</p>
</li>
<li>
<p>You can define a function within a contract like so:</p>
<div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">function eatHamburgers(string _name, uint _amount) {...}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>It is convention to start function parameter variable names with an underscore (<code>_</code>), differentiating them from global variables.</p>
</li>
<li>
<p>Functions are <code>public</code> by default, which means anyone can call them. Usually you want to mark your functions <code>private</code> by default, and only make functions public if you want to expose them to others. We also start private functions with an underscore (<code>_</code>) by convention.</p>
</li>
<li>
<p>You need to declare the type of value a function will return if it returns a value like so:</p>
<div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">function sayHello() public returns (string) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	return greeting;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>If a function does not change any values or write anything, we can additionally label the function as a <code>view</code> function.</p>
</li>
<li>
<p>If the function doesn&#x27;t even read from the state of the app, and only uses the function parameters we can label it <code>pure</code>.</p>
</li>
<li>
<p>Both <code>view</code> and <code>pure</code> functions can help users save gas when using your contract. More about this in lesson 3.</p>
</li>
<li>
<p>Typecasting is available in Solidity by wrapping a variable with the type, i.e. <code>uint8(var)</code>.</p>
</li>
<li>
<p>You can use events to communicate that something has happened on the blockchain. This is particularly useful when creating a front-end for your Solidity application.</p>
<div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// declare the event</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">event IntegersAdded(uint x, uint y, uint result);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function add(uint _x, uint _y) public {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	uint result = _x + _y;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	// fire an event to let the app know the function was called:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	IntegersAdded(_x, _y, result);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	return result;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="lesson-2-summary">Lesson 2 Summary<a href="#lesson-2-summary" class="hash-link" aria-label="Direct link to Lesson 2 Summary" title="Direct link to Lesson 2 Summary">​</a></h2>
<ul>
<li>
<p>In Solidity, there is a variable type <code>address</code>, that is a unique id to represent an Ethereum account.</p>
</li>
<li>
<p>Solidity has the concept of a <code>mapping</code>, which is like a hash table, <a href="https://solidity.readthedocs.io/en/develop/types.html#mappings" target="_blank" rel="noopener noreferrer">but a little different</a>.</p>
<div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// For a financial app, storing a uint that holds the user&#x27;s account balance:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mapping (address =&gt; uint) public accountBalance;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>You can use <code>msg.sender</code> to refer to the address of the person or smart contract that called a particular function.</p>
</li>
<li>
<p>We can make functions throw an error if a condition is not true using <code>require();</code>.</p>
</li>
<li>
<p>You can use the inheritance phrase <code>is</code> to split up your contracts into a more object-oriented design.</p>
<div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">contract Doge {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	function catchphrase() public returns (string) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	return &quot;So Wow CryptoDoge&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">contract BabyDoge is Doge {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	function anotherCatchphrase() public returns (string) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	return &quot;Such Moon BabyDoge&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>You can also split up your code into multiple files using the <code>import</code> keyword, referencing the other Solidity files.</p>
</li>
<li>
<p>There are two places you can store variables: <code>storage</code> and <code>memory</code>.  <code>storage</code> being permanently written information in the blockchain, and <code>memory</code> being temporary data which disappears at the end of a function call.</p>
</li>
<li>
<p>In addition to <code>public</code> and <code>private</code>, functions can also be <code>internal</code> or <code>external</code>. <code>internal</code> is the same as <code>private</code> except that it is also accessible to contracts which inherit from the one that contains this function. <code>external</code> is similar to <code>public</code> except that they can only be called outside the contract, not by functions inside the contract.</p>
</li>
<li>
<p>You can define an <code>interface</code> to allow one contract to talk to another that we do not own.</p>
<div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">interface NumberInterface {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	function getNum(address _myAddress) public view returns (uint);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">contract MyContract {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	address NumberInterfaceAddress = 0xab38...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	// ^ The address of the FavoriteNumber contract on Ethereum</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	NumberInterface numberContract = NumberInterface(NumberInterfaceAddress);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	// Now `numberContract` is pointing to the other contract</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	function someFunction() public {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		// Now we can call `getNum` from that contract:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		uint num = numberContract.getNum(msg.sender);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		// ...and do something with `num` here</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>You can have functions return multiple variables and do multiple assignments using this format:</p>
<div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">function multipleReturns() internal returns(uint a, uint b, uint c) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	return (1, 2, 3);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function processMultipleReturns() external {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	uint a;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	uint b;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	uint c;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	// This is how you do multiple assignment:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	(a, b, c) = multipleReturns();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Or if we only cared about one of the values:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function getLastReturnValue() external {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	uint c;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	// We can just leave the other fields blank:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	(,,c) = multipleReturns();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="lesson-3-summary">Lesson 3 Summary<a href="#lesson-3-summary" class="hash-link" aria-label="Direct link to Lesson 3 Summary" title="Direct link to Lesson 3 Summary">​</a></h2>
<ul>
<li>
<p>Ethereum contracts are immutable, so it may make sense to break apart your project into multiple contracts, where individual parts could get updated later by referencing a new contract with updated code.</p>
</li>
<li>
<p>It is common practice to add ownership to contracts. One such library that adds this functionality out of the box is <a href="https://github.com/OpenZeppelin/zeppelin-solidity/blob/master/contracts/ownership/Ownable.sol" target="_blank" rel="noopener noreferrer">OpenZeppelin&#x27;s Ownable.sol</a>.</p>
</li>
<li>
<p>Constructors are a special kind of function that has the same name as the contract and will only execute one time: when the contract is first created.</p>
</li>
<li>
<p>A <code>modifier</code> is logic that can be applied on top of a function, usually to check requirements before the function actually executes.</p>
</li>
<li>
<p>Function <code>modifier</code>s can also accept arguments.</p>
<div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// A mapping to store a user&#x27;s age:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mapping (uint =&gt; uint) public age;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Modifier that requires this user to be older than a certain age:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">modifier olderThan(uint _age, uint _userId) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	require(age[_userId] &gt;= _age);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	_;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Must be older than 16 to drive a car (in the US, at least).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// We can call the `olderThan` modifier with arguments like so:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function driveCar(uint _userId) public olderThan(16, _userId) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	// Some function logic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Transactions on Ethereum are not free, and running functions or storing values on the blockchain require <code>gas</code>.</p>
</li>
<li>
<p>Normally, Solidity will reserve 256 bits of storage no matter what variable sub-type you use, so you will not save on gas.</p>
</li>
<li>
<p>The exception to this rule is in a <code>struct</code>, where Solidity will package multiple smaller variables together.</p>
</li>
<li>
<p>Solidity uses unix time, and has built into the language time units like <code>seconds</code>, <code>minutes</code>, <code>hours</code>, <code>days</code>, <code>weeks</code>, <code>years</code>.</p>
</li>
<li>
<p>You can also call <code>now</code>, which will return the current unix time for that block.</p>
</li>
<li>
<p>Earlier we mentioned that we can label functions with <code>view</code> if they are read only functions. Solidity also makes <code>view</code> functions free to call, therefore, wherever possible, make sure to make your functions <code>external view</code>. The same applies to <code>pure</code> functions.</p>
</li>
<li>
<p>When you write to <code>storage</code>, it takes a ton of gas. The tutorial states:</p>
<blockquote>
<p>In order to keep costs down, you want to avoid writing data to storage except when absolutely necessary. Sometimes this involves seemingly inefficient programming logic — like rebuilding an array in <code>memory</code> every time a function is called instead of simply saving that array in a variable for quick lookups.</p>
</blockquote>
</li>
<li>
<p>With the current version of Solidity, <code>memory</code> arrays must be fixed length.</p>
</li>
<li>
<p>CryptoZombies then talks about the correct way to implement mapping zombies to owners, it is a little long so I won&#x27;t summarize it here.</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="lesson-4-summary">Lesson 4 Summary<a href="#lesson-4-summary" class="hash-link" aria-label="Direct link to Lesson 4 Summary" title="Direct link to Lesson 4 Summary">​</a></h2>
<ul>
<li>
<p>You can mark a function as <code>payable</code> which will allow the function to accept Ether payments. Otherwise, the function will reject all transactions containing Ether.</p>
</li>
<li>
<p>The amount of ether sent to the contract can be viewed using <code>msg.value</code>.</p>
<div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">contract OnlineStore {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	function buySomething() external payable {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		// Check to make sure 0.001 ether was sent to the function call:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		require(msg.value == 0.001 ether);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		// If so, some logic to transfer the digital item to the caller of the function:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		transferThing(msg.sender);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>You can use <code>this.balance</code> to get the amount of ether available in the contract.</p>
</li>
<li>
<p>You can use the <code>transfer</code> function to send funds to any Ethereum address.</p>
<div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">contract GetPaid is Ownable {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	function withdraw() external onlyOwner {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		owner.transfer(this.balance);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>You can use <code>keccak256</code> for random number generation, but it is exploitable, so only use it in non-critical scenarios.</p>
</li>
<li>
<p>The rest of this lesson is about implementing specific game functionality in CryptoZombies and refactoring old code, which I wont go into here.</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="lesson-5-summary">Lesson 5 Summary<a href="#lesson-5-summary" class="hash-link" aria-label="Direct link to Lesson 5 Summary" title="Direct link to Lesson 5 Summary">​</a></h2>
<ul>
<li>
<p><a href="https://github.com/ethereum/EIPs/blob/master/EIPS/eip-20.md" target="_blank" rel="noopener noreferrer">ERC20</a> tokens are great for representing alternative currencies within Ethereum.</p>
</li>
<li>
<p><a href="https://github.com/ethereum/EIPs/blob/master/EIPS/eip-721.md" target="_blank" rel="noopener noreferrer">ERC721</a> tokens are good for representing collectables and other non-fungible assets.</p>
</li>
<li>
<p>Solidity contracts can inherit from multiple contracts like so:</p>
<div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">contract ZombieOwnership is ZombieAttack, ERC721 {...}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>You need to define the functions which make the token ERC721 compatible, and the logic may change depending on the specific implementation and functionality of your token. I will not go into these details.</p>
</li>
<li>
<p>You cannot have function modifiers with the same name.</p>
</li>
<li>
<p>You should use another <a href="https://github.com/OpenZeppelin/zeppelin-solidity/blob/master/contracts/math/SafeMath.sol" target="_blank" rel="noopener noreferrer">OpenZeppelin library called SafeMath</a> to prevent overflows and underflows which may lead to security vulnerabilities.</p>
</li>
<li>
<p>SafeMath uses the <code>assert</code> statement to make sure that the result of math functions are as we would suspect.</p>
<div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">function add(uint256 a, uint256 b) internal pure returns (uint256) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	uint256 c = a + b;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	assert(c &gt;= a);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	return c;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p><code>assert</code> is similar to <code>require</code> in that it will throw an error if false, however <code>assert</code> will not refund unused gas when a function fails.</p>
</li>
<li>
<p>You will need to define the SafeMath library for each different type of <code>uint</code> you use in your contract. As is, SafeMath will only work on <code>uint256</code>.</p>
</li>
<li>
<p>You can add comments to Solidity code using <code>//</code> or multi-line comments with <code>/* ... */</code>.</p>
</li>
<li>
<p>The standard way to format your comments among the Solidity community is the <a href="https://github.com/ethereum/wiki/wiki/Ethereum-Natural-Specification-Format" target="_blank" rel="noopener noreferrer">Ethereum Natural Specification Format</a>.</p>
</li>
</ul>
<h1>That&#x27;s all folks!</h1>
<p>Again, I strongly recommend that you follow the <a href="https://cryptozombies.io" target="_blank" rel="noopener noreferrer">CryptoZombies tutorial</a>. It is funny, comprehensive, and very informative. I talked about a lot of the Solidity specific knowledge that CryptoZombies teaches, but I leave out the most critical learning aspect: Designing and implementing a game using Solidity. This you can only learn by completing the full tutorial.</p>
<ul>
<li>Did this post help you?</li>
<li>Did I miss a critical piece of knowledge?</li>
<li>Did I make a mistake?</li>
</ul>
<p>Let me know, and as always, if you like what I do, you can send me a friendly thanks in the <a href="https://shawntabrizi.com/donate/" target="_blank" rel="noopener noreferrer">form of a donation</a> :)</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/blockchain/">blockchain</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/cryptozombies/">cryptozombies</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/ethereum/">ethereum</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/programming/">programming</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/shawn-notes/">shawn notes</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/solidity/">solidity</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="This tutorial will show you how you can query the ETH balance of an Ethereum address across multiple Ethereum blocks, and visualize the results as a graph."><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/ethereum/graphing-eth-balance-history-of-an-ethereum-address-using-parallel-asynchronous-requests-in-web3-js/">Graphing ETH Balance History of an Ethereum Address using Parallel Asynchronous Requests in Web3.js</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2018-03-12T06:31:35.000Z" itemprop="datePublished">March 12, 2018</time> · <!-- -->6 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/shawntabrizi" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/shawntabrizi.png" alt="Shawn Tabrizi" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/shawntabrizi" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Shawn Tabrizi</span></a></div><small class="avatar__subtitle" itemprop="description">Software Engineer</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h5 class="anchor anchorWithStickyNavbar_LWe7" id="this-tutorial-will-show-you-how-you-can-query-the-eth-balance-of-an-ethereum-address-across-multiple-ethereum-blocks-and-visualize-the-results-as-a-graph">This tutorial will show you how you can query the ETH balance of an Ethereum address across multiple Ethereum blocks, and visualize the results as a graph.<a href="#this-tutorial-will-show-you-how-you-can-query-the-eth-balance-of-an-ethereum-address-across-multiple-ethereum-blocks-and-visualize-the-results-as-a-graph" class="hash-link" aria-label="Direct link to This tutorial will show you how you can query the ETH balance of an Ethereum address across multiple Ethereum blocks, and visualize the results as a graph." title="Direct link to This tutorial will show you how you can query the ETH balance of an Ethereum address across multiple Ethereum blocks, and visualize the results as a graph.">​</a></h5>
<p>Continuing my series of simple to consume <a href="https://shawntabrizi.com/ethereum/ethereum-web3-js-hello-world-get-eth-balance-ethereum-address/" target="_blank" rel="noopener noreferrer">Web3.js tutorials</a>, I want to now look into how we can start to visualize data from the Ethereum blockchain. In the past month or so, a bunch of ponzi scheme Ethereum contracts have been popping. The first notable one was POWHcoin which had the following brilliant whitepaper:</p>
<p><img loading="lazy" src="/assets/images/img_5acdcc67280aa-bc5e9998f4e067f88cc12d7cb58f38d9.png" width="579" height="461" class="img_ev3q"></p>
<p>This made me wonder what the actual graph of this Ethereum smart contract looked like...</p>
<p>Unfortunately, this smart contract eventually got hacked, so we won&#x27;t quite be able to see the peaks and valleys like the picture above shows, but we will be able to see the contract get completely liquidated, which may be interesting itself.</p>
<p>Let&#x27;s build it!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="getting-the-ether-balance-at-a-certain-block">Getting the ether balance at a certain block<a href="#getting-the-ether-balance-at-a-certain-block" class="hash-link" aria-label="Direct link to Getting the ether balance at a certain block" title="Direct link to Getting the ether balance at a certain block">​</a></h2>
<p>The main thing we need to do here is get the ETH balance of an address at a specific block. This is actually quite easy by extending the call we make in my first tutorial:</p>
<p><a href="https://github.com/ethereum/wiki/wiki/JavaScript-API#web3ethgetbalance" target="_blank" rel="noopener noreferrer"><strong>web3.eth.getBalance</strong></a></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">web3.eth.getBalance(addressHexString [, defaultBlock] [, callback])</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>So if we simply pass a block number into this function, we should be able to get the balance at that point in time.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="getting-the-first-transaction-for-an-ethereum-address">Getting the first transaction for an Ethereum address<a href="#getting-the-first-transaction-for-an-ethereum-address" class="hash-link" aria-label="Direct link to Getting the first transaction for an Ethereum address" title="Direct link to Getting the first transaction for an Ethereum address">​</a></h2>
<p>Before we create a loop getting the various balances, we need to know where to start looking. We could start at block 0, but we will get a ton of empty data before the address was ever used. Unfortunately, Web3.js does not have a good way to query the first transaction of an Ethereum address, so we will use Etherscan&#x27;s API to get that information. Note that if you want to do this entirely with Web3, you can, you will just need to create a smart searching algorithm, and look at a ton of blocks... probably not very efficient.</p>
<p><a href="https://etherscan.io/apis#accounts" target="_blank" rel="noopener noreferrer"><strong>Etherescan Developer APIs:</strong> Accounts</a></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">https://api.etherscan.io/api?module=account&amp;action=txlist&amp;address=0xA7CA36F7273D4d38fc2aEC5A454C497F86728a7A&amp;startblock=0&amp;page=1&amp;offset=1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This query, which includes the POWHcoin address, will return the first transaction of that address, which is the contract creation. You can verify it is a contract creation call because the <code>to</code> value is empty, and the <code>contractAddress</code> is populated and matches the address we are observing.</p>
<p>Now we know to start looking at block 499258.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="get-the-current-block-number">Get the current block number<a href="#get-the-current-block-number" class="hash-link" aria-label="Direct link to Get the current block number" title="Direct link to Get the current block number">​</a></h2>
<p>Really the last piece of information we need is the current block number, so we know where to end our loop. This information is also available via Web3.js with the following call:</p>
<p><a href="https://github.com/ethereum/wiki/wiki/JavaScript-API#web3ethblocknumber" target="_blank" rel="noopener noreferrer"><strong>web3.eth.blockNumber</strong></a></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">web3.eth.getBlockNumber(callback(error, result){ ... })</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="so-lets-make-a-simple-loop">So let&#x27;s make a simple loop:<a href="#so-lets-make-a-simple-loop" class="hash-link" aria-label="Direct link to So let&#x27;s make a simple loop:" title="Direct link to So let&#x27;s make a simple loop:">​</a></h2>
<p>Here is a simple implementation of what we want to accomplish:</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Check for MetaMask, otherwise use an HTTP Provider</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;load&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">typeof</span><span class="token plain"> web3 </span><span class="token operator" style="color:#393A34">!==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;undefined&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Web3 Detected! &#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> web3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">currentProvider</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">constructor</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">web3</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Web3</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">web3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">currentProvider</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;No Web3 Detected... using HTTP Provider&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">web3</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Web3</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Web3</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">providers</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">HttpProvider</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;https://mainnet.infura.io/&lt;APIKEY&gt;&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Wrapper for Web3 callback</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">promisify</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">inner</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Promise</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">resolve</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> reject</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">inner</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">err</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> res</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">reject</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">resolve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">res</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Get the first transaction block for an address</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getFirstBlock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">address</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">fetch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;https://api.etherscan.io/api?module=account&amp;action=txlist&amp;address=&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> address </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&amp;startblock=0&amp;page=1&amp;offset=10&amp;sort=asc&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">json</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">result</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">blockNumber</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Given an address and a range of blocks, query the Ethereum blockchain for the ETH balance across the range</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getBalanceInRange</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">address</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> startBlock</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> endBlock</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Number of points to fetch between block range</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> pointCount </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">50</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Calculate the step size given the range of blocks and the number of points we want</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> step </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token known-class-name class-name">Math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">floor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">endBlock </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> startBlock</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> pointCount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Make sure step is at least 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">step </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        step </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Store the final result here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> balances </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Loop over the blocks, using the step value</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> startBlock</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> endBlock</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> step</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Get the ETH value at that block</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> wei </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">promisify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">cb</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> web3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">eth</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getBalance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">address</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cb</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> ether </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">parseFloat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">web3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">fromWei</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">wei</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;ether&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Add result to final output</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        balances</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token literal-property property" style="color:#36acaa">block</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token literal-property property" style="color:#36acaa">balance</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> ether</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> balances</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Main function</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">graphBalance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Ethereum Address we want to look at</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> address </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;0xA7CA36F7273D4d38fc2aEC5A454C497F86728a7A&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Find the intial range, from first block to current block</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> startBlock </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">parseInt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getFirstBlock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">address</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> endBlock </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">parseInt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">promisify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">cb</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> web3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">eth</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getBlockNumber</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cb</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> balances </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getBalanceInRange</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">address</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> startBlock</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> endBlock</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">balances</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">graphBalance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>And the output we get is:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[{&quot;block&quot;:4990258,&quot;balance&quot;:0},{&quot;block&quot;:4995223,&quot;balance&quot;:690.3946401936848},{&quot;block&quot;:5000188,&quot;balance&quot;:812.2356284509416},{&quot;block&quot;:5005153,&quot;balance&quot;:1033.1702951440611},{&quot;block&quot;:5010118,&quot;balance&quot;:74.00248959231331},{&quot;block&quot;:5015083,&quot;balance&quot;:0.23714259262709267},{&quot;block&quot;:5020048,&quot;balance&quot;:0.000334978488623982},{&quot;block&quot;:5025013,&quot;balance&quot;:0.005036602641690202},{&quot;block&quot;:5029978,&quot;balance&quot;:0.005036602641690202},{&quot;block&quot;:5034943,&quot;balance&quot;:0.0526236993093083},{&quot;block&quot;:5039908,&quot;balance&quot;:0.04323124310148216},{&quot;block&quot;:5044873,&quot;balance&quot;:0.06245124310148216},{&quot;block&quot;:5049838,&quot;balance&quot;:0.06283124310148216},{&quot;block&quot;:5054803,&quot;balance&quot;:0.004397267827962452},{&quot;block&quot;:5059768,&quot;balance&quot;:0.004397267827962452},{&quot;block&quot;:5064733,&quot;balance&quot;:0.004397267827962452},{&quot;block&quot;:5069698,&quot;balance&quot;:0.03639726782796245},{&quot;block&quot;:5074663,&quot;balance&quot;:0.03639726782796245},{&quot;block&quot;:5079628,&quot;balance&quot;:0.03919726782796245},{&quot;block&quot;:5084593,&quot;balance&quot;:0.03919726782796245},{&quot;block&quot;:5089558,&quot;balance&quot;:0.04199726782796245},{&quot;block&quot;:5094523,&quot;balance&quot;:0.04205726782796245},{&quot;block&quot;:5099488,&quot;balance&quot;:0.04205726782796245},{&quot;block&quot;:5104453,&quot;balance&quot;:0.5869572678279624},{&quot;block&quot;:5109418,&quot;balance&quot;:0.000534060075850865},{&quot;block&quot;:5114383,&quot;balance&quot;:0.000534060075850865},{&quot;block&quot;:5119348,&quot;balance&quot;:0.000534060075850865},{&quot;block&quot;:5124313,&quot;balance&quot;:0.000534060075850865},{&quot;block&quot;:5129278,&quot;balance&quot;:0.000534060075850865},{&quot;block&quot;:5134243,&quot;balance&quot;:0.000534060075850865},{&quot;block&quot;:5139208,&quot;balance&quot;:0.02642294883092996},{&quot;block&quot;:5144173,&quot;balance&quot;:0.026442948830929958},{&quot;block&quot;:5149138,&quot;balance&quot;:0.026442948830929958},{&quot;block&quot;:5154103,&quot;balance&quot;:0.026442948830929958},{&quot;block&quot;:5159068,&quot;balance&quot;:0.03494294883092996},{&quot;block&quot;:5164033,&quot;balance&quot;:0.03993222727211795},{&quot;block&quot;:5168998,&quot;balance&quot;:0.04793222727211795},{&quot;block&quot;:5173963,&quot;balance&quot;:0.04793222727211795},{&quot;block&quot;:5178928,&quot;balance&quot;:0.04793222727211795},{&quot;block&quot;:5183893,&quot;balance&quot;:0.04793222727211795},{&quot;block&quot;:5188858,&quot;balance&quot;:0.04076568624207472},{&quot;block&quot;:5193823,&quot;balance&quot;:0.04076568624207472},{&quot;block&quot;:5198788,&quot;balance&quot;:0.04076568624207472},{&quot;block&quot;:5203753,&quot;balance&quot;:0.04076568624207472},{&quot;block&quot;:5208718,&quot;balance&quot;:0.04076568624207472},{&quot;block&quot;:5213683,&quot;balance&quot;:0.04076568624207472},{&quot;block&quot;:5218648,&quot;balance&quot;:0.04076568624207472},{&quot;block&quot;:5223613,&quot;balance&quot;:0.04076568624207472},{&quot;block&quot;:5228578,&quot;balance&quot;:0.04076568624207472},{&quot;block&quot;:5233543,&quot;balance&quot;:0.04076568624207472},{&quot;block&quot;:5238508,&quot;balance&quot;:0.04076568624207472}]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Looks good so far! But if you run the code yourself, you will feel how dreadfully slow it is... That is because we are essentially doing a serial query, waiting around 100ms for every data-point:</p>
<p><img loading="lazy" src="/assets/images/img_5aa5b062b26a2-638e1b62aee3f7fd6a55462edd6b139c.png" width="901" height="700" class="img_ev3q"></p>
<p>But we can dramatically improve this by making the Web3.js requests asynchronous and in parallel!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="web3js-asynchronous-and-parallel-calls">Web3.js Asynchronous and Parallel Calls<a href="#web3js-asynchronous-and-parallel-calls" class="hash-link" aria-label="Direct link to Web3.js Asynchronous and Parallel Calls" title="Direct link to Web3.js Asynchronous and Parallel Calls">​</a></h2>
<p>We will need to update our <code>getBalanceInRange</code> function. Instead of <code>await</code>ing the balance data within each loop, we should simply queue up all of the requests, and then have them be processed at once with <code>Promise.all</code>.</p>
<p>So our new loop would look something like this:</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Given an address and a range of blocks, query the Ethereum blockchain for the ETH balance across the range</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getBalanceInRange</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">address</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> startBlock</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> endBlock</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Number of points to fetch between block range</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> pointCount </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">50</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Calculate the step size given the range of blocks and the number of points we want</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> step </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token known-class-name class-name">Math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">floor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">endBlock </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> startBlock</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> pointCount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Make sure step is at least 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">step </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        step </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Queue the promises here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> promises </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Loop over the blocks, using the step value</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> startBlock</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> endBlock</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> step</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Create a promise to query the ETH balance for that block</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> promise </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">promisify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">cb</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> web3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">eth</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getBalance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">address</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cb</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Queue the promise and include data about the block for output</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        promises</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">promise</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">wei</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token literal-property property" style="color:#36acaa">block</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token literal-property property" style="color:#36acaa">balance</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">parseFloat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">web3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">fromWei</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">wei</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;ether&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Resolve all promises in parellel</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> balances </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token known-class-name class-name">Promise</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">all</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">promises</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> balances</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Running this is MUCH faster, and the parallel nature of the calls can be seen in the network traces:</p>
<p><img loading="lazy" src="/assets/images/img_5aa5b09b0bb6f-fa68350f44c55601c39783ecda94408b.png" width="889" height="680" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="final-result">Final Result<a href="#final-result" class="hash-link" aria-label="Direct link to Final Result" title="Direct link to Final Result">​</a></h2>
<p>From there, you just need to pipe the data into your favorite JavaScript graph library, and you will get a view like this:</p>
<p><img loading="lazy" src="/assets/images/img_5aa5ad6c84572-e9ad611e1ce172128285a24f067dcdaf.png" width="871" height="443" class="img_ev3q"></p>
<p>Here you can see the quick rise of the ponzi scheme, the sell offs of &#x27;weak hands&#x27;, and finally the contract getting hacked and liquidating all the funds.</p>
<p>I will not go into detail about making this graph in this tutorial, but you can see my final app here:</p>
<p><a href="https://shawntabrizi.com/ethgraph/?address=0xA7CA36F7273D4d38fc2aEC5A454C497F86728a7A&amp;start=4990258&amp;end=5010862" target="_blank" rel="noopener noreferrer">https://shawntabrizi.com/ethgraph/?address=0xA7CA36F7273D4d38fc2aEC5A454C497F86728a7A&amp;start=4990258&amp;end=5010862</a></p>
<p>You can find the source code here:</p>
<p><a href="https://github.com/shawntabrizi/ETH-Balance-Graph" target="_blank" rel="noopener noreferrer">https://github.com/shawntabrizi/ETH-Balance-Graph</a></p>
<p>If you have any suggestions, or find any bugs please let me know! If you found this short tutorial helpful, feel free to send a donation using the information <a href="https://shawntabrizi.com/donate/" target="_blank" rel="noopener noreferrer">here</a>.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/ethereum/">ethereum</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/javascript/">javascript</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/web-3/">web3</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="A common question that I have for others investing in cryptocurrencies is: &quot;What coins are you invested in?&quot;"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/ethereum/ethfolio-client-side-app-show-ethereum-token-distribution/">ethfolio: A client side app to show your Ethereum token distribution</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2017-12-04T15:54:33.000Z" itemprop="datePublished">December 4, 2017</time> · <!-- -->4 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/shawntabrizi" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/shawntabrizi.png" alt="Shawn Tabrizi" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/shawntabrizi" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Shawn Tabrizi</span></a></div><small class="avatar__subtitle" itemprop="description">Software Engineer</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>A common question that I have for others investing in cryptocurrencies is: <em>&quot;What coins are you invested in?&quot;</em></p>
<p>It is surprisingly hard to distinguish fear, uncertainty, doubt (FUD), fear of missing out (FOMO), and solid informed advice apart from one another. But as the saying goes:</p>
<blockquote>
<p>Put your money where your mouth is.</p>
</blockquote>
<p>This is the goal of ethfolio:</p>
<ul>
<li>Allow users to easily import the coins they currently are holding</li>
<li>Allow users to share this token distribution</li>
<li>And do so safely without needing to expose their Ethereum addresses or total value of their holdings</li>
</ul>
<p>This actually seemed very straightforward, so I decided to tackle the project. Rather than go through all the work to actually query the blockchain as I have been learning to do in my other posts, I decided to just use an API which consolidates all this information.</p>
<p><a href="https://ethplorer.io/" target="_blank" rel="noopener noreferrer">Ethplorer.io</a> was perfect for this. They have a <code>/getAddressInfo/</code> <a href="https://github.com/EverexIO/Ethplorer/wiki/Ethplorer-API?from=etop" target="_blank" rel="noopener noreferrer">api endpoint</a> which provides details about the tokens at an Ethereum address, and even details about those tokens like the price in USD.</p>
<p>This was perfect! So I begin to envision the user story:</p>
<ol>
<li>User goes to ethfolio, types in one or more Ethereum addresses</li>
<li>User presses a &quot;submit&quot; button</li>
<li>In the background we query the Ethplorer API to get all the tokens across all the addresses, and their current price in USD</li>
<li>We then add up total amount of each token the user has across their wallets</li>
<li>Then, we use the price information, to calculate the relative USD price of each token balance</li>
<li>Then we calculate the total USD price across all balances, to find the percentage a particular token represents in the overall portfolio</li>
<li>Display the results</li>
</ol>
<p>Following this process, the user can then share details about their token distribution without ever needing to share details about their specific addresses (which is important for anonymity) and without needing to share details about the total balance they hold (which could be sensitive to the user.)</p>
<p>With these steps in mind, I spent a day and created this pretty quickly:</p>
<p><a href="https://shawntabrizi.com/ethfolio/" target="_blank" rel="noopener noreferrer">https://shawntabrizi.com/ethfolio/</a></p>
<p><img loading="lazy" src="/assets/images/img_5a24f8f17ea4a-1137adf635f48a4d312122bbf1d000d9.png" width="829" height="688" class="img_ev3q"></p>
<p>You may notice that there are some options to &quot;Store total USD value&quot; and &quot;Store all addresses&quot;. Lets talk about what I tried to do with &quot;Save &amp; Share&quot;.</p>
<p>I wanted this to be a completely client side application. This means I don&#x27;t have to do any server stuff,  the user can better trust the application (because they can see all the code), and calling the API would come from each user, so I wouldn&#x27;t get throttled if the site takes off. My question then was: &quot;How can I create a database for a client side application?&quot;</p>
<p>This means that writing and reading from the database needs to be in such a way that it won&#x27;t compromise the data being stored. My first thought was to try and use Google Forms/Sheets. Google Forms is a method for publicly entering data, which can get stored into a Google Sheet which can be publicly viewed. Using Google&#x27;s authorization layer, I could make it so that users could not edit the sheet, only add data to it, and read from it.</p>
<p>I got the part of the app to write to Google working. It doesn&#x27;t look pretty because the app gives a <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS" target="_blank" rel="noopener noreferrer">CORS error</a>, but Google seems to accept the data anyway.</p>
<p><strong>Ignore the error</strong></p>
<p><img loading="lazy" src="/assets/images/img_5a24fdb9c8555-654c6d76803e09d25bb4e7c943ef8954.png" width="495" height="553" class="img_ev3q"></p>
<p><strong>Cause data gets saved anyway...</strong></p>
<p><img loading="lazy" src="/assets/images/img_5a24fd98c904a-e863b7dfa9fc0a903d9bccd759975c53.png" width="648" height="221" class="img_ev3q"></p>
<p>However, I was not able to ever retrieve this data! Even though this sheet is public, it seems like to call any of Google&#x27;s APIs you must be authenticated, at least with an API key.</p>
<p>I created an API key, but trying to use it I get this error:</p>
<p><img loading="lazy" src="data:image/png;base64,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" width="712" height="284" class="img_ev3q"></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;message&quot;: &quot;API Key not found. Please pass a valid API key.&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Every API key is associated with a &quot;Google App Project&quot;, and I needed to specifically enable the Google Sheets API for the project where I was creating the API key.</p>
<p><img loading="lazy" src="/assets/images/img_5a2505a15b129-60d10a78cb4c870bace797337e37d36e.png" width="692" height="382" class="img_ev3q"></p>
<p>Now that this call works, I just need to build an interface to read from the sheet, and re-display the data! That will be coming up next!</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/cryptocurrency/">cryptocurrency</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/ethereum/">ethereum</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/javascript/">javascript</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="This post will introduce you to Token Contract ABIs in Ethereum, and show you how you can use a the Human Standard Token ABI to access the token balances of ERC-20 compatible tokens."><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/ethereum/ethereum-token-contract-abi-web3-erc-20-human-standard-tokens/">Ethereum Token Contract ABI in Web3.js for ERC-20 and Human Standard Tokens</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2017-11-08T16:13:19.000Z" itemprop="datePublished">November 8, 2017</time> · <!-- -->7 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/shawntabrizi" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/shawntabrizi.png" alt="Shawn Tabrizi" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/shawntabrizi" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Shawn Tabrizi</span></a></div><small class="avatar__subtitle" itemprop="description">Software Engineer</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h5 class="anchor anchorWithStickyNavbar_LWe7" id="this-post-will-introduce-you-to-token-contract-abis-in-ethereum-and-show-you-how-you-can-use-a-the-human-standard-token-abi-to-access-the-token-balances-of-erc-20-compatible-tokens">This post will introduce you to Token Contract ABIs in Ethereum, and show you how you can use a the <a href="https://github.com/shawntabrizi/ERC-20-Token-Balance/blob/master/human_standard_token_abi.js" target="_blank" rel="noopener noreferrer">Human Standard Token ABI</a> to access the token balances of ERC-20 compatible tokens.<a href="#this-post-will-introduce-you-to-token-contract-abis-in-ethereum-and-show-you-how-you-can-use-a-the-human-standard-token-abi-to-access-the-token-balances-of-erc-20-compatible-tokens" class="hash-link" aria-label="Direct link to this-post-will-introduce-you-to-token-contract-abis-in-ethereum-and-show-you-how-you-can-use-a-the-human-standard-token-abi-to-access-the-token-balances-of-erc-20-compatible-tokens" title="Direct link to this-post-will-introduce-you-to-token-contract-abis-in-ethereum-and-show-you-how-you-can-use-a-the-human-standard-token-abi-to-access-the-token-balances-of-erc-20-compatible-tokens">​</a></h5>
<p>Let me start by saying that this post may be trivial to some, but was very confusing to me, a brand new user to the Ethereum and Web3.js development world. After writing my <a href="https://shawntabrizi.com/ethereum/ethereum-web3-js-hello-world-get-eth-balance-ethereum-address/" target="_blank" rel="noopener noreferrer">&quot;Hello World&quot; project</a> which gets the ETH balance for an Ethereum Address in Web3, I began to think about the next small step I can take and teach to others. Naturally, I thought it would make sense to do a similar project, but instead, get the Token Balance for ERC-20 tokens at an Ethereum Address.</p>
<p>With Web3.js, you can easily find the template for this functionality:</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> tokenContract </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> eth</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">contract</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tokenABI</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">at</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tokenAddress</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> tokenBalance </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tokenContract</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">balanceOf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ethereumAddress</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Seems easy enough to get the <a href="https://etherscan.io/tokens" target="_blank" rel="noopener noreferrer">Token Address</a>, but what is this <code>tokenABI</code> value that we need to use?</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="a-simplified-explanation-of-a-token-contract-abi">A simplified explanation of a token contract ABI<a href="#a-simplified-explanation-of-a-token-contract-abi" class="hash-link" aria-label="Direct link to A simplified explanation of a token contract ABI" title="Direct link to A simplified explanation of a token contract ABI">​</a></h2>
<p>A little bit of searching will give you documents that teach you about the Application Binary Interface (ABI) <a href="https://solidity.readthedocs.io/en/develop/abi-spec.html" target="_blank" rel="noopener noreferrer">like this</a>, but no real layman&#x27;s terms explanation. Here is my attempt at one:</p>
<blockquote>
<p>In Ethereum, the Application Binary Interface (ABI) is a predefined template of the functions a contract exposes.</p>
</blockquote>
<p>You know when you import a new library into an IDE, you automatically get all that nice autocomplete and Intellisense? You type the library name, add &quot;<code>.</code>&quot; and a list of functions appears in front of you:</p>
<p><img loading="lazy" src="/assets/images/img_5a02bedd6be8c-b894149a64ce6de6a81e147f903d432e.png" width="742" height="267" class="img_ev3q"></p>
<p>Imagine if instead, you needed to know ahead of time the functions the library exposes, and then define them for the IDE so that the autocomplete would work... that is pretty much what is happening here.</p>
<p>An Ethereum Contract ABI will define the different functions that a contract exposes, and each function definition will contain things like the function type, name, inputs, outputs, <a href="https://solidity.readthedocs.io/en/develop/abi-spec.html#json" target="_blank" rel="noopener noreferrer">and more</a>. It even contains information like whether the contract accepts payments in ether or not. Here is the JSON ABI of the <code>balanceOf()</code> function we ultimately want to use:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;constant&quot;: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;inputs&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;name&quot;: &quot;_owner&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;type&quot;: &quot;address&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;name&quot;: &quot;balanceOf&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;outputs&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;name&quot;: &quot;balance&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;type&quot;: &quot;uint256&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;payable&quot;: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;type&quot;: &quot;function&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>I think this is easy enough to read: It is a <code>function</code> which accepts an <code>address</code> as an input, and outputs a <code>balance</code> as an unsigned int. <strong>But is this enough to start talking to an Ethereum contract? What about all the other functions that contract might have? How will I find the full contract ABI for each contract I want to talk to?</strong></p>
<p>Here are the things I learned when trying to answer these questions:</p>
<ul>
<li>You do NOT need the full ABI to interact with a Token Contract. You only need to define the functions which you want to use.</li>
<li>You cannot programmatically generate the ABI for a given contract using data from the Ethereum blockchain. In order to generate the full contract ABI from scratch, you will need the full contract source code, before it is compiled. Note that only the compiled code exists at a contract address.</li>
<li>Some contracts have functions which are intentionally &#x27;hidden&#x27; from the public, and they do not intend the public to use.</li>
</ul>
<p>Therefore, there really is no way to dynamically call any contract address. If only there were some standard set of functions shared across all contracts...</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-erc-20-and-human-standard-token">The ERC-20 and Human Standard Token<a href="#the-erc-20-and-human-standard-token" class="hash-link" aria-label="Direct link to The ERC-20 and Human Standard Token" title="Direct link to The ERC-20 and Human Standard Token">​</a></h2>
<p>From <a href="https://github.com/ethereum/EIPs/blob/master/EIPS/eip-20-token-standard.md" target="_blank" rel="noopener noreferrer">the specification</a>:</p>
<blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="simple-summary">Simple Summary<a href="#simple-summary" class="hash-link" aria-label="Direct link to Simple Summary" title="Direct link to Simple Summary">​</a></h2>
<p>A standard interface for tokens.</p>
</blockquote>
<p>The value of ERC-20 tokens is that they all have a standard set of functions which allow you to interact with each of them in the exact same way. This is why there is so much hype around new Ethereum application which use ERC-20 tokens: there is nearly zero effort to add these tokens to existing platforms like Cryptocurrency Exchanges which means smoother adoption, easier to sell/track, and of course more hype ($$$).</p>
<p>What does it take to be ERC-20 compliant?</p>
<p>Not much really. You just need to expose the non-optional methods and events described <a href="https://github.com/ethereum/EIPs/blob/master/EIPS/eip-20-token-standard.md" target="_blank" rel="noopener noreferrer">here</a>. Beyond the core ERC-20 standard, there are also standard optional parameters which are intended for humans. See <a href="https://github.com/ConsenSys/Tokens" target="_blank" rel="noopener noreferrer">here</a>:</p>
<blockquote>
<p>In other words. This is intended for deployment in something like a Token Factory or Mist wallet, and then used by humans. Imagine coins, currencies, shares, voting weight, etc. Machine-based, rapid creation of many tokens would not necessarily need these extra features or will be minted in other manners.</p>
<ol>
<li>Initial Finite Supply (upon creation one specifies how much is minted). 2) In the absence of a token registry: Optional Decimal, Symbol &amp; Name. 3) Optional approveAndCall() functionality to notify a contract if an approval() has occurred.</li>
</ol>
</blockquote>
<p>This is the &quot;Human Standard Token&quot;, which of course is a super-set of the ERC-20 standard. Additionally, many tokens have a <code>version()</code> function which is also available in the ABI provided below.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="so-lets-get-it-working">So let&#x27;s get it working!<a href="#so-lets-get-it-working" class="hash-link" aria-label="Direct link to So let&#x27;s get it working!" title="Direct link to So let&#x27;s get it working!">​</a></h2>
<p>Now that you have sufficient background to understand what is going on, lets actually go and make some calls to ERC-20 token contracts.</p>
<p>To start, you can find the Human Standard Token ABI <a href="https://github.com/shawntabrizi/ERC-20-Token-Balance/blob/master/human_standard_token_abi.js" target="_blank" rel="noopener noreferrer">here on GitHub</a>. The JS file simply puts the ABI JSON object into a varaible called <code>human_standard_token_abi</code> which allows you to really easily use it in a project.</p>
<p>The most basic project that can take advantage of these things would look something like this:</p>
<div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">html</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">head</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">meta</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">charset</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">UTF-8</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">script</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">type</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">text/javascript</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">src</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">./web3.min.js</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token script"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">script</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">type</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">text/javascript</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">src</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">./human_standard_token_abi.js</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token script"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    </span><span class="token script language-javascript keyword" style="color:#00009f">var</span><span class="token script language-javascript"> web3 </span><span class="token script language-javascript operator" style="color:#393A34">=</span><span class="token script language-javascript"> </span><span class="token script language-javascript keyword" style="color:#00009f">new</span><span class="token script language-javascript"> </span><span class="token script language-javascript class-name">Web3</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript keyword" style="color:#00009f">new</span><span class="token script language-javascript"> </span><span class="token script language-javascript class-name">Web3</span><span class="token script language-javascript class-name punctuation" style="color:#393A34">.</span><span class="token script language-javascript class-name">providers</span><span class="token script language-javascript class-name punctuation" style="color:#393A34">.</span><span class="token script language-javascript class-name">HttpProvider</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript string" style="color:#e3116c">&quot;https://mainnet.infura.io/&lt;APIKEY&gt;&quot;</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript punctuation" style="color:#393A34">;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    address </span><span class="token script language-javascript operator" style="color:#393A34">=</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style="color:#e3116c">&quot;0x0e2e75240c69495d2b9e768b548db381de2142b9&quot;</span><span class="token script language-javascript"> </span><span class="token script language-javascript comment" style="color:#999988;font-style:italic">//From Etherscan</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    contractAddress </span><span class="token script language-javascript operator" style="color:#393A34">=</span><span class="token script language-javascript"> </span><span class="token script language-javascript string" style="color:#e3116c">&quot;0xd26114cd6EE289AccF82350c8d8487fedB8A0C07&quot;</span><span class="token script language-javascript"> </span><span class="token script language-javascript comment" style="color:#999988;font-style:italic">//OMG</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    contractABI </span><span class="token script language-javascript operator" style="color:#393A34">=</span><span class="token script language-javascript"> human_standard_token_abi</span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    tokenContract </span><span class="token script language-javascript operator" style="color:#393A34">=</span><span class="token script language-javascript"> web3</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">eth</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript method function property-access" style="color:#d73a49">contract</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript">contractABI</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript method function property-access" style="color:#d73a49">at</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript">contractAddress</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    </span><span class="token script language-javascript console class-name">console</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript method function property-access" style="color:#d73a49">log</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript">tokenContract</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript method function property-access" style="color:#d73a49">balanceOf</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript">address</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript method function property-access" style="color:#d73a49">toNumber</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">head</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">body</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">p</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">Check the console (F12)</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">p</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">body</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">html</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>And the output:</p>
<p><img loading="lazy" src="/assets/images/img_5a02b864c00dc-1f5a7e963a1bade40525eac26c19c086.png" width="718" height="289" class="img_ev3q"></p>
<p>Take a look at an implementation of this sample <a href="https://shawntabrizi.com/ERC20-Token-Balance/" target="_blank" rel="noopener noreferrer">here</a>. You can find the source code for this on <a href="https://github.com/shawntabrizi/ERC20-Token-Balance" target="_blank" rel="noopener noreferrer">GitHub</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-if">What if...<a href="#what-if" class="hash-link" aria-label="Direct link to What if..." title="Direct link to What if...">​</a></h2>
<p>Let&#x27;s try a few fringe scenarios with this contract ABI. We will be testing this against <a href="https://etherscan.io/token/OmiseGo?a=0x0e2e75240c69495d2b9e768b548db381de2142b9#readContract" target="_blank" rel="noopener noreferrer">OmiseGo</a>.</p>
<ul>
<li>What if we call a contract with a function we defined, but does not exist on the contract?</li>
</ul>
<p>OMG does not have a <code>version()</code> function, but we define it by default in our <code>human_standard_token_abi</code>. So let&#x27;s call it:</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tokenContract</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">version</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>&quot;Uncaught Error: new BigNumber() not a base 16 number&quot;</p>
</blockquote>
<p><img loading="lazy" src="/assets/images/img_5a02ba10afdf7-cf12a177e9ae6bf5885b4d2edb15bd86.png" width="405" height="310" class="img_ev3q"></p>
<ul>
<li>What if we call a contract with a function that exists, but we did not define in the ABI?</li>
</ul>
<p>OMG has the function <code>mintingFinished()</code> which is not part of the Human Standard Token ABI. If we call it, we get the following error:</p>
<blockquote>
<p>&quot;Uncaught TypeError: tokenContract.mintingFinished is not a function&quot;</p>
</blockquote>
<p><img loading="lazy" src="data:image/png;base64,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" width="406" height="127" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-i-hope-you-learned">What I hope you learned:<a href="#what-i-hope-you-learned" class="hash-link" aria-label="Direct link to What I hope you learned:" title="Direct link to What I hope you learned:">​</a></h2>
<ul>
<li>The requirements to call an ERC-20 compliant token contract using Web3.js</li>
<li>What a Token Contract ABI is on the Ethereum Blockchain</li>
<li>Why the ERC-20 standard is pretty great for develeopers</li>
<li>How to easily add the <code>human_standard_token_abi</code> to your JavaScript web application</li>
</ul>
<p>Keep an eye out for <a href="https://shawntabrizi.com/ethereum/making-web3-js-work-asynchronously-javascript-promises-await/" target="_blank" rel="noopener noreferrer">my next post</a>, which will detail how to set up Web3.js for JavaScript promises, so we can execute multiple Web3 functions asynchronously.</p>
<p>If you liked this post, and want to support me, feel free to <a href="https://shawntabrizi.com/donate/" target="_blank" rel="noopener noreferrer">send me a donation.</a></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/application-binary-interface/">application binary interface</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/blockchain/">blockchain</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/erc-20/">erc20</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/ethereum/">ethereum</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/human-standard-token/">human standard token</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/javascript/">javascript</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/token/">token</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/web-3/">web3</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="Just 2 days ago I blogged about a quick project which I considered a &quot;Hello World&quot; application for Ethereum and Web3.js. However, I quickly learned that even in my short 31 lines of code, I made numerous mistakes which do not follow the best practices for developing Web3.js applications."><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/ethereum/correcting-ethereum-web3-js-hello-world/">Correcting the Ethereum and Web3.js &amp;#8220;Hello World&amp;#8221;</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2017-11-05T15:57:51.000Z" itemprop="datePublished">November 5, 2017</time> · <!-- -->4 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/shawntabrizi" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/shawntabrizi.png" alt="Shawn Tabrizi" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/shawntabrizi" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Shawn Tabrizi</span></a></div><small class="avatar__subtitle" itemprop="description">Software Engineer</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Just 2 days ago I <a href="https://shawntabrizi.com/ethereum/ethereum-web3-js-hello-world-get-eth-balance-ethereum-address/" target="_blank" rel="noopener noreferrer">blogged about a quick project</a> which I considered a &quot;Hello World&quot; application for Ethereum and Web3.js. However, I quickly learned that even in my short 31 lines of code, I made numerous mistakes which do not follow the best practices for developing Web3.js applications.</p>
<p>The main part of the sample was the Web3.js stuff, which could be broken into two logical sections:</p>
<ol>
<li>Establishing a Web3 Provider</li>
<li>Getting the ETH balance of an Ethereum Address</li>
</ol>
<p>Both of these sections had mistakes in my original code, and this post will show you how to fix them! I will be updating the main blog post to include these changes as well, but I wanted to document the subtleties of the changes, and what I have learned since then. BTW, all of these mistakes could be avoided if you read the <a href="https://github.com/MetaMask/faq/blob/master/DEVELOPERS.md#partly_sunny-web3---ethereum-browser-environment-check" target="_blank" rel="noopener noreferrer">MetaMask developer documentation</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="ethereum-browser-environment-check">Ethereum Browser Environment Check<a href="#ethereum-browser-environment-check" class="hash-link" aria-label="Direct link to Ethereum Browser Environment Check" title="Direct link to Ethereum Browser Environment Check">​</a></h2>
<p>In my original sample, I simply depend on the Web3 HTTP Provider to access the Ethereum network. However, using <a href="https://metamask.io/" target="_blank" rel="noopener noreferrer">MetaMask</a> or the <a href="https://github.com/ethereum/mist" target="_blank" rel="noopener noreferrer">Mist Browser</a>, users will already have direct access to the Ethereum network through those providers, and do not need to use the HTTP Provider. As said in the <a href="https://github.com/ethereum/wiki/wiki/JavaScript-API#adding-web3" target="_blank" rel="noopener noreferrer">Web3 JavaScript app API Documentation</a>:</p>
<blockquote>
<p>...you need to create a web3 instance, setting a provider. To make sure you don&#x27;t overwrite the already set provider when in mist, check first if the web3 is available...</p>
</blockquote>
<p>To fix this, we mostly follow the <a href="https://github.com/MetaMask/faq/blob/master/DEVELOPERS.md#partly_sunny-web3---ethereum-browser-environment-check" target="_blank" rel="noopener noreferrer">code sample</a> provided by MetaMask:</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;load&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">typeof</span><span class="token plain"> web3 </span><span class="token operator" style="color:#393A34">!==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;undefined&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Web3 Detected! &#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> web3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">currentProvider</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">constructor</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">web3</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Web3</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">web3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">currentProvider</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;No Web3 Detected... using HTTP Provider&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">web3</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Web3</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Web3</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">providers</span><span class="token class-name punctuation" style="color:#393A34">.</span><span class="token class-name">HttpProvider</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;https://mainnet.infura.io/noapikey&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As they mention on the MetaMask developer documentation:</p>
<blockquote>
<p>Note that the environmental web3 check is wrapped in a <code>window.addEventListener(&#x27;load&#x27;, ...)</code> handler. This approach avoids race conditions with web3 injection timing.</p>
</blockquote>
<p>With our new code, as soon as the page loads, we detect if the browser being used already has a Web3 provider set up, and if it does we use it! Otherwise, we will use the HTTP Provider from <a href="https://infura.io/" target="_blank" rel="noopener noreferrer">Infura.io</a>. For most users, I would assume they do not have MetaMask, and thus this change is not very important; but it is certainly best practice, and I am happy to oblige.</p>
<p>Chrome with MetaMask:</p>
<p><img loading="lazy" src="/assets/images/img_59feb77ae6a85-aa008c5a86c11b9c05960468e4ce20c0.png" width="916" height="279" class="img_ev3q"></p>
<p>Firefox without Web3 Provider:</p>
<p><img loading="lazy" src="/assets/images/img_59feb7629ffba-6907067fda1184381de0876e1dcec344.png" width="1058" height="250" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="asynchronous-calls-to-the-ethereum-network">Asynchronous calls to the Ethereum network<a href="#asynchronous-calls-to-the-ethereum-network" class="hash-link" aria-label="Direct link to Asynchronous calls to the Ethereum network" title="Direct link to Asynchronous calls to the Ethereum network">​</a></h2>
<p>If you have been following along word for word, you might have copied the changes mentioned above, loaded it in your MetaMask enabled browser (<a href="https://github.com/MetaMask/faq/blob/master/DEVELOPERS.md#globe_with_meridians-https---web-server-required" target="_blank" rel="noopener noreferrer">from your web server</a>), and tried to get your ETH balance... Here is what you will see:</p>
<p><img loading="lazy" src="/assets/images/img_59feb8e353a07-6ecfd203ba19e88891cdd7ae9cf09df7.png" width="507" height="345" class="img_ev3q"></p>
<p>If we continue to read the MetaMask developer documentation, we would see the following:</p>
<blockquote>
<p>The user does not have the full blockchain on their machine, so data lookups can be a little slow. For this reason, we are unable to support most synchronous methods.</p>
</blockquote>
<p>This means we need to turn our call to get the ETH balance, which is currently a synchronous HTTP request, into an asynchronous request. We can do this by adding an error first callback as the last parameter of the function:</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getBalance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> address</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> wei</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> balance</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    address </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getElementById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;address&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">value</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        web3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">eth</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getBalance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">address</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">error</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> wei</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> balance </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> web3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">fromWei</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">wei</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;ether&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getElementById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;output&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">innerHTML</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> balance </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot; ETH&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getElementById</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;output&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">innerHTML</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> err</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If we try to run this code now with MetaMask as our provider, everything works again!</p>
<p><img loading="lazy" src="/assets/images/img_59febfad543a1-a9729c926007a10e31c1d4bb8f7a37f1.png" width="831" height="333" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-first-but-certainly-not-last-mistake">The first, but certainly not last mistake...<a href="#the-first-but-certainly-not-last-mistake" class="hash-link" aria-label="Direct link to The first, but certainly not last mistake..." title="Direct link to The first, but certainly not last mistake...">​</a></h2>
<p>Phew! We fixed our Hello World application! Take a look at the <a href="https://github.com/shawntabrizi/ETH-Balance/commit/daa8ac6c380c6f870807023e295d51a03a21edef" target="_blank" rel="noopener noreferrer">overall changes on GitHub</a>. I think this goes to show how difficult it can be to learn things on your own, and some of the best practices that can be overlooked so easily. I hope that I am able to go through these issues so that you don&#x27;t have to. If you find any other issues with this or future samples I create, please let me know!</p>
<p>Special shout out to <a href="https://www.reddit.com/r/ethdev/comments/7acshg/in_the_spirit_of_devcon3_build_your_first_web3js/dp9xdff/?utm_content=permalink&amp;utm_medium=user&amp;utm_source=reddit&amp;utm_name=frontpage" target="_blank" rel="noopener noreferrer">Reddit user JonnyLatte</a> for telling me the errors in my ways, and getting me to read more of the documentation around Web3!</p>
<p>As always, if you found this content helpful, feel free to check out my <a href="https://shawntabrizi.com/donate/" target="_blank" rel="noopener noreferrer">donation page</a>.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/blockchain/">blockchain</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/ethereum/">ethereum</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/html/">html</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/javascript/">javascript</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/web-3/">web3</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><a class="pagination-nav__link pagination-nav__link--next" href="/blog/tags/ethereum/page/2/"><div class="pagination-nav__label">Older Entries</div></a></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="text--center"><a href="https://github.com/shawntabrizi/" target="_blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" class="svg-inline--fa fa-github fa-inverse fa-3x" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" style="transform-origin:0.484375em 0.5em"><g transform="translate(248 256)"><g transform="translate(0, 0)  scale(0.625, 0.625)  rotate(0 0 0)"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z" transform="translate(-248 -256)"></path></g></g></svg></a><a href="https://www.linkedin.com/in/shawn-tabrizi/" target="_blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin" class="svg-inline--fa fa-linkedin fa-inverse fa-3x" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" style="transform-origin:0.4375em 0.5em"><g transform="translate(224 256)"><g transform="translate(0, 0)  scale(0.625, 0.625)  rotate(0 0 0)"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z" transform="translate(-224 -256)"></path></g></g></svg></a><a href="https://twitter.com/shawntabrizi" target="_blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="twitter" class="svg-inline--fa fa-twitter fa-inverse fa-3x" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="transform-origin:0.5em 0.5em"><g transform="translate(256 256)"><g transform="translate(0, 0)  scale(0.625, 0.625)  rotate(0 0 0)"><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z" transform="translate(-256 -256)"></path></g></g></svg></a><a href="https://stackexchange.com/users/1489538" target="_blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="stack-exchange" class="svg-inline--fa fa-stack-exchange fa-inverse fa-3x" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" style="transform-origin:0.4375em 0.5em"><g transform="translate(224 256)"><g transform="translate(0, 0)  scale(0.625, 0.625)  rotate(0 0 0)"><path fill="currentColor" d="M17.7 332.3h412.7v22c0 37.7-29.3 68-65.3 68h-19L259.3 512v-89.7H83c-36 0-65.3-30.3-65.3-68v-22zm0-23.6h412.7v-85H17.7v85zm0-109.4h412.7v-85H17.7v85zM365 0H83C47 0 17.7 30.3 17.7 67.7V90h412.7V67.7C430.3 30.3 401 0 365 0z" transform="translate(-224 -256)"></path></g></g></svg></a><a href="https://www.instagram.com/shawntabrizi/" target="_blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="instagram" class="svg-inline--fa fa-instagram fa-inverse fa-3x" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" style="transform-origin:0.4375em 0.5em"><g transform="translate(224 256)"><g transform="translate(0, 0)  scale(0.625, 0.625)  rotate(0 0 0)"><path fill="currentColor" d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z" transform="translate(-224 -256)"></path></g></g></svg></a><a href="https://www.youtube.com/channel/UCl2YcZijUhWJweYeiOIYNdA" target="_blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="youtube" class="svg-inline--fa fa-youtube fa-inverse fa-3x" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" style="transform-origin:0.5625em 0.5em"><g transform="translate(288 256)"><g transform="translate(0, 0)  scale(0.625, 0.625)  rotate(0 0 0)"><path fill="currentColor" d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z" transform="translate(-288 -256)"></path></g></g></svg></a><a href="mailto:shawntabrizi@gmail.com" target="_blank"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="envelope" class="svg-inline--fa fa-envelope fa-inverse fa-3x" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="transform-origin:0.5em 0.5em"><g transform="translate(256 256)"><g transform="translate(0, 0)  scale(0.625, 0.625)  rotate(0 0 0)"><path fill="currentColor" d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4L236.8 313.6c11.4 8.5 27 8.5 38.4 0L492.8 150.4c12.1-9.1 19.2-23.3 19.2-38.4c0-26.5-21.5-48-48-48H48zM0 176V384c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V176L294.4 339.2c-22.8 17.1-54 17.1-76.8 0L0 176z" transform="translate(-256 -256)"></path></g></g></svg></a></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Shawn Tabrizi</div></div></div></footer></div>
</body>
</html>