<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.1">
<title data-rh="true">11 posts tagged with &quot;azure active directory&quot; | Shawn Tabrizi</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://shawntabrizi.com/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://shawntabrizi.com/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://shawntabrizi.com/blog/tags/azure-active-directory/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="11 posts tagged with &quot;azure active directory&quot; | Shawn Tabrizi"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/assets/favicon/favicon-32x32.png"><link data-rh="true" rel="canonical" href="https://shawntabrizi.com/blog/tags/azure-active-directory/"><link data-rh="true" rel="alternate" href="https://shawntabrizi.com/blog/tags/azure-active-directory/" hreflang="en"><link data-rh="true" rel="alternate" href="https://shawntabrizi.com/blog/tags/azure-active-directory/" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Shawn Tabrizi RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Shawn Tabrizi Atom Feed"><link rel="stylesheet" href="/assets/css/styles.56421a03.css">
<script src="/assets/js/runtime~main.4dee2623.js" defer="defer"></script>
<script src="/assets/js/main.95bff564.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">Shawn Tabrizi</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog/">Blog</a><a class="navbar__item navbar__link" href="/portfolio/">Portfolio</a><a class="navbar__item navbar__link" href="/donate/">Donate</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/shawntabrizi/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/personal/web3-reading-list/">Web3 Reading List</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/substrate/transparent-keys-in-substrate/">Transparent Keys in Substrate</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/substrate/substrate-weight-and-fees/">Substrate Weights and Fees</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/substrate/porting-web3-js-to-polkadot-js/">Porting Web3.js to Polkadot.js</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/substrate/substrate-storage-deep-dive/">Substrate Storage Deep Dive</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="https://schema.org/Blog"><header class="margin-bottom--xl"><h1>11 posts tagged with &quot;azure active directory&quot;</h1><a href="/blog/tags/">View All Tags</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="In this post I will discuss how I used MSAL.js to build a simple sign-in experience for Microsoft Identities, and some of the things I learned along the way."><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/aad/building-a-simple-sign-in-page-with-msal-js-for-microsoft-identities/">Building a Simple Sign-In Page with MSAL.js for Microsoft Identities</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2018-08-01T06:25:43.000Z" itemprop="datePublished">August 1, 2018</time> · <!-- -->4 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/shawntabrizi" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/shawntabrizi.png" alt="Shawn Tabrizi" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/shawntabrizi" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Shawn Tabrizi</span></a></div><small class="avatar__subtitle" itemprop="description">Software Engineer</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h5 class="anchor anchorWithStickyNavbar_LWe7" id="in-this-post-i-will-discuss-how-i-used-msaljs-to-build-a-simple-sign-in-experience-for-microsoft-identities-and-some-of-the-things-i-learned-along-the-way">In this post I will discuss how I used MSAL.js to build a simple sign-in experience for Microsoft Identities, and some of the things I learned along the way.<a href="#in-this-post-i-will-discuss-how-i-used-msaljs-to-build-a-simple-sign-in-experience-for-microsoft-identities-and-some-of-the-things-i-learned-along-the-way" class="hash-link" aria-label="Direct link to In this post I will discuss how I used MSAL.js to build a simple sign-in experience for Microsoft Identities, and some of the things I learned along the way." title="Direct link to In this post I will discuss how I used MSAL.js to build a simple sign-in experience for Microsoft Identities, and some of the things I learned along the way.">​</a></h5>
<p>I have worked with a lot of different people to onboard to Microsoft&#x27;s Identity system. Whether it be app registration, app development, or even debugging the login experience, people quickly learn that authentication and authorization isn&#x27;t always as straightforward as one might expect.</p>
<p>It is for that reason I think it is really important to build <a href="https://stackoverflow.com/help/mcve" target="_blank" rel="noopener noreferrer">minimal, complete, and verifiable examples</a> of the authentication process. I previously had built a minimal authentication sample for <a href="https://github.com/shawntabrizi/Azure-AD-Authentication-with-PowerShell-and-ADAL" target="_blank" rel="noopener noreferrer">ADAL .NET using PowerShell</a>, and <a href="https://shawntabrizi.com/aad/azure-ad-authentication-with-powershell-and-adal/" target="_blank" rel="noopener noreferrer">this ended up having a number of different uses</a>.</p>
<p>I want to do the same for MSAL.js!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="my-goals">My goals:<a href="#my-goals" class="hash-link" aria-label="Direct link to My goals:" title="Direct link to My goals:">​</a></h2>
<ul>
<li>Create a login page</li>
<li>Use only basic HTML + JavaScript</li>
<li>Does not require a &#x27;web server&#x27;, just simple web hosting</li>
<li>Can obtain an Access Token for a custom resource, with custom scopes</li>
<li>(Stretch Goal) Allow a user to use their own App ID for getting an access token</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="starting-with-a-minimal-example">Starting with a Minimal example<a href="#starting-with-a-minimal-example" class="hash-link" aria-label="Direct link to Starting with a Minimal example" title="Direct link to Starting with a Minimal example">​</a></h2>
<p>Fortunately, MSAL.js has a set of really great <a href="https://github.com/AzureAD/microsoft-authentication-library-for-js/tree/dev/lib/msal-core/samples/VanillaJSTestApp" target="_blank" rel="noopener noreferrer">minimal examples</a> which do not require a back-end web server, unlike its predecessor ADAL.js whose <a href="https://github.com/AzureAD/azure-activedirectory-library-for-js/wiki/Code-samples" target="_blank" rel="noopener noreferrer">samples</a> ALL require a .NET backend. (WHY???)</p>
<p>Although there is a <code>minimal.html</code> file, I would not start there, since I do not feel that it follows the best practices of using the library. Instead, start with the <a href="https://github.com/AzureAD/microsoft-authentication-library-for-js/blob/dev/lib/msal-core/samples/VanillaJSTestApp/index.html" target="_blank" rel="noopener noreferrer"><code>index.html</code></a> which is still very raw, but includes an <code>applicationConfig</code> object, functionalizes the login flow, and also has a basic UX.</p>
<p>One of the important things I came to realize was the importance of creating a global variable for the <code>MSAL.UserAgentApplication</code> object. It seems to do a lot of different things like listen for the callback from the popup window that gets created, and captures the returned ID and access token to be ingested by the <code>acquireToken</code> functions. I had mistakenly wrapped this variable into my login function, and the results were... weird.</p>
<p>When using the popup experience, the redirection happened WITHIN the popup itself rather than the main page where the sign-in experience was initiated.</p>
<p><img loading="lazy" src="/assets/images/img_5b614c4d2d483-6b02bba16e67c8dfce6668836f6cb71b.png" width="1274" height="1110" class="img_ev3q"></p>
<p>This was a really awful experience, which then made me go down the path of switching <code>loginPopup</code> to <code>loginRedirect</code> so that the user would stay on the same page the whole time. However, this then caused issues where the ID token would just end up in the URL as a fragment (<code>#</code>) and the callback function which turned an ID token into an access token would not work anymore!</p>
<p>When I first was building this page, I actually ignored these problems, since I was working on a Hackathon, and I just needed to keep building. However, I can say that all of this really was caused simply by NOT having the <code>UserAgentApplication</code> object in the global context.</p>
<p>SO DON&#x27;T DO THAT!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="a-working-sample">A working sample<a href="#a-working-sample" class="hash-link" aria-label="Direct link to A working sample" title="Direct link to A working sample">​</a></h2>
<p>You can find the end result of my simple sign-in page here:</p>
<p><a href="https://shawntabrizi.com/Microsoft-Authentication-with-MSAL.js/" target="_blank" rel="noopener noreferrer">https://shawntabrizi.com/Microsoft-Authentication-with-MSAL.js/</a></p>
<p>Source code is on <a href="https://github.com/shawntabrizi/Microsoft-Authentication-with-MSAL.js" target="_blank" rel="noopener noreferrer">GitHub</a>.</p>
<p><img loading="lazy" src="/assets/images/img_5b614ec708ba1-df099a1c7c4e5667082147a86e91286f.png" width="1790" height="775" class="img_ev3q"></p>
<p>The page currently will sign you in, and get an access token to the Microsoft Graph with the scope <code>user.read</code>. Additionally, it will show you your ID token and access token as both a raw JWT and in its decoded JSON format, which I teach how to do <a href="https://shawntabrizi.com/aad/decoding-jwt-tokens/" target="_blank" rel="noopener noreferrer">here</a>.</p>
<p>Besides showing off MSAL.js in a really simple website, I think this app will be useful when trying to use other tools like Postman where you will need to have a valid access token, and generating one may not be so straight forward to the end user.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="next-steps">Next steps<a href="#next-steps" class="hash-link" aria-label="Direct link to Next steps" title="Direct link to Next steps">​</a></h2>
<p>While this sample in its current form is pretty cool, it does not satisfy all the goals I listed above. That will be the next step for me on this project. I still need to figure out exactly how to call a custom API using a V2 application (which may not even be possible to configure right now until a new UX which a co-worker of mine is working on becomes available). However, allowing a user to input custom scopes should be really easy, and if others configure their own App ID to have my website as a redirect url, then I could see using a custom App ID to be really easy too.</p>
<p>I will be making this updates in the same <a href="https://github.com/shawntabrizi/Microsoft-Authentication-with-MSAL.js" target="_blank" rel="noopener noreferrer">GitHub</a> I listed above, and you should see the changes directly on the <a href="https://shawntabrizi.com/Microsoft-Authentication-with-MSAL.js/" target="_blank" rel="noopener noreferrer">same page as before</a>! I hope this was useful for some of you, and if there are additional things I could add to make this project work better for you, just let me know through a GitHub issue.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/authentication/">authentication</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/azure-active-directory/">azure active directory</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/javascript/">javascript</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/msal/">msal</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="My favorite time of the year at Microsoft is the &quot;OneWeek&quot; Hackathon."><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/aad/microsoft-identities-on-the-ethereum-blockchain/">Microsoft Identities on the Ethereum Blockchain</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2018-07-01T06:08:30.000Z" itemprop="datePublished">July 1, 2018</time> · <!-- -->7 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/shawntabrizi" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/shawntabrizi.png" alt="Shawn Tabrizi" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/shawntabrizi" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Shawn Tabrizi</span></a></div><small class="avatar__subtitle" itemprop="description">Software Engineer</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>My favorite time of the year at Microsoft is the &quot;OneWeek&quot; Hackathon.</p>
<p><img loading="lazy" alt="Hackathon Image" src="/assets/images/img_5b386bd8dab8a-3bc02633fda412eab69cff854f234b9d.png" width="842" height="544" class="img_ev3q"></p>
<p>It&#x27;s a time of the year where you can work with some of the most talented engineers around to solve problems that you all agree are awesome.</p>
<p>I have lead a <a href="https://shawntabrizi.com/metime/" target="_blank" rel="noopener noreferrer">different</a> <a href="https://shawntabrizi.com/Skill-Finder/" target="_blank" rel="noopener noreferrer">project</a> every year, some of which have been hinted to in my <a href="https://shawntabrizi.com/code/scraping-linkedin-topics-skills-data/" target="_blank" rel="noopener noreferrer">previous blog posts.</a></p>
<p>This year will be no different.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="hypothesis-microsofts-identity-system-has-value-which-can-be-transferred-to-the-ethereum-blockchain">Hypothesis: Microsoft&#x27;s identity system has value which can be transferred to the Ethereum blockchain<a href="#hypothesis-microsofts-identity-system-has-value-which-can-be-transferred-to-the-ethereum-blockchain" class="hash-link" aria-label="Direct link to Hypothesis: Microsoft&#x27;s identity system has value which can be transferred to the Ethereum blockchain" title="Direct link to Hypothesis: Microsoft&#x27;s identity system has value which can be transferred to the Ethereum blockchain">​</a></h2>
<p>One of the amazing things about identities on Ethereum is that they are free, anonymous, and simple to create. However this also makes them pretty useless when trying to gate access to decentralized applications. There are solutions to combat this problem if you to build a reputation or token staking system around your application, but this usually involves a new identity to undergo significant onboarding before their identity becomes valuable. What if instead of completely recreating new identities, we could bootstrap them using our existing, modern identities?</p>
<p>There is value in Microsoft Identities. I don&#x27;t mean specifically &quot;Microsoft.com accounts&quot;, I mean the identity system that is built by Microsoft, and is used by <a href="https://shawntabrizi.com/aad/does-company-x-have-an-azure-active-directory-tenant/" target="_blank" rel="noopener noreferrer">85% of the Fortune 500</a>. If a user has an account in the Adobe company tenant, then we can pretty confidently say the following:</p>
<ul>
<li>That user is an employee of Adobe</li>
<li>That user&#x27;s identity is managed by a Company Administrator at Adobe</li>
<li>That user&#x27;s information first name, last name, phone number, etc. is relatively accurate</li>
<li>and more...</li>
</ul>
<p>This is actually the very information which powers Microsoft cloud services like Azure, Office 365, and the larger Microsoft Graph ecosystem. It is the same information that millions of apps use to build authentication and single-sign. There is trust because Microsoft has spent the time and energy to build a system with rigorous role based access control (RBAC), and companies have spent their time and energy populating these systems with data which powers their companies.</p>
<p>My hypothesis is that there is value in these Microsoft identities, simply for existing. Not all of them are equally valuable, but for large companies who methodically manage and control that information, the value is actually quite high. The question is then: &quot;How can we migrate this value onto Ethereum?&quot;</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="building-an-attestation-service">Building an attestation service<a href="#building-an-attestation-service" class="hash-link" aria-label="Direct link to Building an attestation service" title="Direct link to Building an attestation service">​</a></h2>
<p>Decentralized identity systems being developed on Ethereum are attempting to solve a number of critically important problems, however they are not attempting to replace all forms of centralization. There will always be some amount of centralization involved with adding claims or attestations to an identity. For example, if you want to prove that you are a US citizen, you will need to go to your state&#x27;s DMV to get an ID card.</p>
<p>In this case, we are interested in employment, and if you want to prove that your are an employee of a certain company, you will need to prove that you are registered within their internal systems. Imagine a middle tier service that accepts a valid authentication token, and associates that with an Ethereum address that the user provides. Then, if you can then make these proofs easily accessible, you then unlock a number of possibilities for dApps to take advantage of that information. Imagine the following user stories:</p>
<ul>
<li>An Ethereum address may want to prove who they are (Name, Company, Role, etc…). They could do this by logging into their corporate Azure Active Directory, and store those claims on the blockchain tied to their account.</li>
<li>Imagine Microsoft (or another company) wants to build a “Kudos” currency which can be used to thank other Microsoft Employees when they do nice things for one another. However, it should only be used between Microsoft employees. Using this identity claim, a smart contract which runs this cryptocurrency could verify that only Microsoft employees are the senders and recipients of the currency.</li>
<li>Imagine Microsoft (or another company) wants to build a decentralized market similar to SellBuy (a Microsoft internal alias for selling items) using the Ethereum blockchain. Similar to the other stories, this decentralized market should only allow people from Microsoft, or other trusted companies to join and list their products on the marketplace. So, the dApp uses these Microsoft Identity claims to gate access to the marketplace.</li>
<li>Imagine a decentralized application like <a href="https://www.teamblind.com/" target="_blank" rel="noopener noreferrer">Blind</a>, where users from different companies can anonymously chat within their own personal and shared forums. On Ethereum, an app like this can be completely censorship free and immutable, a problem that is present with the current Blind app. To ensure that these anonymous users have the right company identifier, we would use the claims about their accounts stored on the blockchain.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-plan">The plan<a href="#the-plan" class="hash-link" aria-label="Direct link to The plan" title="Direct link to The plan">​</a></h2>
<p><img loading="lazy" alt="High level architecture" src="/assets/images/img_5b527aea81ca1-bab6e05f6c37c5f5f33ac6734a63368d.png" width="1385" height="863" class="img_ev3q"></p>
<p>The plan for the hackathon is actually relatively simple, mostly because we will be executing a proof of concept versus a battle tested, production ready design. Let&#x27;s dive deeper into the pieces of the puzzle:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="web-front-end">Web Front End<a href="#web-front-end" class="hash-link" aria-label="Direct link to Web Front End" title="Direct link to Web Front End">​</a></h3>
<p>The sign up process:</p>
<ul>
<li>The user goes to our web front end, and iniates a Microsoft identity login flow</li>
<li>This results in an app + user access token for our middle tier resource, signed by Microsoft&#x27;s identity provider</li>
<li>The user then signs this access token with their Ethereum private key</li>
<li>The web front end then sends a payload to the middle tier service with the access token and the signature for that payload</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="middle-tier-service">Middle Tier Service<a href="#middle-tier-service" class="hash-link" aria-label="Direct link to Middle Tier Service" title="Direct link to Middle Tier Service">​</a></h3>
<p>Registering the user:</p>
<ul>
<li>The middle tier service will recieve a &quot;doubly signed&quot; message, where the entire JWT is signed by the Ethereum address, and the contents of the JWT are signed by Microsoft</li>
<li>It will verify that the token&#x27;s resource is for the middle tier</li>
<li>It will verify that the token was signed by Microsoft</li>
<li>It will verify that the payload has been signed by the Ethereum account</li>
<li>It will parse out specific claims about the user that it wants to store on the blockchain (MVP is Tenant ID)</li>
<li>It will generate a transaction to our back end smart contract to store this data on Ethereum</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="back-end-identity-contract">Back End Identity Contract<a href="#back-end-identity-contract" class="hash-link" aria-label="Direct link to Back End Identity Contract" title="Direct link to Back End Identity Contract">​</a></h3>
<p>Storing the identity information:</p>
<ul>
<li>The back end identity contract will be owned by the middle tier service</li>
<li>It will define an extensible user object</li>
<li>It will have a mapping between Ethereum accounts and that user object</li>
<li>It will expose a getter function for other contracts to access that data</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="corpcoin-contract">CorpCoin Contract<a href="#corpcoin-contract" class="hash-link" aria-label="Direct link to CorpCoin Contract" title="Direct link to CorpCoin Contract">​</a></h3>
<p>Testing our identity system:</p>
<ul>
<li>The CorpCoin contract will be a basic ERC20 token</li>
<li>It will have a requirement that users have to be from a certain company/tenant to interact with the coin</li>
<li>It will interact with our back end identity contract to verify the user&#x27;s company/tenant</li>
<li>It will issue coins to users who have not been issued coins in the past to bootstrap the &#x27;economy&#x27;</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="more-to-come">More to come!<a href="#more-to-come" class="hash-link" aria-label="Direct link to More to come!" title="Direct link to More to come!">​</a></h2>
<p>That is all I am ready to share for now, but note that this is just a very high level overview. There are so many intricacies and details to think about when solving this problem. Here are just a few:</p>
<ul>
<li>How can we automatically remove claims of a user once their off-chain identity has been deleted or removed from a particular group/claim?</li>
<li>How can we store identity claims on the blockchain such that it does not expose sensitive information about the user to people who they do not want to share it with?</li>
<li>What default claims should we be storing, and how can we allow users to extend those claims for their own needs?</li>
<li>How could we decentralize the middle tier service which verifies the user’s Microsoft Identity, to increase trust that the claims stored on the blockchain are real?</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="watch-this-video-to-learn-more">Watch this video to learn more!<a href="#watch-this-video-to-learn-more" class="hash-link" aria-label="Direct link to Watch this video to learn more!" title="Direct link to Watch this video to learn more!">​</a></h2>
<iframe src="https://www.youtube.com/embed/Wg6kg2mLA3k" width="720px" height="480px"></iframe></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/azure-active-directory/">azure active directory</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/blockchain/">blockchain</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/ethereum/">ethereum</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/identity/">identity</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/microsoft/">microsoft</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="When creating a new Azure Active Directory application, developers may run into a a problem when calling the AAD Graph API where they lack the correct permissions to call the APIs they want when calling in the App Only Flow (Client Credentials Flow)."><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/aad/adding-aad-service-principal-company-administrator-role-using-aad-powershell-module/">Adding AAD Service Principal to the Company Administrator Role using the AAD PowerShell Module</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2017-10-16T09:20:39.000Z" itemprop="datePublished">October 16, 2017</time> · <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/shawntabrizi" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/shawntabrizi.png" alt="Shawn Tabrizi" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/shawntabrizi" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Shawn Tabrizi</span></a></div><small class="avatar__subtitle" itemprop="description">Software Engineer</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>When creating a new Azure Active Directory application, developers may run into a a problem when calling the AAD Graph API where they lack the correct permissions to call the APIs they want when calling in the App Only Flow (Client Credentials Flow).</p>
<p>Is this message familiar to you?</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;odata.error&quot;:{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;code&quot;:&quot;Authorization_RequestDenied&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;message&quot;:{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;lang&quot;:&quot;en&quot;,&quot;value&quot;:&quot;Insufficient privileges to complete the operation.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The correct thing to do would be to try and investigate the permissions you have granted to your application, but there are some APIs which are not even supported through the permissions publicly exposed by the AAD Graph API. Maybe you just want to overcome this error for the time being and continue testing your end to end experience.</p>
<p>Using the AAD PowerShell Module, you can:</p>
<ul>
<li>Give your application full access to the Graph API in the context of my tenant.</li>
</ul>
<p><strong>or</strong></p>
<ul>
<li>Grant your application permissions to my tenant which are not currently supported with the permissions exposed by the AAD Graph API.</li>
</ul>
<p>&quot;How?&quot; you might ask.</p>
<p>Well, you can elevate the level of access an Application has in your tenant by adding the service principal of that application to the <code>Company Administrator</code> Directory Role. This will give the Application the same level of permissions as the Company Administrator, who can do anything. You can follow these same instructions for any type of Directory Role depending on the level of access you want to give to this application.</p>
<blockquote>
<p><strong>Note:</strong> This will only affect the access your app has in your tenant.</p>
<p>Also you must already be a Company Administrator of the tenant to follow these instructions.</p>
</blockquote>
<p>In order to make the change, you will need to install the <a href="https://docs.microsoft.com/en-us/powershell/msonline/v1/azureactivedirectory" target="_blank" rel="noopener noreferrer">Azure Active Directory PowerShell Module</a>.</p>
<p>Once you have the module installed, authenticate to your tenant with your Administrator Account:</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Connect-MSOLService</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Then we need to get the Object ID of both the Service Principal we want to elevate, and the Company Administrator Role for your tenant.</p>
<p>Search for Service Principal by App ID GUID:</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$sp = Get-MsolServicePrincipal -AppPrincipalId &lt;App ID GUID&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Search for Directory Role by Name</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$role = Get-MsolRole -RoleName &quot;Company Administrator&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now we can use the <code>Add-MsolRoleMember</code> command to add this role to the service principal.</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Add-MsolRoleMember -RoleObjectId $role.ObjectId -RoleMemberType ServicePrincipal -RoleMemberObjectId $sp.ObjectId</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To check everything is working, lets get back all the members of the Company Administrator role:</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Get-MsolRoleMember -RoleObjectId $role.ObjectId</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You should see your application in that list, where <code>RoleMemberType</code> is <code>ServicePrincipal</code> and <code>DisplayName</code> is the name of your application.</p>
<p>Now your application should be able to perform any Graph API calls that the Company Administrator could do, all without a user signed-in, using the Client Credential Flow.</p>
<p>Let me know if this helps!</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/aad-powershell-module/">aad powershell module</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/azure-active-directory/">azure active directory</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/graph-api/">graph api</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/powershell/">powershell</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/tenant-administrator/">tenant administrator</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="I have seen a lot of StackOverflow posts trying to debug pretty basic errors when getting an access token to Microsoft Resources. Sometimes the issue is as simple as a typo in the &quot;resource&quot; value in the token request. When helping these users, I struggle to find public documentation which shows plainly the correct resource values for these different APIs!"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/aad/common-microsoft-resources-azure-active-directory/">Common Microsoft Resources in Azure Active Directory</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2017-09-20T09:23:24.000Z" itemprop="datePublished">September 20, 2017</time> · <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/shawntabrizi" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/shawntabrizi.png" alt="Shawn Tabrizi" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/shawntabrizi" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Shawn Tabrizi</span></a></div><small class="avatar__subtitle" itemprop="description">Software Engineer</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>I have seen a lot of StackOverflow posts trying to debug pretty basic errors when getting an access token to Microsoft Resources. Sometimes the issue is as simple as a typo in the &quot;resource&quot; value in the token request. When helping these users, I struggle to find public documentation which shows plainly the correct resource values for these different APIs!</p>
<p>That is going to change starting now. Here will be a list of the most popular Microsoft APIs exposed on Azure Active Directory, along with the basic information you may need to get an access token to those resources for PROD. (If you want the details for other Environments, let me know!)</p>
<blockquote>
<p>Note: The Resource URI must match exactly what is written below, including any trailing &#x27;/&#x27; or lack thereof.</p>
</blockquote>
<table><tbody><tr><th>Resource Name</th><th>Resource URI</th><th>Application ID</th></tr><tr><td>AAD Graph API</td><td><a href="https://graph.windows.net/" target="_blank" rel="noopener noreferrer">https://graph.windows.net/</a></td><td>00000002-0000-0000-c000-000000000000</td></tr><tr><td>Office 365 Exchange Online</td><td><a href="https://outlook-sdf.office.com/" target="_blank" rel="noopener noreferrer">https://outlook-sdf.office.com/</a></td><td>00000002-0000-0ff1-ce00-000000000000</td></tr><tr><td>Microsoft Graph</td><td><a href="https://graph.microsoft.com" target="_blank" rel="noopener noreferrer">https://graph.microsoft.com</a></td><td>00000003-0000-0000-c000-000000000000</td></tr><tr><td>Skype for Business Online</td><td><a href="https://api.skypeforbusiness.com/" target="_blank" rel="noopener noreferrer">https://api.skypeforbusiness.com/</a></td><td>00000004-0000-0ff1-ce00-000000000000</td></tr><tr><td>Office 365 Yammer</td><td><a href="https://api.yammer.com/" target="_blank" rel="noopener noreferrer">https://api.yammer.com/</a></td><td>00000005-0000-0ff1-ce00-000000000000</td></tr><tr><td>OneNote</td><td><a href="https://onenote.com/" target="_blank" rel="noopener noreferrer">https://onenote.com/</a></td><td>2d4d3d8e-2be3-4bef-9f87-7875a61c29de</td></tr><tr><td>Windows Azure Service Management API</td><td><a href="https://management.core.windows.net/" target="_blank" rel="noopener noreferrer">https://management.core.windows.net/</a></td><td>797f4846-ba00-4fd7-ba43-dac1f8f63013</td></tr><tr><td>Office 365 Management APIs</td><td><a href="https://manage.office.com" target="_blank" rel="noopener noreferrer">https://manage.office.com</a></td><td>c5393580-f805-4401-95e8-94b7a6ef2fc2</td></tr><tr><td>Microsoft Teams Services</td><td><a href="https://api.spaces.skype.com/" target="_blank" rel="noopener noreferrer">https://api.spaces.skype.com/</a></td><td>cc15fd57-2c6c-4117-a88c-83b1d56b4bbe</td></tr><tr><td>Azure Key Vault</td><td><a href="https://vault.azure.net" target="_blank" rel="noopener noreferrer">https://vault.azure.net</a></td><td>cfa8b339-82a2-471a-a3c9-0fc0be7a4093</td></tr></tbody></table>
<br>
<p>Who knows if this will actually end up helping anyone, but I hope it will!</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/access-token/">access token</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/azure-active-directory/">azure active directory</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/first-party-applications/">first party applications</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/resource/">resource</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="I have been working on a few projects recently that used Flask, a Python web framework, and Azure Active Directory to do things related to the Microsoft Graph. Using flask_oauthlib and the Azure AD V2 endpoint, it has been really easy to set up basic authentication for my web apps."><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/aad/refresh-tokens-azure-ad-v2-applications-flask/">Refresh Tokens for Azure AD V2 Applications in Flask</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2017-08-17T07:45:38.000Z" itemprop="datePublished">August 17, 2017</time> · <!-- -->4 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/shawntabrizi" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/shawntabrizi.png" alt="Shawn Tabrizi" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/shawntabrizi" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Shawn Tabrizi</span></a></div><small class="avatar__subtitle" itemprop="description">Software Engineer</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>I have been working on a few projects recently that used Flask, a Python web framework, and Azure Active Directory to do things related to the Microsoft Graph. Using <a href="https://flask-oauthlib.readthedocs.io/en/latest/" target="_blank" rel="noopener noreferrer">flask_oauthlib</a> and the <a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-appmodel-v2-overview" target="_blank" rel="noopener noreferrer">Azure AD V2 endpoint</a>, it has been really easy to set up basic authentication for my web apps.</p>
<p>However, we quickly ran into basic authentication headaches like token expiry. It seems pretty obvious to the end user that as long as they haven&#x27;t logged out since the last time they visited the site, they should stay automatically logged in. However, if you set up a naive implementation of authentication, you will find that the access token you store for the user is only valid for a limited time; <a href="https://docs.microsoft.com/en-us/azure/active-directory/active-directory-configurable-token-lifetimes" target="_blank" rel="noopener noreferrer">by default just 1 hour</a>.</p>
<p><strong>So do we make our user sign in every hour?</strong></p>
<p>Hell no. We need to use refresh tokens which can be exchanged for NEW access tokens, all without the user being asked to sign in again.</p>
<p><strong>How do we get a refresh token?</strong></p>
<p>In order to get a refresh token from the Azure AD V2 endpoint, you need to make sure your application requests a specific scope: offline_access. As stated <a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-v2-scopes#openid-connect-scopes" target="_blank" rel="noopener noreferrer">here</a>:</p>
<blockquote>
<p>When a user approves the <code>offline_access</code> scope, your app can receive refresh tokens from the v2.0 token endpoint. Refresh tokens are long-lived. Your app can get new access tokens as older ones expire.</p>
<p>If your app does not request the <code>offline_access</code> scope, it won&#x27;t receive refresh tokens.</p>
</blockquote>
<p><strong>So how do we do it?</strong></p>
<p>Unfortunately flask_oauthlib does not directly support refresh tokens, but it does support <a href="https://flask-oauthlib.readthedocs.io/en/latest/client.html?highlight=post#invoking-remote-methods" target="_blank" rel="noopener noreferrer">remote methods</a>, so we should be able to simply make a POST request for a new access token! Here is the surprisingly simple code you need:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;grant_type&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;refresh_token&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;refresh_token&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> session</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;refresh_token&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;client_id&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> microsoft</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">consumer_key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;client_secret&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> microsoft</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">consumer_secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">microsoft</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">post</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">microsoft</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">access_token_url</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>That&#x27;s it! What you are not seeing here is the original code used to get an access token, but I am just doing the normal flask_oauthlib stuff (which you can find in <a href="https://github.com/Azure-Samples/active-directory-python-flask-graphapi-web-v2" target="_blank" rel="noopener noreferrer">this sample</a>), and storing the results of the token response in the user&#x27;s session (Access Token, Expires In, and Refresh Token).</p>
<p>Now, in order to invoke this code at the right time, I need to create a <a href="http://flask.pocoo.org/docs/0.12/patterns/viewdecorators/" target="_blank" rel="noopener noreferrer">view decorator</a>, and Flask has a sample for almost exactly what we want to do here: a login required decorator.</p>
<p>Basically, we add this decorator to any view where we expect the user to be signed in. If the user has no token, we will redirect them to the login page. If they have an expired token and a refresh token, we will use the refresh token to get a new access token. Otherwise, if the token is present and valid, we simply let the view load.</p>
<p>Check it out in full action here:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">login_required</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">f</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:#393A34">@wraps</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">f</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">wrap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">args</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">**</span><span class="token plain">kwargs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;microsoft_token&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> session</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> session</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;expires_at&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> datetime</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">now</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> f</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">args</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">**</span><span class="token plain">kwargs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;refresh_token&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> session</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic"># Try to get a Refresh Token</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;grant_type&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;refresh_token&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;refresh_token&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> session</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;refresh_token&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;client_id&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> microsoft</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">consumer_key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;client_secret&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> microsoft</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">consumer_secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                response </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">microsoft</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">post</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">microsoft</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">access_token_url</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> response </span><span class="token keyword" style="color:#00009f">is</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    session</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">clear</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Access Denied: Reason=%s\nError=%s&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;error&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">request</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;error_description&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> redirect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url_for</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;index&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    session</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;microsoft_token&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;access_token&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    session</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;expires_at&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> datetime</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">now</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> timedelta</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">seconds</span><span class="token operator" style="color:#393A34">=</span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;expires_in&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    session</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;refresh_token&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;refresh_token&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> f</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">args</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">**</span><span class="token plain">kwargs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> redirect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url_for</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;login&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> wrap</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>So now when we want to make a page require login we simply set up our view function like so:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token decorator annotation punctuation" style="color:#393A34">@app</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">route</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;/home&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@login_required</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">home</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#view code goes here</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Adding this kind of code to your Azure AD Flask application can really be the difference between a good and bad user experience. Let me know if this ends up helping you out!</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/access-token/">access token</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/authentication/">authentication</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/azure-active-directory/">azure active directory</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/flask/">flask</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/microsoft-graph/">microsoft graph</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/python/">python</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/refresh-token/">refresh token</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="Today I was presenting one of my hackathon projects which I worked on this year to the Identity team at Microsoft. In order for my project to work, I needed to get consent to read the mail of the signed-in user. Depending on who you talk to, a permission like this could be easy as pie to consent to or something that they would never accept. Some people fall in the middle where they are happy to consent as long as they can choose to revoke that consent after they are done playing with the app."><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/aad/revoking-consent-azure-active-directory-applications/">Revoking Consent for Azure Active Directory Applications</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2017-08-11T15:17:38.000Z" itemprop="datePublished">August 11, 2017</time> · <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/shawntabrizi" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/shawntabrizi.png" alt="Shawn Tabrizi" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/shawntabrizi" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Shawn Tabrizi</span></a></div><small class="avatar__subtitle" itemprop="description">Software Engineer</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Today I was presenting one of my hackathon projects which I worked on this year to the Identity team at Microsoft. In order for my project to work, I needed to get consent to read the mail of the signed-in user. Depending on who you talk to, a permission like this could be easy as pie to consent to or something that they would never accept. Some people fall in the middle where they are happy to consent as long as they can choose to revoke that consent after they are done playing with the app.</p>
<p>That is why I am writing this. How easy it is to forget that it is NOT very obvious what you need to do to revoke consent for an Azure Active Directory Application. Even people on the Identity team don&#x27;t always know! So let&#x27;s talk about how you can do it :)</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="using-the-my-apps-portal-for-individual-user-consent">Using the My Apps Portal for Individual User Consent<a href="#using-the-my-apps-portal-for-individual-user-consent" class="hash-link" aria-label="Direct link to Using the My Apps Portal for Individual User Consent" title="Direct link to Using the My Apps Portal for Individual User Consent">​</a></h2>
<p>You can revoke individual user consent through the <a href="https://myapps.microsoft.com/" target="_blank" rel="noopener noreferrer">My Apps Portal</a>. Here you should see a view of all applications that you or even your administrator (on your behalf) has consented to:</p>
<p><img loading="lazy" src="/assets/images/img_598d51215d1c7-1b2d24feec123f5c5fc0e9006c8d5e7d.png" width="975" height="574" class="img_ev3q"></p>
<p>With applications your admin has consented to, all you can do is open the app, however for apps where you individually consented as a user, you can click &quot;Remove&quot; which will revoke consent for the application.</p>
<p><img loading="lazy" src="/assets/images/img_598d517f175d3-70ec37737b63fc1f28bbdb0983dbb07a.png" width="720" height="347" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="using-the-azure-portal-to-remove-tenant-wide-consent">Using the Azure Portal to Remove Tenant Wide Consent<a href="#using-the-azure-portal-to-remove-tenant-wide-consent" class="hash-link" aria-label="Direct link to Using the Azure Portal to Remove Tenant Wide Consent" title="Direct link to Using the Azure Portal to Remove Tenant Wide Consent">​</a></h2>
<p>If you are a tenant administrator, and you want to revoke consent for an application across your entire tenant, you can go to the <a href="https://portal.azure.com/" target="_blank" rel="noopener noreferrer">Azure Portal</a>.  Whether it be for a bunch of users who individually consented or for an admin who consented on behalf of all the users, by simply deleting the application&#x27;s service principal, you will remove all <a href="https://msdn.microsoft.com/en-us/library/azure/ad/graph/api/entity-and-complex-type-reference#oauth2permissiongrant-entity" target="_blank" rel="noopener noreferrer">OAuth 2 Permission Grants</a> (the object used to store consent) linked to that application. Think about removing the service principal like uninstalling the application from your tenant.</p>
<p>You could delete the service principal a bunch of different ways like through <a href="https://docs.microsoft.com/en-us/powershell/module/azuread/remove-azureadserviceprincipal" target="_blank" rel="noopener noreferrer">Azure Active Directory PowerShell</a> or through the <a href="https://developer.microsoft.com/en-us/graph/docs/api-reference/beta/api/serviceprincipal_delete" target="_blank" rel="noopener noreferrer">Microsoft Graph API</a>, but the easiest way for the average administrator is right through the Azure Portal.</p>
<p>Navigate to the Enterprise Applications blade in the Azure portal:</p>
<p><img loading="lazy" src="data:image/png;base64,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" width="454" height="275" class="img_ev3q"></p>
<p>Then click &quot;All Applications&quot; and search for the application you want to revoke consent for:</p>
<p><img loading="lazy" src="/assets/images/img_598d594ddf163-abaeec6b15e5f40cc4dffe407e034f02.png" width="988" height="303" class="img_ev3q"></p>
<p>When you click the application, you will be brought to an &quot;Overview&quot; section, where a tempting button called &quot;Delete&quot; will be at the top. Before you click this button,  you might want to take a peak at the &quot;Permissions&quot; section to see the types of consent that was granted to this application:</p>
<p><img loading="lazy" src="/assets/images/img_598d59b5e2851-190c52599472d113d8df8df423a71ac7.png" width="638" height="286" class="img_ev3q"></p>
<p>Once you feel confident that you want to delete this application, go back to &quot;Overview&quot; and click &quot;Delete&quot;!</p>
<p><img loading="lazy" src="/assets/images/img_598d5ae51090c-bc427c5a04213e33958efb38d0be491c.png" width="844" height="451" class="img_ev3q"></p>
<p>Viola! The app and all consent associated with that app is now gone.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/azure-active-directory/">azure active directory</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/azure-portal/">azure portal</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/consent/">consent</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/my-apps-portal/">my apps portal</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/tenant-administrator/">tenant administrator</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="Let me just jump to the point with this post: Client applications should not depend on claims in access tokens to gather data about the signed-in user or anything about the authenticated session."><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/aad/clients-tokens-claims-oh-my/">Clients and Tokens and Claims! Oh My!</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2017-07-17T06:52:31.000Z" itemprop="datePublished">July 17, 2017</time> · <!-- -->5 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/shawntabrizi" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/shawntabrizi.png" alt="Shawn Tabrizi" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/shawntabrizi" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Shawn Tabrizi</span></a></div><small class="avatar__subtitle" itemprop="description">Software Engineer</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Let me just jump to the point with this post: Client applications should not depend on claims in access tokens to gather data about the signed-in user or anything about the authenticated session.</p>
<p>Time and time again, I have seen client applications complain to me that certain claims, like group membership claims, are not appearing in the access token they receive, and they ask me how to enable this. They incorrectly assume that if they go into their application manifest, and change the &quot;groupMembershipClaims&quot; settings, that they will be able to start getting claims, but everyone eventually finds out... it doesn&#x27;t work!</p>
<p>Let&#x27;s take a look at source material; from the <a href="https://tools.ietf.org/html/rfc6749#section-1.4" target="_blank" rel="noopener noreferrer">OAuth 2 specification</a>:</p>
<blockquote>
<p>An access token is a string representing an authorization issued to the client. <strong>The string is usually opaque to the client</strong>.</p>
</blockquote>
<p>Unfortunately, the OAuth 2 specification is intentionally broad, but in summary, the &#x27;access token&#x27; that is given to a client should only really be explored by the specified audience of the token. Some implementations of OAuth 2 do not even pass a JWT token to the client. Instead they pass a unique string, and then the resource exchanges that string for the actual token using a signed request. Alternatively, other implementations pass an encrypted JWT token rather than just a signed token. This means that the resource application uploads a token signing key which the authorization server uses to encrypt the full token. That means that the only person who can look at the claims in the token is the resource who also has the private key for decryption.</p>
<p>The implementation of OAuth 2 that I am most familiar with, Azure Active Directory,  issues a signed token, which means that its content is completely visible to the client. In the future, Azure AD may add support for encrypted tokens, which means that clients are going to have to start following the correct practices.</p>
<p>Need to know about the user signed into your web application?</p>
<ul>
<li>Get an <a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-token-and-claims#idtokens" target="_blank" rel="noopener noreferrer">ID token</a>! These are meant for client consumption!</li>
</ul>
<p>Need to know which groups a user is a member of?</p>
<ul>
<li>Get an access token to the AAD or Microsoft Graph API and query the API!</li>
</ul>
<p>Now lets go back to the original problem. If groupMembershipClaims are not meant for clients to get the claims in the access token, what are they used for? You might have figured out by now, but they are for <strong>resource</strong> applications to get the claims in the access token!</p>
<p>Lets show an example. To set up, I have registered two Azure AD Web Apps/APIs called Web API 1 and Web API 2. Both of these applications are identical, except Web API 1 has the setting &quot;groupMembershipClaims&quot;: &quot;All&quot;, and the other is set to null, which is default. I have to set up a fake App ID URI for both apps, and I have to make sure that each application has the other set as a &quot;required permission&quot;.</p>
<p>I will be using my <a href="https://shawntabrizi.com/aad/azure-ad-authentication-with-powershell-and-adal/" target="_blank" rel="noopener noreferrer">PowerShell Scripts</a> to quickly get two access tokens. One where the client is Web API 1 and the resource is Web API 2, and vice versa.</p>
<p>Let&#x27;s look at the results, using my JWT Decoder to look at the payload:</p>
<p><strong>Payload 1:  Client = Web API 1, Resource = Web API 2</strong></p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;aud&quot;: &quot;https://shawntest.onmicrosoft.com/WebApi2&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;iss&quot;: &quot;https://sts.windows.net/4a4d599f-e69d-4cd8-a9e1-9882ea340fb5/&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;iat&quot;: 1500243353,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;nbf&quot;: 1500243353,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;exp&quot;: 1500247253,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;acr&quot;: &quot;1&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;aio&quot;: &quot;ATQAy/.../oU&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;amr&quot;: [ &quot;rsa&quot;, &quot;mfa&quot; ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;appid&quot;: &quot;eb7b6208-538c-487b-b5b5-137ac6ab6646&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;appidacr&quot;: &quot;1&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;email&quot;: &quot;shtabriz@microsoft.com&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;family_name&quot;: &quot;Tabrizi&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;given_name&quot;: &quot;Shawn&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;idp&quot;: &quot;https://sts.windows.net/72f988bf-86f1-41af-91ab-2d7cd011db47/&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;in_corp&quot;: &quot;true&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;ipaddr&quot;: &quot;XX.XXX.XXX.XXX&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;name&quot;: &quot;Shawn Tabrizi&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;oid&quot;: &quot;41bdce9b-3940-40a9-b2f2-03a003ad599c&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;platf&quot;: &quot;3&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;scp&quot;: &quot;user_impersonation&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;sub&quot;: &quot;hfS9IZ_..._JW8c5Gg&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;tid&quot;: &quot;4a4d599f-e69d-4cd8-a9e1-9882ea340fb5&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;unique_name&quot;: &quot;shtabriz@microsoft.com&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;ver&quot;: &quot;1.0&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Payload 2: Client = Web API 2, Resource = Web API 1</strong></p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;aud&quot;: &quot;https://shawntest.onmicrosoft.com/WebApi1&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;iss&quot;: &quot;https://sts.windows.net/4a4d599f-e69d-4cd8-a9e1-9882ea340fb5/&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;iat&quot;: 1500243330,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;nbf&quot;: 1500243330,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;exp&quot;: 1500247230,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;acr&quot;: &quot;1&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;aio&quot;: &quot;ATQAy/...BLDunA&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;amr&quot;: [ &quot;rsa&quot;, &quot;mfa&quot; ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;appid&quot;: &quot;554e427d-36c3-4a77-89a5-a082ee333e12&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;appidacr&quot;: &quot;1&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;email&quot;: &quot;shtabriz@microsoft.com&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;family_name&quot;: &quot;Tabrizi&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;given_name&quot;: &quot;Shawn&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;groups&quot;: [ &quot;0f4374e6-8131-413e-b32b-f98bfdb371ed&quot; ],     &lt;-- Groups!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;idp&quot;: &quot;https://sts.windows.net/72f988bf-86f1-41af-91ab-2d7cd011db47/&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;in_corp&quot;: &quot;true&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;ipaddr&quot;: &quot;XX.XXX.XXX.XXX&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;name&quot;: &quot;Shawn Tabrizi&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;oid&quot;: &quot;41bdce9b-3940-40a9-b2f2-03a003ad599c&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;platf&quot;: &quot;3&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;scp&quot;: &quot;user_impersonation&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;sub&quot;: &quot;xy..._zGJEZnIB4&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;tid&quot;: &quot;4a4d599f-e69d-4cd8-a9e1-9882ea340fb5&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;unique_name&quot;: &quot;shtabriz@microsoft.com&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;ver&quot;: &quot;1.0&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;wids&quot;: [ &quot;62e90394-69f5-4237-9190-012177145e10&quot; ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Note that we only get the group membership claims when the <strong>resource</strong> application has this setting, not the client application. The client application has no power to control the types of claims in the token, because ultimately the token is not for them!</p>
<p>If you are building a client application using Azure Active Directory, please do not use the access token to try and get information about the authenticated session. The correct practice here is to request separately an ID Token , or to call the AAD / Microsoft Graph API to get the information you need. I hope you learned exactly how to use the &quot;groupMembershipClaims&quot; property and I hope this helps you build better apps in the future!</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/access-token/">access token</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/application/">application</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/azure-active-directory/">azure active directory</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/claims/">claims</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/client/">client</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/group-membership-claims/">group membership claims</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/resource/">resource</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="One of the cool things about the Open ID Configuration endpoint is that it not only tells us random facts about the tenant, but it confirms that the tenant exists! Make sure to check out my last post to learn more about this. Using some clever scripting and this endpoint behavior, we could probably figure out which companies have an Azure Active Directory Tenant."><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/aad/does-company-x-have-an-azure-active-directory-tenant/">Does Company &amp;#8216;X&amp;#8217; have an Azure Active Directory Tenant?</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2017-07-12T12:50:35.000Z" itemprop="datePublished">July 12, 2017</time> · <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/shawntabrizi" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/shawntabrizi.png" alt="Shawn Tabrizi" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/shawntabrizi" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Shawn Tabrizi</span></a></div><small class="avatar__subtitle" itemprop="description">Software Engineer</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>One of the cool things about the Open ID Configuration endpoint is that it not only tells us random facts about the tenant, but it confirms that the tenant exists! Make sure to check out <a href="https://shawntabrizi.com/aad/secret-apis-in-azure-active-directory-and-azure-resource-manager/" target="_blank" rel="noopener noreferrer">my last post</a> to learn more about this. Using some clever scripting and this endpoint behavior, we could probably figure out which companies have an Azure Active Directory Tenant.</p>
<p>Let&#x27;s try that!</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$csv = Import-Csv -Path .\input.csv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$output = @()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foreach ($line in $csv)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $companyname = $line.CompanyName</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $companynameencoded = [System.Net.WebUtility]::UrlEncode($companyname)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $GoogleURI = &#x27;https://www.google.com/search?q=&#x27; + $companynameencoded + &#x27;&amp;amp;btnI&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $GoogleResult = Invoke-WebRequest -Uri $GoogleURI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $CompanyURI = ([System.Uri]$GoogleResult.BaseResponse.ResponseUri).Host.split(&#x27;.&#x27;)[-2..-1] -join &#x27;.&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } catch {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        write-host $_.Exception</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $CompanyURI = &quot;error&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $OpenIDConfigURL = &#x27;https://login.microsoftonline.com/&#x27; + $CompanyURI + &#x27;/.well-known/openid-configuration&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $OpenIDResult = (Invoke-WebRequest -Uri $OpenIDConfigURL).StatusCode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } catch {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $OpenIDResult = $_.Exception.Response.StatusCode.value__</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if ($OpenIDResult -eq 200) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $tenant = $true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $tenant = $false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $result = [pscustomobject]@{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CompanyName = $companyname.ToString()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        HomepageURI = $CompanyURI.ToString()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        OpenIDResult = $OpenIDResult.ToString()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        HasTenant = $tenant.ToString()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Write-Host $result</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $output += $result</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$output | Export-Csv -Path output.csv -NoTypeInformation</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>So in summary what does this script do?</p>
<ul>
<li>We take a CSV which lists a bunch of Company Names.</li>
<li>We then do a Google search, and go to the first result (&#x27;I&#x27;m Feeling Lucky&#x27;).</li>
<li>We assume the first result is the homepage of that company, and the domain they would use for their tenant.</li>
<li>We pull out the host name, and then check it against the Open ID Configuration endpoint.<!-- -->
<ul>
<li>If we get a valid response from the endpoint, then we say that they have a tenant!</li>
<li>Otherwise, we say they do not have a tenant.</li>
</ul>
</li>
</ul>
<p>One thing to note about these results is that when we get a result that says the company has a tenant, we are nearly 100% correct in that fact. However, if we say that a company does not have a tenant, we are not necessarily correct. It is possible that the google result did not point to their actual domain name, or they are using a different domain name for their AAD Tenant.</p>
<p>If you wanted to do this really robustly, you would probably want to get a better source for your domain names than automated google search results. You might want to also look at other combinations like &quot;companyname.onmicrosoft.com&quot;, however we are doing just rough estimates here.</p>
<p>So lets look at the results for the Fortune 500.</p>
<p>A quick Google search later, and I have a CSV with a list of all the Company Names for all 500 companies. Running it through this script, I find that 417, or 83.4% of companies have AAD, which is just a little off from Microsoft&#x27;s public claim of 85%.</p>
<p>Not bad for a quick and dirty script!</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/azure-active-directory/">azure active directory</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/hack/">hack</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/powershell/">powershell</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/programming/">programming</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/script/">script</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/tenant/">tenant</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="Have you ever wondered what the Tenant ID for Microsoft (microsoft.com) or any other domain is? Have you ever wondered how you can find the right Tenant ID to sign in a user given their Azure Subscription ID?"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/aad/secret-apis-in-azure-active-directory-and-azure-resource-manager/">Secret APIs in Azure Active Directory and Azure Resource Manager</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2017-07-11T16:40:44.000Z" itemprop="datePublished">July 11, 2017</time> · <!-- -->5 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/shawntabrizi" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/shawntabrizi.png" alt="Shawn Tabrizi" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/shawntabrizi" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Shawn Tabrizi</span></a></div><small class="avatar__subtitle" itemprop="description">Software Engineer</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Have you ever wondered what the Tenant ID for Microsoft (microsoft.com) or any other domain is? Have you ever wondered how you can find the right Tenant ID to sign in a user given their Azure Subscription ID?</p>
<p>...</p>
<p>Oh, you haven&#x27;t? Well that is certainly more reasonable than the fact that I have; but, if for some reason you are asking the same questions as I am, let me tell you about some of the &quot;secret APIs&quot; that are available to answer those questions.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="getting-the-tenant-id-for-a-verified-domain-in-azure-active-directory">Getting the Tenant ID for a Verified Domain in Azure Active Directory<a href="#getting-the-tenant-id-for-a-verified-domain-in-azure-active-directory" class="hash-link" aria-label="Direct link to Getting the Tenant ID for a Verified Domain in Azure Active Directory" title="Direct link to Getting the Tenant ID for a Verified Domain in Azure Active Directory">​</a></h2>
<p>Azure Active Directory tenants have a special type of domain called a &#x27;verified domain&#x27;. Verified domains are what they sound like, domains which a user has proven they own through DNS verification. These domains are unique across all tenants, and can act as a alternative domain to the initial domain given to all tenants (*.onmicrosoft.com).</p>
<p>While authentication and even the AAD Graph API both support the use of these domains for referencing a tenant, not all APIs support this. Sometimes you might need to convert the tenant domain to a Tenant ID... but how?</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="well-known-open-id-config">Well known open id config<a href="#well-known-open-id-config" class="hash-link" aria-label="Direct link to Well known open id config" title="Direct link to Well known open id config">​</a></h3>
<p>Check out the specification <a href="https://openid.net/specs/openid-connect-discovery-1_0.html#ProviderConfig" target="_blank" rel="noopener noreferrer">here</a>. This Open ID configuration endpoint is required for all Open ID Providers, which AAD is one of. Let&#x27;s take a look at what the response looks like for the Microsoft tenant using the verified domain &#x27;microsoft.com&#x27;:</p>
<p><a href="https://login.microsoftonline.com/microsoft.com/.well-known/openid-configuration" target="_blank" rel="noopener noreferrer">https://login.microsoftonline.com/<strong>microsoft.com</strong>/.well-known/openid-configuration</a></p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;authorization_endpoint&quot;: &quot;https://login.microsoftonline.com/72f988bf-86f1-41af-91ab-2d7cd011db47/oauth2/authorize&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;token_endpoint&quot;: &quot;https://login.microsoftonline.com/72f988bf-86f1-41af-91ab-2d7cd011db47/oauth2/token&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;token_endpoint_auth_methods_supported&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;client_secret_post&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;private_key_jwt&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;jwks_uri&quot;: &quot;https://login.microsoftonline.com/common/discovery/keys&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;response_modes_supported&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;query&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;fragment&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;form_post&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;subject_types_supported&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;pairwise&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;id_token_signing_alg_values_supported&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;RS256&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;http_logout_supported&quot;: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;frontchannel_logout_supported&quot;: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;end_session_endpoint&quot;: &quot;https://login.microsoftonline.com/72f988bf-86f1-41af-91ab-2d7cd011db47/oauth2/logout&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;response_types_supported&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;code&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;id_token&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;code id_token&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;token id_token&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;token&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;scopes_supported&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;openid&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;issuer&quot;: &quot;https://sts.windows.net/72f988bf-86f1-41af-91ab-2d7cd011db47/&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;claims_supported&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;sub&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;iss&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;cloud_instance_name&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;cloud_graph_host_name&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;aud&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;exp&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;iat&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;auth_time&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;acr&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;amr&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;nonce&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;email&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;given_name&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;family_name&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;nickname&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;microsoft_multi_refresh_token&quot;: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;check_session_iframe&quot;: &quot;https://login.microsoftonline.com/72f988bf-86f1-41af-91ab-2d7cd011db47/oauth2/checksession&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;userinfo_endpoint&quot;: &quot;https://login.microsoftonline.com/72f988bf-86f1-41af-91ab-2d7cd011db47/openid/userinfo&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;tenant_region_scope&quot;: &quot;WW&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;cloud_instance_name&quot;: &quot;microsoftonline.com&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;cloud_graph_host_name&quot;: &quot;graph.windows.net&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>I honestly have never used most of the data in this JSON, and I am not really sure where it gets used... BUT, you will notice that all of the various authentication endpoints now have a Tenant ID GUID rather than a domain name! This tells us two things:</p>
<ol>
<li>The Tenant ID for Microsoft.com is 72f988bf-86f1-41af-91ab-2d7cd011db47</li>
<li>(maybe this is obvious already.... but) Microsoft has a tenant!</li>
</ol>
<p>Now the second realization is kind of a super-set of the first, but it makes me think about something else cool we can do. What if we wanted to get a count and see which companies have an Azure Active Directory Tenant? As long as we know their Domain Name, we should be able to use this endpoint to confirm if a tenant exists! I will save this exploration for <a href="https://shawntabrizi.com/aad/does-company-x-have-an-azure-active-directory-tenant/" target="_blank" rel="noopener noreferrer">my next blog post</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="get-the-tenant-id-for-a-specific-azure-subscription-id">Get the Tenant ID for a Specific Azure Subscription ID<a href="#get-the-tenant-id-for-a-specific-azure-subscription-id" class="hash-link" aria-label="Direct link to Get the Tenant ID for a Specific Azure Subscription ID" title="Direct link to Get the Tenant ID for a Specific Azure Subscription ID">​</a></h2>
<p>The world of Azure Subscriptions is one of the most complicated spaces that shouldn&#x27;t be complicated. Depending on how you start using Azure, you may never even know that you have an Azure Active Directory Tenant. You just have your Live ID, which you use to sign on to the Azure Portal, and from there you can access your Subscription ID!  You can&#x27;t even use the &#x27;common&#x27; endpoint with Live IDs on AAD V1, so your lack of knowledge can be really painful here for app developers. We <strong>need</strong> your Tenant ID to know the right login endpoint to send you to. Luckily, we can find that using helpful error messages from Azure Resource Manager! All we need is an application for which we can get a token to Azure Resource Manager.</p>
<p>We can easily execute this plan using my <a href="https://shawntabrizi.com/aad/azure-ad-authentication-with-powershell-and-adal/" target="_blank" rel="noopener noreferrer">PowerShell Scripts</a>. Update the scripts to have the following configuration:</p>
<ul>
<li>Pick any Tenant ID and Application Information relative to that tenant</li>
<li>Set Resource ID to &quot;<a href="https://management.azure.com/" target="_blank" rel="noopener noreferrer">https://management.azure.com/</a>&quot;</li>
<li>Create a variable &quot;$subscriptionId&quot; and set it to the Azure Subscription ID you are looking to investigate.</li>
<li>Set up the REST call like this:</li>
</ul>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Invoke-RestMethod -Method Get -Uri (&quot;{0}/subscriptions/{1}?api-version=2016-06-01&quot; -f $resourceId, $subscriptionId) -Headers $headers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} catch {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Write-Host $_.ErrorDetails.Message</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Hmm... why would I be catching an error? Well let&#x27;s run it and see what gets outputted:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;error&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;code&quot;: &quot;InvalidAuthenticationTokenTenant&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;message&quot;: &quot;The access token is from the wrong issuer &#x27;https://sts.windows.net/4a4d599f-e69d-4cd8-a9e1-9882ea340fb5/&#x27;. It must match the tenant &#x27;https://sts.windows.net/72f988bf-86f1-41af-91ab-2d7cd011db47/&#x27; associated with this subscription. Please use the authority (URL) &#x27;https://login.windows.net/72f988bf-86f1-41af-91ab-2d7cd011db47&#x27; to get the token. Note, if the subscription is transferred to another tenant there is no impact to the services, but information about new tenant could take time to propagate (up to an hour). If you just transferred your subscription and see this error message, please try back later.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Right in the error they tell us the correct tenant for this Subscription ID!</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Please use the authority (URL) &#x27;https://login.windows.net/**72f988bf-86f1-41af-91ab-2d7cd011db47**&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This really is a &quot;secret API&quot;, and we can use it to consistently get back the right tenant for a user, as long as they know what their Azure Subscription is.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/arm/">arm</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/azure-active-directory/">azure active directory</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/azure-resource-manager/">azure resource manager</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/powershell/">powershell</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/rest-api/">rest api</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/subscription/">subscription</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/tenant/">tenant</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="In the 3 years I spent on the Azure AD team, I learned a number of useful &#x27;tricks&#x27; to make my job (and usually the jobs of others) a ton easier. However, if I had to pick just one trick to share to others trying to learn, it would probably be the PowerShell scripts I wrote to quickly get an access token to Azure Active Directory and then call AAD protected APIs like the AAD Graph API."><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/aad/azure-ad-authentication-with-powershell-and-adal/">Azure AD Authentication with PowerShell and ADAL</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2017-07-09T17:54:45.000Z" itemprop="datePublished">July 9, 2017</time> · <!-- -->5 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/shawntabrizi" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/shawntabrizi.png" alt="Shawn Tabrizi" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/shawntabrizi" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Shawn Tabrizi</span></a></div><small class="avatar__subtitle" itemprop="description">Software Engineer</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>In the 3 years I spent on the Azure AD team, I learned a number of useful &#x27;tricks&#x27; to make my job (and usually the jobs of others) a ton easier. However, if I had to pick just one trick to share to others trying to learn, it would probably be the PowerShell scripts I wrote to quickly get an access token to Azure Active Directory and then call AAD protected APIs like the AAD Graph API.</p>
<p>In general, authentication is hard, and requires way more set up than should be needed for simple testing. To get AAD authentication working on other platforms, you may need to write a ton of code, compile it, or even publish it to the web. With these scripts, you can get authentication and REST API calls done with as little as 13 lines of PowerShell. Running the code is instant, and modifying the REST calls or even the authentication parameters takes seconds rather than minutes.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-get-the-samples">How to get the samples<a href="#how-to-get-the-samples" class="hash-link" aria-label="Direct link to How to get the samples" title="Direct link to How to get the samples">​</a></h2>
<p>You can find all the basic scripts I have written on GitHub here:</p>
<p><a href="https://github.com/shawntabrizi/Azure-AD-Authentication-with-PowerShell-and-ADAL" target="_blank" rel="noopener noreferrer">https://github.com/shawntabrizi/Azure-AD-Authentication-with-PowerShell-and-ADAL</a></p>
<p>I provide different scripts for different authentication flows:</p>
<ol>
<li>Authorization Code Grant Flow for Confidential Client</li>
<li>Native Client Authentication</li>
<li>Client Credential Flow<!-- -->
<ol>
<li>Using Application Key</li>
<li>Using Client Certificate</li>
</ol>
</li>
</ol>
<p>Each script ends with a REST API call to get the list of Users in your tenant using the AAD Graph API. You should be able to do this with any application because it uses the &quot;Sign in and read basic profile&quot; permission which is assigned to all AAD Applications by default.</p>
<p>Note that to get these samples running, you will need to add the .NET dlls for ADAL v2 into the ADAL folder. You can find those files <a href="https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory/2.28.4" target="_blank" rel="noopener noreferrer">on NuGet</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="why-it-is-so-darn-useful">Why it is so darn useful<a href="#why-it-is-so-darn-useful" class="hash-link" aria-label="Direct link to Why it is so darn useful" title="Direct link to Why it is so darn useful">​</a></h2>
<p>So now that you have the scripts downloaded, and hopefully working, let me illustrate to you just a few of the different scenarios where I have used this tool to greatly simplify my work.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="verifying-token-claims">Verifying Token Claims<a href="#verifying-token-claims" class="hash-link" aria-label="Direct link to Verifying Token Claims" title="Direct link to Verifying Token Claims">​</a></h3>
<p>So many errors in AAD app development come from some sort of wrong setting, which may manifest itself in your access token. You might want to check the &#x27;scp&#x27; claims to see if your app has the right permissions. You might want to check the &#x27;tid&#x27; claim to make sure that you are getting a token to the right tenant! Or even the &#x27;aud&#x27; claim to make sure the token is for the correct resource. You can simply pump in the settings for your application into the appropriate PowerShell script, run the script, and you will get a .txt file with your access token in it. Then you can pop that JWT token into a JWT decoder like <a href="https://shawntabrizi.com/JWT-Decoder/" target="_blank" rel="noopener noreferrer">the one I created...</a> and viola! There are your claims, and it took literally seconds.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="making-quick-rest-api-calls">Making quick REST API calls<a href="#making-quick-rest-api-calls" class="hash-link" aria-label="Direct link to Making quick REST API calls" title="Direct link to Making quick REST API calls">​</a></h3>
<p>Another thing that comes up very often around work is just pulling random data from AAD. Let&#x27;s say that someone wants to know the settings of a certain Application Object, Service Principal, or even User. You may be able to do this with tools like the <a href="https://graphexplorer.azurewebsites.net/" target="_blank" rel="noopener noreferrer">Graph Explorer</a>, but what about some more complicated queries, or ones that you want to download to a file for later? Or how about simply wanting to test that YOUR app can make those queries rather than the Graph Explorer app. Not to mention the fact that you can call ANY AAD protected API, not just the AAD Graph API with these scripts. Simply update the Invoke-RestMethod command and bam, results will be saved into a .json file!</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="making-scripted-rest-api-calls">Making scripted REST API calls<a href="#making-scripted-rest-api-calls" class="hash-link" aria-label="Direct link to Making scripted REST API calls" title="Direct link to Making scripted REST API calls">​</a></h3>
<p>Maybe you are still not convinced that these scripts are useful. Most of what I showed above can be done if you want to use multiple other tools. However, I challenge you to find a quicker way to create &quot;scripted&quot; REST API calls. What do I mean by that? Lets say you wanted to pull a list of all the users in your company. Well the AAD Graph API can return at most 999 results in a single call, so you probably want to create a loop that iterates over the paged results that the Graph API returns. This is SIMPLE!</p>
<p>Here is the loop I wrote to solve this exact problem:</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$result = Invoke-RestMethod -Method Get -Uri (&#x27;{0}/{1}/users/?api-version=1.6&amp;amp;amp;amp;$top=999&#x27; -f $resourceId,$tenantId) -Headers $headers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$count = 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$result.value | Export-Csv ([String]$count + &quot;_&quot; +$output) -Encoding UTF8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">while (($result.&#x27;odata.nextLink&#x27; -split &#x27;skiptoken=&#x27;)[1] -ne $null)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  $skiptoken = ($result.&#x27;odata.nextLink&#x27; -split &#x27;skiptoken=&#x27;)[1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Write-Host (&#x27;{0}/{1}/users/?api-version=1.6&amp;amp;amp;amp;$top=999&amp;amp;amp;amp;$skiptoken={2}&#x27; -f $resourceId,$tenantId,$skiptoken)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  try</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $result = Invoke-RestMethod -Method Get -Uri (&#x27;{0}/{1}/users/?api-version=1.6&amp;amp;amp;amp;$top=999&amp;amp;amp;amp;$skiptoken={2}&#x27; -f $resourceId,$tenantId,$skiptoken) -Headers $headers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $count += 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $result.value | Export-Csv ([String]$count + &quot;_&quot; + $output) -Encoding UTF8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  catch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Write-Host &quot;Error with Invoke Rest Method!&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Write-Host $result.&#x27;odata.nextLink&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    break</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The result is a folder of CSV files all numbered and ready to be merged. If the script fails at some point (like if I lose an internet connection), I can use the outputted &#x27;odata.nextLink&#x27; and just pick up where I left off. I couldn&#x27;t imagine doing this any other way for my needs.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="convinced">Convinced?<a href="#convinced" class="hash-link" aria-label="Direct link to Convinced?" title="Direct link to Convinced?">​</a></h2>
<p>I hope that you too will be able to find this little tool helpful for your day to day needs. Let me know if you find some other unconventional uses for this!</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/access-token/">access token</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/adal/">adal</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/authentication/">authentication</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/azure-active-directory/">azure active directory</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/graph-api/">graph api</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/powershell/">powershell</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/programming/">programming</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/script/">script</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><a class="pagination-nav__link pagination-nav__link--next" href="/blog/tags/azure-active-directory/page/2/"><div class="pagination-nav__label">Older Entries</div></a></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="text--center"><a href="https://github.com/shawntabrizi/" target="_blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" class="svg-inline--fa fa-github fa-inverse fa-3x" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" style="transform-origin:0.484375em 0.5em"><g transform="translate(248 256)"><g transform="translate(0, 0)  scale(0.625, 0.625)  rotate(0 0 0)"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z" transform="translate(-248 -256)"></path></g></g></svg></a><a href="https://www.linkedin.com/in/shawn-tabrizi/" target="_blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin" class="svg-inline--fa fa-linkedin fa-inverse fa-3x" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" style="transform-origin:0.4375em 0.5em"><g transform="translate(224 256)"><g transform="translate(0, 0)  scale(0.625, 0.625)  rotate(0 0 0)"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z" transform="translate(-224 -256)"></path></g></g></svg></a><a href="https://twitter.com/shawntabrizi" target="_blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="twitter" class="svg-inline--fa fa-twitter fa-inverse fa-3x" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="transform-origin:0.5em 0.5em"><g transform="translate(256 256)"><g transform="translate(0, 0)  scale(0.625, 0.625)  rotate(0 0 0)"><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z" transform="translate(-256 -256)"></path></g></g></svg></a><a href="https://stackexchange.com/users/1489538" target="_blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="stack-exchange" class="svg-inline--fa fa-stack-exchange fa-inverse fa-3x" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" style="transform-origin:0.4375em 0.5em"><g transform="translate(224 256)"><g transform="translate(0, 0)  scale(0.625, 0.625)  rotate(0 0 0)"><path fill="currentColor" d="M17.7 332.3h412.7v22c0 37.7-29.3 68-65.3 68h-19L259.3 512v-89.7H83c-36 0-65.3-30.3-65.3-68v-22zm0-23.6h412.7v-85H17.7v85zm0-109.4h412.7v-85H17.7v85zM365 0H83C47 0 17.7 30.3 17.7 67.7V90h412.7V67.7C430.3 30.3 401 0 365 0z" transform="translate(-224 -256)"></path></g></g></svg></a><a href="https://www.instagram.com/shawntabrizi/" target="_blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="instagram" class="svg-inline--fa fa-instagram fa-inverse fa-3x" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" style="transform-origin:0.4375em 0.5em"><g transform="translate(224 256)"><g transform="translate(0, 0)  scale(0.625, 0.625)  rotate(0 0 0)"><path fill="currentColor" d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z" transform="translate(-224 -256)"></path></g></g></svg></a><a href="https://www.youtube.com/channel/UCl2YcZijUhWJweYeiOIYNdA" target="_blank"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="youtube" class="svg-inline--fa fa-youtube fa-inverse fa-3x" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" style="transform-origin:0.5625em 0.5em"><g transform="translate(288 256)"><g transform="translate(0, 0)  scale(0.625, 0.625)  rotate(0 0 0)"><path fill="currentColor" d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z" transform="translate(-288 -256)"></path></g></g></svg></a><a href="mailto:shawntabrizi@gmail.com" target="_blank"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="envelope" class="svg-inline--fa fa-envelope fa-inverse fa-3x" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="transform-origin:0.5em 0.5em"><g transform="translate(256 256)"><g transform="translate(0, 0)  scale(0.625, 0.625)  rotate(0 0 0)"><path fill="currentColor" d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4L236.8 313.6c11.4 8.5 27 8.5 38.4 0L492.8 150.4c12.1-9.1 19.2-23.3 19.2-38.4c0-26.5-21.5-48-48-48H48zM0 176V384c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V176L294.4 339.2c-22.8 17.1-54 17.1-76.8 0L0 176z" transform="translate(-256 -256)"></path></g></g></svg></a></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Shawn Tabrizi</div></div></div></footer></div>
</body>
</html>