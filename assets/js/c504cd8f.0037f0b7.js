"use strict";(self.webpackChunkshawntabrizi=self.webpackChunkshawntabrizi||[]).push([[5491],{73590:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>s,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>c});var a=t(85893),i=t(11151);const l={title:"The Merge of ink! and FRAME",date:new Date("2022-08-11T00:00:00.000Z"),authors:"shawntabrizi",categories:["Polkadot"],tags:["frame","ink","polkadot","devex","smart contract"]},s=void 0,r={permalink:"/blog/2022/08/11/the-merge-of-ink-and-frame",source:"@site/blog/2022-08-11-the-merge-of-ink-and-frame.md",title:"The Merge of ink! and FRAME",description:"In this post, I propose a better developer experience and pathway for developers in the Polkadot ecosystem by merging the development language used for ink! smart contracts and FRAME pallets.",date:"2022-08-11T00:00:00.000Z",tags:[{inline:!0,label:"frame",permalink:"/blog/tags/frame"},{inline:!0,label:"ink",permalink:"/blog/tags/ink"},{inline:!0,label:"polkadot",permalink:"/blog/tags/polkadot"},{inline:!0,label:"devex",permalink:"/blog/tags/devex"},{inline:!0,label:"smart contract",permalink:"/blog/tags/smart-contract"}],readingTime:6.02,hasTruncateMarker:!1,authors:[{name:"Shawn Tabrizi",title:"Software Engineer",url:"https://github.com/shawntabrizi",imageURL:"https://github.com/shawntabrizi.png",key:"shawntabrizi",page:null}],frontMatter:{title:"The Merge of ink! and FRAME",date:"2022-08-11T00:00:00.000Z",authors:"shawntabrizi",categories:["Polkadot"],tags:["frame","ink","polkadot","devex","smart contract"]},unlisted:!1,prevItem:{title:"A Better Treasury System",permalink:"/blog/2022/09/04/a-better-treasury-system"},nextItem:{title:"Web3 Reading List",permalink:"/blog/personal/web3-reading-list/"}},o={authorsImageUrls:[void 0]},c=[{value:"In this post, I propose a better developer experience and pathway for developers in the Polkadot ecosystem by merging the development language used for ink! smart contracts and FRAME pallets.",id:"in-this-post-i-propose-a-better-developer-experience-and-pathway-for-developers-in-the-polkadot-ecosystem-by-merging-the-development-language-used-for-ink-smart-contracts-and-frame-pallets",level:5},{value:"Vision",id:"vision",level:3},{value:"Why",id:"why",level:3},{value:"Reduced Onboarding Costs",id:"reduced-onboarding-costs",level:4},{value:"Raw Speed Improvements",id:"raw-speed-improvements",level:4},{value:"Parachain Lifecycle",id:"parachain-lifecycle",level:4},{value:"How",id:"how",level:3},{value:"ink! Example",id:"ink-example",level:4},{value:"FRAME Example",id:"frame-example",level:4},{value:"Concerns",id:"concerns",level:3},{value:"Known Problems",id:"known-problems",level:3}];function d(e){const n={blockquote:"blockquote",code:"code",h3:"h3",h4:"h4",h5:"h5",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h5,{id:"in-this-post-i-propose-a-better-developer-experience-and-pathway-for-developers-in-the-polkadot-ecosystem-by-merging-the-development-language-used-for-ink-smart-contracts-and-frame-pallets",children:"In this post, I propose a better developer experience and pathway for developers in the Polkadot ecosystem by merging the development language used for ink! smart contracts and FRAME pallets."}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"Pathway for a developer",src:t(40290).Z+"",width:"1380",height:"776"})}),"\n",(0,a.jsx)(n.p,{children:"ink! and FRAME are two Rust based languages developed by Parity for developing state transition functions. The first focuses on smart contracts, and the second focuses on the blockchain runtime."}),"\n",(0,a.jsx)(n.p,{children:"Both of these languages heavily rely on Rust macros which form an eDSL for developing these decentralized applications."}),"\n",(0,a.jsx)(n.h3,{id:"vision",children:"Vision"}),"\n",(0,a.jsx)(n.p,{children:"In short, I believe that Wasm Smart Contract and Substrate Runtime development could use a single shared language, and we could continue to brand that language as ink!."}),"\n",(0,a.jsx)(n.p,{children:"ink! will be a general language for developing decentralized applications in the Substrate / Polkadot ecosystem."}),"\n",(0,a.jsx)(n.h3,{id:"why",children:"Why"}),"\n",(0,a.jsx)(n.p,{children:"Here are some of the reasons why a merge of ink! and FRAME would be valuable to us and our ecosystem."}),"\n",(0,a.jsx)(n.h4,{id:"reduced-onboarding-costs",children:"Reduced Onboarding Costs"}),"\n",(0,a.jsx)(n.p,{children:"Parity is working on developing two distinct developer communities at the moment: ink! Smart Contract Developers and FRAME Runtime Developers."}),"\n",(0,a.jsx)(n.p,{children:"Practically speaking these two communities do not share much besides working within the Substrate / Polkadot ecosystem, and building decentralized applications in Rust."}),"\n",(0,a.jsx)(n.p,{children:"There is a great potential opportunity to combine these ecosystems, and have them work together on a single shared goal."}),"\n",(0,a.jsx)(n.p,{children:"Imagine you go to a conference, and rather than there being multiple different workshops on ink! and FRAME, there is instead a single set of workshops on a single language with different levels of difficulty, ranging from contract development, to basic runtime development, to advance runtime development."}),"\n",(0,a.jsx)(n.p,{children:"Documentation, videos, and everything else related to education become more simple, and from this, we will reduce the costs of onboarding new developers into our ecosystem."}),"\n",(0,a.jsx)(n.h4,{id:"raw-speed-improvements",children:"Raw Speed Improvements"}),"\n",(0,a.jsx)(n.p,{children:"One of the original sells of Polkadot is to provide a scalability solution to contract developers that feel limited by a single contract chain."}),"\n",(0,a.jsx)(n.p,{children:"It is likely that ink! contract developers will face similar scaling issues on their layer 1 chains as other parachains."}),"\n",(0,a.jsx)(n.p,{children:'We know that by simply running code within the Substrate runtime environment, we can get "off the chart" performance increases.'}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"Pathway for a developer",src:t(654).Z+"",width:"1080",height:"642"})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"In the graph above, smaller is better."}),"\n"]}),"\n",(0,a.jsx)(n.h4,{id:"parachain-lifecycle",children:"Parachain Lifecycle"}),"\n",(0,a.jsx)(n.p,{children:"Another problem we can solve here making development on Polkadot more approachable."}),"\n",(0,a.jsx)(n.p,{children:"Currently, a developer in the Polkadot ecosystem basically needs to believe that their idea is good enough to build a whole team, win a parachain slot, launch, and maintain."}),"\n",(0,a.jsx)(n.p,{children:"There is basically no room here for simply experimenting with the technology. Allowing users to write a contract, knowing that they can one day use that same code to then launch a parathread or parachain is a great sell for people to feel that even small investments in our ecosystem are worthwhile."}),"\n",(0,a.jsx)(n.p,{children:"The story becomes:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Do you have an idea?","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Make a contract! Try it out! Fast, easy, and nearly zero overhead for you."}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["Did you validate your idea with a contract?","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Upgrade to a parathread! Get the blazing speeds of working in the runtime, with little to no additional coding required! We can even help you migrate your contract data to a parathread."}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["Is your parathread going viral?","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Upgrade it to a parachain! Guarantee your cost of business over the next 2 years."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"how",children:"How"}),"\n",(0,a.jsx)(n.p,{children:"I claim that every ink! Smart Contract is a valid Substrate Runtime. That is, the set of applications you can develop with ink! is a strict subset of the set of applications you can build with FRAME."}),"\n",(0,a.jsx)(n.p,{children:"At a high level, both languages break down application development into these components:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Storage"}),"\n",(0,a.jsx)(n.li,{children:"Calls / Messages"}),"\n",(0,a.jsx)(n.li,{children:"Events"}),"\n",(0,a.jsx)(n.li,{children:"Errors"}),"\n",(0,a.jsx)(n.li,{children:"Origin / Caller"}),"\n",(0,a.jsx)(n.li,{children:"etc..."}),"\n"]}),"\n",(0,a.jsx)(n.h4,{id:"ink-example",children:"ink! Example"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-rust",children:"#![cfg_attr(not(feature = \"std\"), no_std)]\n\nuse ink_lang as ink;\n\n#[ink::contract]\npub mod flipper {\n    #[ink(storage)]\n    pub struct Flipper {\n        value: bool,\n    }\n\n    impl Flipper {\n        /// Creates a new flipper smart contract initialized with the given value.\n        #[ink(constructor)]\n        pub fn new(init_value: bool) -> Self {\n            Self { value: init_value }\n        }\n\n        /// Creates a new flipper smart contract initialized to `false`.\n        #[ink(constructor)]\n        pub fn default() -> Self {\n            Self::new(Default::default())\n        }\n\n        /// Flips the current value of the Flipper's boolean.\n        #[ink(message)]\n        pub fn flip(&mut self) {\n            self.value = !self.value;\n        }\n\n        /// Returns the current value of the Flipper's boolean.\n        #[ink(message)]\n        pub fn get(&self) -> bool {\n            self.value\n        }\n    }\n\n    #[cfg(test)]\n    mod tests {\n        use super::*;\n        use ink_lang as ink;\n\n        #[ink::test]\n        fn default_works() {\n            let flipper = Flipper::default();\n            assert!(!flipper.get());\n        }\n\n        #[ink::test]\n        fn it_works() {\n            let mut flipper = Flipper::new(false);\n            assert!(!flipper.get());\n            flipper.flip();\n            assert!(flipper.get());\n        }\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h4,{id:"frame-example",children:"FRAME Example"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-rust",children:'#![cfg_attr(not(feature = "std"), no_std)]\n\npub use pallet::*;\n\n#[cfg(test)]\nmod mock;\n\n#[frame_support::pallet]\npub mod pallet {\n\tuse frame_support::pallet_prelude::*;\n\tuse frame_system::pallet_prelude::*;\n\n\t#[pallet::pallet]\n\t#[pallet::generate_store(pub(super) trait Store)]\n\tpub struct Pallet<T>(_);\n\n\t#[pallet::config]\n\tpub trait Config: frame_system::Config {}\n\n\t#[pallet::storage]\n\tpub type Flipper<T> = StorageValue<_, bool, ValueQuery>;\n\n\t#[pallet::genesis_config]\n\tpub struct GenesisConfig {\n\t\tpub start_value: bool,\n\t}\n\n\t#[cfg(feature = "std")]\n\timpl Default for GenesisConfig {\n\t\tfn default() -> Self {\n\t\t\tSelf { start_value: false }\n\t\t}\n\t}\n\n\t#[pallet::genesis_build]\n\timpl<T: Config> GenesisBuild<T> for GenesisConfig {\n\t\tfn build(&self) {\n\t\t\tFlipper::<T>::set(self.start_value)\n\t\t}\n\t}\n\n\t#[pallet::call]\n\timpl<T: Config> Pallet<T> {\n\t\t#[pallet::weight(10_000 + T::DbWeight::get().writes(1))]\n\t\tpub fn flip(_origin: OriginFor<T>) -> DispatchResult {\n\t\t\tFlipper::<T>::mutate(|value| *value = !*value);\n\t\t\tOk(())\n\t\t}\n\t}\n}\n\n#[cfg(test)]\nuse crate::mock::{new_test_ext, Origin, TemplateModule, Test as T};\n\n#[test]\nfn default_works() {\n\tnew_test_ext().execute_with(|| {\n\t\tassert!(!Flipper::<T>::get());\n\t});\n}\n\n#[test]\nfn it_works() {\n\tnew_test_ext().execute_with(|| {\n\t\tassert!(!Flipper::<T>::get());\n\t\tassert!(TemplateModule::flip(Origin::signed(1)).is_ok());\n\t\tassert!(Flipper::<T>::get());\n\t});\n}\n'})}),"\n",(0,a.jsx)(n.p,{children:"These components are simplified and exposed to the user in an expected syntax. This eDSL is then parsed by the macro, and then regular Rust code is generated in the background, which calls low level apis that access the underlying VM environment."}),"\n",(0,a.jsx)(n.p,{children:"My (naive) belief is that we can manipulate these macros to basically fork the underlying generated code whether"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"                                  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                                  \u2502               \u2502\n                                  \u2502   ink! dApp   \u2502\n                                  \u2502   \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500   \u2502\n                                  \u2502   Storage     \u2502\n                                  \u2502   Calls       \u2502\n                                  \u2502   Events      \u2502\n                                  \u2502   Errors      \u2502\n                                  \u2502   etc...      \u2502\n                                  \u2502               \u2502\n                                  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                          \u2502\n                                          \u2502\n                                          \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                  \u2502                   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Target Contracts API \u2502                  \u25bc                   \u2502   Target FRAME API   \u2502\n\u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u2502                                      \u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 \u2502\n\u2502                      \u2502 \u25c4\u2500\u2500 ink::contract or ink::pallet \u2500\u2500\u25ba \u2502 sp-io w/ hashed keys \u2502\n\u2502                      \u2502                                      \u2502 dispatchable trait   \u2502\n\u2502                      \u2502                                      \u2502 outer event enum     \u2502\n\u2502                      \u2502                                      \u2502 dispatchable error   \u2502\n\u2502                      \u2502                                      \u2502                      \u2502\n\u2502                      \u2502                                      \u2502                      \u2502\n\u2502                      \u2502                                      \u2502                      \u2502\n\u2502                      \u2502                                      \u2502                      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n"})}),"\n",(0,a.jsx)(n.p,{children:"In the case where someone built an ink! smart contract, without any changes (maybe just benchmarks), we should be able to compile it to a Substrate Runtime."}),"\n",(0,a.jsx)(n.h3,{id:"concerns",children:"Concerns"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Is it possible?"}),"\n",(0,a.jsx)(n.li,{children:"Is it maintainable?"}),"\n",(0,a.jsx)(n.li,{children:"Contracts are immutable by nature, where pallets are not"}),"\n",(0,a.jsx)(n.li,{children:"Polkadot does not treat contracts as a first class entity today, should the narrative change?"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"known-problems",children:"Known Problems"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"weights / metering"}),"\n",(0,a.jsx)(n.li,{children:"hooks"}),"\n",(0,a.jsx)(n.li,{children:"runtime config"}),"\n",(0,a.jsx)(n.li,{children:"coupling of pallets / contracts"}),"\n",(0,a.jsx)(n.li,{children:"low level api calls (specific to runtime or contract)"}),"\n",(0,a.jsxs)(n.li,{children:["The ",(0,a.jsx)(n.code,{children:"<T>"})," runtime"]}),"\n",(0,a.jsx)(n.li,{children:"Potentially multi-ink things cannot easily talk to each other (contract and pallet have a hard time to talk to each other)"}),"\n",(0,a.jsx)(n.li,{children:"Release strategy (upgrades are harder in ink!)"}),"\n",(0,a.jsx)(n.li,{children:"No errors with data"}),"\n",(0,a.jsx)(n.li,{children:"panics!"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},654:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/execution-time-06f397b3601209f1d2364d8914fa796b.png"},40290:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/the-merge-8e2accb5aa4d748d0de84897b4b34c71.jpeg"},11151:(e,n,t)=>{t.d(n,{Z:()=>r,a:()=>s});var a=t(67294);const i={},l=a.createContext(i);function s(e){const n=a.useContext(l);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),a.createElement(l.Provider,{value:n},e.children)}}}]);