"use strict";(self.webpackChunkshawntabrizi=self.webpackChunkshawntabrizi||[]).push([[26],{39619:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>a,default:()=>d,frontMatter:()=>o,metadata:()=>l,toc:()=>c});var i=t(85893),r=t(11151);const o={title:"Adding AAD Service Principal to the Company Administrator Role using the AAD PowerShell Module",date:new Date("2017-10-16T09:20:39.000Z"),authors:"shawntabrizi",slug:"/aad/adding-aad-service-principal-company-administrator-role-using-aad-powershell-module/",categories:["AAD"],tags:["aad powershell module","azure active directory","graph api","powershell","tenant administrator"]},a=void 0,l={permalink:"/blog/aad/adding-aad-service-principal-company-administrator-role-using-aad-powershell-module/",source:"@site/blog/2017-10-16-adding-aad-service-principal-company-administrator-role-using-aad-powershell-module.md",title:"Adding AAD Service Principal to the Company Administrator Role using the AAD PowerShell Module",description:"When creating a new Azure Active Directory application, developers may run into a a problem when calling the AAD Graph API where they lack the correct permissions to call the APIs they want when calling in the App Only Flow (Client Credentials Flow).",date:"2017-10-16T09:20:39.000Z",tags:[{inline:!0,label:"aad powershell module",permalink:"/blog/tags/aad-powershell-module"},{inline:!0,label:"azure active directory",permalink:"/blog/tags/azure-active-directory"},{inline:!0,label:"graph api",permalink:"/blog/tags/graph-api"},{inline:!0,label:"powershell",permalink:"/blog/tags/powershell"},{inline:!0,label:"tenant administrator",permalink:"/blog/tags/tenant-administrator"}],readingTime:2.31,hasTruncateMarker:!1,authors:[{name:"Shawn Tabrizi",title:"Software Engineer",url:"https://github.com/shawntabrizi",imageURL:"https://github.com/shawntabrizi.png",key:"shawntabrizi",page:null}],frontMatter:{title:"Adding AAD Service Principal to the Company Administrator Role using the AAD PowerShell Module",date:"2017-10-16T09:20:39.000Z",authors:"shawntabrizi",slug:"/aad/adding-aad-service-principal-company-administrator-role-using-aad-powershell-module/",categories:["AAD"],tags:["aad powershell module","azure active directory","graph api","powershell","tenant administrator"]},unlisted:!1,prevItem:{title:"Getting started with Ethereum Wallet",permalink:"/blog/ethereum/getting-started-ethereum-wallet/"},nextItem:{title:"Common Microsoft Resources in Azure Active Directory",permalink:"/blog/aad/common-microsoft-resources-azure-active-directory/"}},s={authorsImageUrls:[void 0]},c=[];function h(e){const n={a:"a",blockquote:"blockquote",code:"code",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"When creating a new Azure Active Directory application, developers may run into a a problem when calling the AAD Graph API where they lack the correct permissions to call the APIs they want when calling in the App Only Flow (Client Credentials Flow)."}),"\n",(0,i.jsx)(n.p,{children:"Is this message familiar to you?"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'"odata.error":{\n  "code":"Authorization_RequestDenied",\n  "message":{\n      "lang":"en","value":"Insufficient privileges to complete the operation."\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"The correct thing to do would be to try and investigate the permissions you have granted to your application, but there are some APIs which are not even supported through the permissions publicly exposed by the AAD Graph API. Maybe you just want to overcome this error for the time being and continue testing your end to end experience."}),"\n",(0,i.jsx)(n.p,{children:"Using the AAD PowerShell Module, you can:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Give your application full access to the Graph API in the context of my tenant."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"or"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Grant your application permissions to my tenant which are not currently supported with the permissions exposed by the AAD Graph API."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:'"How?" you might ask.'}),"\n",(0,i.jsxs)(n.p,{children:["Well, you can elevate the level of access an Application has in your tenant by adding the service principal of that application to the ",(0,i.jsx)(n.code,{children:"Company Administrator"})," Directory Role. This will give the Application the same level of permissions as the Company Administrator, who can do anything. You can follow these same instructions for any type of Directory Role depending on the level of access you want to give to this application."]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note:"})," This will only affect the access your app has in your tenant."]}),"\n",(0,i.jsx)(n.p,{children:"Also you must already be a Company Administrator of the tenant to follow these instructions."}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["In order to make the change, you will need to install the ",(0,i.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/powershell/msonline/v1/azureactivedirectory",children:"Azure Active Directory PowerShell Module"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Once you have the module installed, authenticate to your tenant with your Administrator Account:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-powershell",children:"Connect-MSOLService\n"})}),"\n",(0,i.jsx)(n.p,{children:"Then we need to get the Object ID of both the Service Principal we want to elevate, and the Company Administrator Role for your tenant."}),"\n",(0,i.jsx)(n.p,{children:"Search for Service Principal by App ID GUID:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-powershell",children:"$sp = Get-MsolServicePrincipal -AppPrincipalId <App ID GUID>\n"})}),"\n",(0,i.jsx)(n.p,{children:"Search for Directory Role by Name"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-powershell",children:'$role = Get-MsolRole -RoleName "Company Administrator"\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Now we can use the ",(0,i.jsx)(n.code,{children:"Add-MsolRoleMember"})," command to add this role to the service principal."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-powershell",children:"Add-MsolRoleMember -RoleObjectId $role.ObjectId -RoleMemberType ServicePrincipal -RoleMemberObjectId $sp.ObjectId\n"})}),"\n",(0,i.jsx)(n.p,{children:"To check everything is working, lets get back all the members of the Company Administrator role:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-powershell",children:"Get-MsolRoleMember -RoleObjectId $role.ObjectId\n"})}),"\n",(0,i.jsxs)(n.p,{children:["You should see your application in that list, where ",(0,i.jsx)(n.code,{children:"RoleMemberType"})," is ",(0,i.jsx)(n.code,{children:"ServicePrincipal"})," and ",(0,i.jsx)(n.code,{children:"DisplayName"})," is the name of your application."]}),"\n",(0,i.jsx)(n.p,{children:"Now your application should be able to perform any Graph API calls that the Company Administrator could do, all without a user signed-in, using the Client Credential Flow."}),"\n",(0,i.jsx)(n.p,{children:"Let me know if this helps!"})]})}function d(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},11151:(e,n,t)=>{t.d(n,{Z:()=>l,a:()=>a});var i=t(67294);const r={},o=i.createContext(r);function a(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);