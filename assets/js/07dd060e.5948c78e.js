"use strict";(self.webpackChunkshawntabrizi=self.webpackChunkshawntabrizi||[]).push([[3210],{44673:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>r,toc:()=>h});var s=n(85893),a=n(11151);const i={title:"Using Web3.js 1.0 Subscribe and Infura WebSockets to Visualize Ethereum Transactions",date:new Date("2018-05-25T06:42:19.000Z"),authors:"shawntabrizi",slug:"/ethereum/using-web3-js-1-0-subscribe-and-infura-websockets-to-visualize-ethereum-transactions/",categories:["Ethereum"],tags:["blockchain","ethereum","graph","html","infura","javascript","web3","websockets"],github:"ETH-Transaction-Graph"},o=void 0,r={permalink:"/blog/ethereum/using-web3-js-1-0-subscribe-and-infura-websockets-to-visualize-ethereum-transactions/",source:"@site/blog/2018-05-24-using-web3-js-1-0-subscribe-and-infura-websockets-to-visualize-ethereum-transactions.md",title:"Using Web3.js 1.0 Subscribe and Infura WebSockets to Visualize Ethereum Transactions",description:"In this tutorial, you will learn how to subscribe to an Ethereum WebSocket using Web3.js to dynamically pull pending transactions on the blockchain.",date:"2018-05-25T06:42:19.000Z",tags:[{inline:!0,label:"blockchain",permalink:"/blog/tags/blockchain"},{inline:!0,label:"ethereum",permalink:"/blog/tags/ethereum"},{inline:!0,label:"graph",permalink:"/blog/tags/graph"},{inline:!0,label:"html",permalink:"/blog/tags/html"},{inline:!0,label:"infura",permalink:"/blog/tags/infura"},{inline:!0,label:"javascript",permalink:"/blog/tags/javascript"},{inline:!0,label:"web3",permalink:"/blog/tags/web-3"},{inline:!0,label:"websockets",permalink:"/blog/tags/websockets"}],readingTime:4.065,hasTruncateMarker:!1,authors:[{name:"Shawn Tabrizi",title:"Software Engineer",url:"https://github.com/shawntabrizi",imageURL:"https://github.com/shawntabrizi.png",key:"shawntabrizi"}],frontMatter:{title:"Using Web3.js 1.0 Subscribe and Infura WebSockets to Visualize Ethereum Transactions",date:"2018-05-25T06:42:19.000Z",authors:"shawntabrizi",slug:"/ethereum/using-web3-js-1-0-subscribe-and-infura-websockets-to-visualize-ethereum-transactions/",categories:["Ethereum"],tags:["blockchain","ethereum","graph","html","infura","javascript","web3","websockets"],github:"ETH-Transaction-Graph"},unlisted:!1,prevItem:{title:"Microsoft Identities on the Ethereum Blockchain",permalink:"/blog/aad/microsoft-identities-on-the-ethereum-blockchain/"},nextItem:{title:"Shawn Notes: CryptoZombies Lessons 1 - 5 in Solidity",permalink:"/blog/ethereum/shawn-notes-cryptozombies-lessons-1-5-in-solidity/"}},c={authorsImageUrls:[void 0]},h=[{value:"In this tutorial, you will learn how to subscribe to an Ethereum WebSocket using Web3.js to dynamically pull pending transactions on the blockchain.",id:"in-this-tutorial-you-will-learn-how-to-subscribe-to-an-ethereum-websocket-using-web3js-to-dynamically-pull-pending-transactions-on-the-blockchain",level:5},{value:"ETH Transaction Graph",id:"eth-transaction-graph",level:2},{value:"How does it work?",id:"how-does-it-work",level:3}];function l(e){const t={a:"a",blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",h5:"h5",img:"img",p:"p",pre:"pre",...(0,a.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.h5,{id:"in-this-tutorial-you-will-learn-how-to-subscribe-to-an-ethereum-websocket-using-web3js-to-dynamically-pull-pending-transactions-on-the-blockchain",children:"In this tutorial, you will learn how to subscribe to an Ethereum WebSocket using Web3.js to dynamically pull pending transactions on the blockchain."}),"\n",(0,s.jsxs)(t.p,{children:["Recently, I have been pretty lurking on the ",(0,s.jsx)(t.a,{href:"https://ethereum.stackexchange.com/",children:"Ethereum StackExchange"}),", and I have been seeing a pretty common question repeat itself."]}),"\n",(0,s.jsxs)(t.blockquote,{children:["\n",(0,s.jsx)(t.p,{children:"How can I detect when a specific transaction occurs on Ethereum?"}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"It might be that the user wants to see every time their account gets a payment. Or maybe they want track when another contract sends Ether."}),"\n",(0,s.jsxs)(t.p,{children:["By trying to answer this question I learned in ",(0,s.jsx)(t.a,{href:"https://web3js.readthedocs.io/en/1.0/index.html",children:"Web3.js 1.0"})," is introducing support for WebSockets, which will allow client applications to have an open and interactive session with the Ethereum blockchain. With WebSockets, you can automatically receive event-driven responses from Ethereum without having to repeatedly poll the blockchain. (",(0,s.jsx)(t.em,{children:"As of this writing, Web3.js 1.0 is still in beta."}),")"]}),"\n",(0,s.jsxs)(t.p,{children:["As of right now, you can ",(0,s.jsx)(t.a,{href:"https://web3js.readthedocs.io/en/1.0/web3-eth-subscribe.html",children:"subscribe to 4 kinds of events"}),": ",(0,s.jsx)(t.code,{children:"pendingTransactions"}),", ",(0,s.jsx)(t.code,{children:"newBlockHeaders"}),", ",(0,s.jsx)(t.code,{children:"syncing"}),", and ",(0,s.jsx)(t.code,{children:"logs"}),"."]}),"\n",(0,s.jsxs)(t.p,{children:["Logs are particularly interesting because you can add additional ",(0,s.jsx)(t.code,{children:"options"})," like an Ethereum address to only get back the logs for that account, which will allow you to really easily monitor when different events happen, such as a payment."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",children:'var subscription = web3.eth\n  .subscribe(\n    "logs",\n    {\n      address: "0x123456..",\n      topics: ["0x12345..."],\n    },\n    function (error, result) {\n      if (!error) console.log(result);\n    }\n  )\n  .on("data", function (log) {\n    console.log(log);\n  })\n  .on("changed", function (log) {});\n\n// unsubscribes the subscription\nsubscription.unsubscribe(function (error, success) {\n  if (success) console.log("Successfully unsubscribed!");\n});\n'})}),"\n",(0,s.jsx)(t.h2,{id:"eth-transaction-graph",children:"ETH Transaction Graph"}),"\n",(0,s.jsxs)(t.p,{children:["I wanted try out this feature, so I decided I would build a little visual which would show transactions on the Ethereum blockchain. I thought it would be cool to let transactions come in, and see if we can start to find addresses which have a ton of activity. A natural visual for transactions is to ",(0,s.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Graph_drawing",children:"draw a graph"}),", and if we do things correctly, we should see these central nodes appear; where tons of different addresses are interacting with a single Ethereum contract or other type of account."]}),"\n",(0,s.jsxs)(t.p,{children:["You can check out the web app I built here: ",(0,s.jsx)(t.a,{href:"https://shawntabrizi.com/ETH-Transaction-Graph/",children:"https://shawntabrizi.com/ETH-Transaction-Graph/"}),".\nLetting it run for a little bit will generate a neat ",(0,s.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Force-directed_graph_drawing",children:"force-directed graph drawing"})," like the one below:"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"Graph Drawing Result",src:n(74997).Z+"",width:"740",height:"771"})}),"\n",(0,s.jsxs)(t.p,{children:["You can find the source code to this app on ",(0,s.jsx)(t.a,{href:"https://github.com/shawntabrizi/ETH-Transaction-Graph",children:"my GitHub"}),"."]}),"\n",(0,s.jsx)(t.h3,{id:"how-does-it-work",children:"How does it work?"}),"\n",(0,s.jsxs)(t.p,{children:["Before you can do anything with Web3.js, you will need to gain access to an Ethereum WebSocket. This technology is still pretty new, so there aren't many options. But you can always rely on ",(0,s.jsx)(t.a,{href:"https://infura.io/",children:"Infura"})," to be ahead of the game. Although as of this writing, ",(0,s.jsx)(t.a,{href:"https://github.com/INFURA/infura/issues/97",children:"WebSockets on Infura are not quite production ready"}),", they should be in the near future. Connecting to the WebSocket is easy:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",children:'var web3 = new Web3("wss://mainnet.infura.io/_ws");\n'})}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsxs)(t.em,{children:["Note that it is important you do not include the normal check for ",(0,s.jsx)(t.a,{href:"https://metamask.io/",children:"MetaMask"}),", since the browser plugin does not yet support WebSockets."]})}),"\n",(0,s.jsx)(t.p,{children:"Now that you are connected to your WebSocket, you just need to set up a subscription using Web3.js:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",children:'subscription = web3.eth\n  .subscribe("pendingTransactions", function (error, result) {})\n  .on("data", function (transactionHash) {\n    web3.eth.getTransaction(transactionHash).then(function (transaction) {\n      createNode(transaction.from, transaction.to);\n    });\n  });\n'})}),"\n",(0,s.jsxs)(t.p,{children:["Using the code above, I will get a stream of transactions hashes coming to my app. Whenever I get a transaction hash, I use ",(0,s.jsx)(t.code,{children:"web3.eth.getTransaction"})," to then get data about the transaction. Finally, from that data, I get the ",(0,s.jsx)(t.code,{children:"to"})," address and the ",(0,s.jsx)(t.code,{children:"from"})," address. These go into my ",(0,s.jsx)(t.code,{children:"createNode"})," function which adds the transaction to the graph drawing. I won't be going into much details about ",(0,s.jsx)(t.a,{href:"https://d3js.org/",children:"D3.js"}),", which generates the graph, because it is black magic to me. (Lots of copy and pasting code to get this sample to work...)"]}),"\n",(0,s.jsx)(t.p,{children:"If you are setting up a subscription, don't forget to also set up a way to unsubscribe! This is particularly important for my little sample because the browser starts to get REALLY slow once you have a few thousand transactions drawn."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",children:'subscription.unsubscribe(function (error, success) {\n  if (success) console.log("Successfully unsubscribed!");\n});\n'})}),"\n",(0,s.jsx)(t.p,{children:"That's really all you need to know to set up a sample similar to this! I wanted to keep this example as dead simple as possible, but you could imagine a million ways to modify and improve the design here. For example, imagine having each node grow and shrink as Ether is sent to and from the Ethereum Address! If you want to fork my code, I would love to see what kinds of projects you can think of using my sample as a baseline."}),"\n",(0,s.jsx)(t.p,{children:"As always, I am excited to share with you fun, simple projects in the Ethereum development space, and I would love to hear any and all feedback you have. Know a cool project that you think someone should build and write about? Let me know!"}),"\n",(0,s.jsxs)(t.p,{children:['If this post helped you, and you want to say "Thanks!", take a look at my ',(0,s.jsx)(t.a,{href:"https://shawntabrizi.com/donate/",children:"donations page"}),"."]})]})}function u(e={}){const{wrapper:t}={...(0,a.a)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},74997:(e,t,n)=>{n.d(t,{Z:()=>s});const s=n.p+"assets/images/img_5b07a77621420-4bfa96558b6d2d2b86f32819464bfec0.png"},11151:(e,t,n)=>{n.d(t,{Z:()=>r,a:()=>o});var s=n(67294);const a={},i=s.createContext(a);function o(e){const t=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),s.createElement(i.Provider,{value:t},e.children)}}}]);